!(function e (t, n, r) { function o (a, s) { if (!n[a]) { if (!t[a]) { var u = typeof require === 'function' && require; if (!s && u) return u(a, !0); if (i) return i(a, !0); var c = new Error("Cannot find module '" + a + "'"); throw c.code = 'MODULE_NOT_FOUND', c } var f = n[a] = { exports: {} }; t[a][0].call(f.exports, function (e) { var n = t[a][1][e]; return o(n || e) }, f, f.exports, e, t, n, r) } return n[a].exports } for (var i = typeof require === 'function' && require, a = 0; a < r.length; a++)o(r[a]); return o }({ 1: [function (e, t, n) { 'use strict'; var r = e('pouchdb-utils'); var o = e('pouchdb'); n.pull = r.toPromise(function (e) { if (!e) throw 'remote must be a PouchDB instance or a url'; typeof e === 'string' && (e = new o(e)); var t = this; var n = 'envoytemp' + (new Date()).getTime(); var r = new o(n); var i = null; return e.allDocs().then(function (e) { var n = {}; return e.rows.forEach(function (e) { n[e.id] = [e.value.rev] }), t.revsDiff(n) }).then(function (t) { if (Object.keys(t).length === 0) throw 'no changes'; var n = []; return Object.keys(t).map(function (e) { n.push({ id: e }) }), e.bulkGet({ docs: n, revs: !0 }) }).then(function (e) { var t = []; return e.results.forEach(function (e) { e.docs.forEach(function (e) { t.push(e.ok) }) }), r.bulkDocs(t, { new_edits: !1 }) }).then(function () { return t.replicate.from(r) }).then(function (e) { return i = e, r.destroy() }).then(function () { return i })['catch'](function (e) { console.error('pouchdb-envoy: ', e), r.destroy() }) }), n.push = r.toPromise(function (e) { var t = this; return t.replicate.to(e) }), typeof window !== 'undefined' && window.PouchDB && window.PouchDB.plugin(n) }, { pouchdb: 17, 'pouchdb-utils': 16 }],
  2: [function (e, t, n) { 'use strict'; function r (e) { return function () { var t = arguments.length; if (t) { for (var n = [], r = -1; ++r < t;)n[r] = arguments[r]; return e.call(this, n) } return e.call(this, []) } }t.exports = r }, {}],
  3: [function (e, t, n) { function r () { return 'WebkitAppearance' in document.documentElement.style || window.console && (console.firebug || console.exception && console.table) || navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/) && parseInt(RegExp.$1, 10) >= 31 } function o () { var e = arguments; var t = this.useColors; if (e[0] = (t ? '%c' : '') + this.namespace + (t ? ' %c' : ' ') + e[0] + (t ? '%c ' : ' ') + '+' + n.humanize(this.diff), !t) return e; var r = 'color: ' + this.color; e = [e[0], r, 'color: inherit'].concat(Array.prototype.slice.call(e, 1)); var o = 0; var i = 0; return e[0].replace(/%[a-z%]/g, function (e) { e !== '%%' && (o++, e === '%c' && (i = o)) }), e.splice(i, 0, r), e } function i () { return typeof console === 'object' && console.log && Function.prototype.apply.call(console.log, console, arguments) } function a (e) { try { e == null ? n.storage.removeItem('debug') : n.storage.debug = e } catch (t) {} } function s () { var e; try { e = n.storage.debug } catch (t) {} return e } function u () { try { return window.localStorage } catch (e) {} }n = t.exports = e('./debug'), n.log = i, n.formatArgs = o, n.save = a, n.load = s, n.useColors = r, n.storage = typeof chrome !== 'undefined' && typeof chrome.storage !== 'undefined' ? chrome.storage.local : u(), n.colors = ['lightseagreen', 'forestgreen', 'goldenrod', 'dodgerblue', 'darkorchid', 'crimson'], n.formatters.j = function (e) { return JSON.stringify(e) }, n.enable(s()) }, { './debug': 4 }],
  4: [function (e, t, n) { function r () { return n.colors[f++ % n.colors.length] } function o (e) { function t () {} function o () { var e = o; var t = +new Date(); var i = t - (c || t); e.diff = i, e.prev = c, e.curr = t, c = t, e.useColors == null && (e.useColors = n.useColors()), e.color == null && e.useColors && (e.color = r()); var a = Array.prototype.slice.call(arguments); a[0] = n.coerce(a[0]), typeof a[0] !== 'string' && (a = ['%o'].concat(a)); var s = 0; a[0] = a[0].replace(/%([a-z%])/g, function (t, r) { if (t === '%%') return t; s++; var o = n.formatters[r]; if (typeof o === 'function') { var i = a[s]; t = o.call(e, i), a.splice(s, 1), s-- } return t }), typeof n.formatArgs === 'function' && (a = n.formatArgs.apply(e, a)); var u = o.log || n.log || console.log.bind(console); u.apply(e, a) }t.enabled = !1, o.enabled = !0; var i = n.enabled(e) ? o : t; return i.namespace = e, i } function i (e) { n.save(e); for (var t = (e || '').split(/[\s,]+/), r = t.length, o = 0; r > o; o++)t[o] && (e = t[o].replace(/\*/g, '.*?'), e[0] === '-' ? n.skips.push(new RegExp('^' + e.substr(1) + '$')) : n.names.push(new RegExp('^' + e + '$'))) } function a () { n.enable('') } function s (e) { var t, r; for (t = 0, r = n.skips.length; r > t; t++) if (n.skips[t].test(e)) return !1; for (t = 0, r = n.names.length; r > t; t++) if (n.names[t].test(e)) return !0; return !1 } function u (e) { return e instanceof Error ? e.stack || e.message : e }n = t.exports = o, n.coerce = u, n.disable = a, n.enable = i, n.enabled = s, n.humanize = e('ms'), n.names = [], n.skips = [], n.formatters = {}; var c; var f = 0 }, { ms: 10 }],
  5: [function (e, t, n) { function r () { this._events = this._events || {}, this._maxListeners = this._maxListeners || void 0 } function o (e) { return typeof e === 'function' } function i (e) { return typeof e === 'number' } function a (e) { return typeof e === 'object' && e !== null } function s (e) { return void 0 === e }t.exports = r, r.EventEmitter = r, r.prototype._events = void 0, r.prototype._maxListeners = void 0, r.defaultMaxListeners = 10, r.prototype.setMaxListeners = function (e) { if (!i(e) || e < 0 || isNaN(e)) throw TypeError('n must be a positive number'); return this._maxListeners = e, this }, r.prototype.emit = function (e) { var t, n, r, i, u, c; if (this._events || (this._events = {}), e === 'error' && (!this._events.error || a(this._events.error) && !this._events.error.length)) { if (t = arguments[1], t instanceof Error) throw t; throw TypeError('Uncaught, unspecified "error" event.') } if (n = this._events[e], s(n)) return !1; if (o(n)) switch (arguments.length) { case 1:n.call(this); break; case 2:n.call(this, arguments[1]); break; case 3:n.call(this, arguments[1], arguments[2]); break; default:i = Array.prototype.slice.call(arguments, 1), n.apply(this, i) } else if (a(n)) for (i = Array.prototype.slice.call(arguments, 1), c = n.slice(), r = c.length, u = 0; r > u; u++)c[u].apply(this, i); return !0 }, r.prototype.addListener = function (e, t) { var n; if (!o(t)) throw TypeError('listener must be a function'); return this._events || (this._events = {}), this._events.newListener && this.emit('newListener', e, o(t.listener) ? t.listener : t), this._events[e] ? a(this._events[e]) ? this._events[e].push(t) : this._events[e] = [this._events[e], t] : this._events[e] = t, a(this._events[e]) && !this._events[e].warned && (n = s(this._maxListeners) ? r.defaultMaxListeners : this._maxListeners, n && n > 0 && this._events[e].length > n && (this._events[e].warned = !0, console.error('(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.', this._events[e].length), typeof console.trace === 'function' && console.trace())), this }, r.prototype.on = r.prototype.addListener, r.prototype.once = function (e, t) { function n () { this.removeListener(e, n), r || (r = !0, t.apply(this, arguments)) } if (!o(t)) throw TypeError('listener must be a function'); var r = !1; return n.listener = t, this.on(e, n), this }, r.prototype.removeListener = function (e, t) { var n, r, i, s; if (!o(t)) throw TypeError('listener must be a function'); if (!this._events || !this._events[e]) return this; if (n = this._events[e], i = n.length, r = -1, n === t || o(n.listener) && n.listener === t) delete this._events[e], this._events.removeListener && this.emit('removeListener', e, t); else if (a(n)) { for (s = i; s-- > 0;) if (n[s] === t || n[s].listener && n[s].listener === t) { r = s; break } if (r < 0) return this; n.length === 1 ? (n.length = 0, delete this._events[e]) : n.splice(r, 1), this._events.removeListener && this.emit('removeListener', e, t) } return this }, r.prototype.removeAllListeners = function (e) { var t, n; if (!this._events) return this; if (!this._events.removeListener) return arguments.length === 0 ? this._events = {} : this._events[e] && delete this._events[e], this; if (arguments.length === 0) { for (t in this._events)t !== 'removeListener' && this.removeAllListeners(t); return this.removeAllListeners('removeListener'), this._events = {}, this } if (n = this._events[e], o(n)) this.removeListener(e, n); else if (n) for (;n.length;) this.removeListener(e, n[n.length - 1]); return delete this._events[e], this }, r.prototype.listeners = function (e) { var t; return t = this._events && this._events[e] ? o(this._events[e]) ? [this._events[e]] : this._events[e].slice() : [] }, r.prototype.listenerCount = function (e) { if (this._events) { var t = this._events[e]; if (o(t)) return 1; if (t) return t.length } return 0 }, r.listenerCount = function (e, t) { return e.listenerCount(t) } }, {}],
  6: [function (e, t, n) { (function (e) { 'use strict'; function n () { f = !0; for (var e, t, n = l.length; n;) { for (t = l, l = [], e = -1; ++e < n;)t[e](); n = l.length }f = !1 } function r (e) { l.push(e) !== 1 || f || o() } var o; var i = e.MutationObserver || e.WebKitMutationObserver; if (i) { var a = 0; var s = new i(n); var u = e.document.createTextNode(''); s.observe(u, { characterData: !0 }), o = function () { u.data = a = ++a % 2 } } else if (e.setImmediate || typeof e.MessageChannel === 'undefined')o = 'document' in e && 'onreadystatechange' in e.document.createElement('script') ? function () { var t = e.document.createElement('script'); t.onreadystatechange = function () { n(), t.onreadystatechange = null, t.parentNode.removeChild(t), t = null }, e.document.documentElement.appendChild(t) } : function () { setTimeout(n, 0) }; else { var c = new e.MessageChannel(); c.port1.onmessage = n, o = function () { c.port2.postMessage(0) } } var f; var l = []; t.exports = r }).call(this, typeof global !== 'undefined' ? global : typeof self !== 'undefined' ? self : typeof window !== 'undefined' ? window : {}) }, {}],
  7: [function (e, t, n) { typeof Object.create === 'function' ? t.exports = function (e, t) { e.super_ = t, e.prototype = Object.create(t.prototype, { constructor: { value: e, enumerable: !1, writable: !0, configurable: !0 } }) } : t.exports = function (e, t) { e.super_ = t; var n = function () {}; n.prototype = t.prototype, e.prototype = new n(), e.prototype.constructor = e } }, {}],
  8: [function (e, t, n) { (function () { var e = Array.prototype.slice; var t = Array.prototype.forEach; var n = function (r) { if (typeof r !== 'object') throw r + ' is not an object'; var o = e.call(arguments, 1); return t.call(o, function (e) { if (e) for (var t in e) typeof e[t] === 'object' && r[t] ? n.call(r, r[t], e[t]) : r[t] = e[t] }), r }; this.extend = n }).call(this) }, {}],
  9: [function (e, t, n) { 'use strict'; function r () {} function o (e) { if (typeof e !== 'function') throw new TypeError('resolver must be a function'); this.state = m, this.queue = [], this.outcome = void 0, e !== r && u(this, e) } function i (e, t, n) { this.promise = e, typeof t === 'function' && (this.onFulfilled = t, this.callFulfilled = this.otherCallFulfilled), typeof n === 'function' && (this.onRejected = n, this.callRejected = this.otherCallRejected) } function a (e, t, n) { p(function () { var r; try { r = t(n) } catch (o) { return v.reject(e, o) }r === e ? v.reject(e, new TypeError('Cannot resolve promise with itself')) : v.resolve(e, r) }) } function s (e) { var t = e && e.then; return e && typeof e === 'object' && typeof t === 'function' ? function () { t.apply(e, arguments) } : void 0 } function u (e, t) { function n (t) { i || (i = !0, v.reject(e, t)) } function r (t) { i || (i = !0, v.resolve(e, t)) } function o () { t(r, n) } var i = !1; var a = c(o); a.status === 'error' && n(a.value) } function c (e, t) { var n = {}; try { n.value = e(t), n.status = 'success' } catch (r) { n.status = 'error', n.value = r } return n } function f (e) { return e instanceof this ? e : v.resolve(new this(r), e) } function l (e) { var t = new this(r); return v.reject(t, e) } function d (e) { function t (e, t) { function r (e) { a[t] = e, ++s !== o || i || (i = !0, v.resolve(c, a)) }n.resolve(e).then(r, function (e) { i || (i = !0, v.reject(c, e)) }) } var n = this; if (Object.prototype.toString.call(e) !== '[object Array]') return this.reject(new TypeError('must be an array')); var o = e.length; var i = !1; if (!o) return this.resolve([]); for (var a = new Array(o), s = 0, u = -1, c = new this(r); ++u < o;)t(e[u], u); return c } function h (e) { function t (e) { n.resolve(e).then(function (e) { i || (i = !0, v.resolve(s, e)) }, function (e) { i || (i = !0, v.reject(s, e)) }) } var n = this; if (Object.prototype.toString.call(e) !== '[object Array]') return this.reject(new TypeError('must be an array')); var o = e.length; var i = !1; if (!o) return this.resolve([]); for (var a = -1, s = new this(r); ++a < o;)t(e[a]); return s } var p = e('immediate'); var v = {}; var y = ['REJECTED']; var _ = ['FULFILLED']; var m = ['PENDING']; t.exports = o, o.prototype['catch'] = function (e) { return this.then(null, e) }, o.prototype.then = function (e, t) { if (typeof e !== 'function' && this.state === _ || typeof t !== 'function' && this.state === y) return this; var n = new this.constructor(r); if (this.state !== m) { var o = this.state === _ ? e : t; a(n, o, this.outcome) } else this.queue.push(new i(n, e, t)); return n }, i.prototype.callFulfilled = function (e) { v.resolve(this.promise, e) }, i.prototype.otherCallFulfilled = function (e) { a(this.promise, this.onFulfilled, e) }, i.prototype.callRejected = function (e) { v.reject(this.promise, e) }, i.prototype.otherCallRejected = function (e) { a(this.promise, this.onRejected, e) }, v.resolve = function (e, t) { var n = c(s, t); if (n.status === 'error') return v.reject(e, n.value); var r = n.value; if (r)u(e, r); else { e.state = _, e.outcome = t; for (var o = -1, i = e.queue.length; ++o < i;)e.queue[o].callFulfilled(t) } return e }, v.reject = function (e, t) { e.state = y, e.outcome = t; for (var n = -1, r = e.queue.length; ++n < r;)e.queue[n].callRejected(t); return e }, o.resolve = f, o.reject = l, o.all = d, o.race = h }, { immediate: 6 }],
  10: [function (e, t, n) { function r (e) { if (e = '' + e, !(e.length > 1e4)) { var t = /^((?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|years?|yrs?|y)?$/i.exec(e); if (t) { var n = parseFloat(t[1]); var r = (t[2] || 'ms').toLowerCase(); switch (r) { case 'years':case 'year':case 'yrs':case 'yr':case 'y':return n * l; case 'days':case 'day':case 'd':return n * f; case 'hours':case 'hour':case 'hrs':case 'hr':case 'h':return n * c; case 'minutes':case 'minute':case 'mins':case 'min':case 'm':return n * u; case 'seconds':case 'second':case 'secs':case 'sec':case 's':return n * s; case 'milliseconds':case 'millisecond':case 'msecs':case 'msec':case 'ms':return n } } } } function o (e) { return e >= f ? Math.round(e / f) + 'd' : e >= c ? Math.round(e / c) + 'h' : e >= u ? Math.round(e / u) + 'm' : e >= s ? Math.round(e / s) + 's' : e + 'ms' } function i (e) { return a(e, f, 'day') || a(e, c, 'hour') || a(e, u, 'minute') || a(e, s, 'second') || e + ' ms' } function a (e, t, n) { return t > e ? void 0 : 1.5 * t > e ? Math.floor(e / t) + ' ' + n : Math.ceil(e / t) + ' ' + n + 's' } var s = 1e3; var u = 60 * s; var c = 60 * u; var f = 24 * c; var l = 365.25 * f; t.exports = function (e, t) { return t = t || {}, typeof e === 'string' ? r(e) : t['long'] ? i(e) : o(e) } }, {}],
  11: [function (e, t, n) { 'use strict'; function r (e) { if (e !== null) switch (typeof e) { case 'boolean':return e ? 1 : 0; case 'number':return f(e); case 'string':return e.replace(/\u0002/g, '').replace(/\u0001/g, '').replace(/\u0000/g, ''); case 'object':var t = Array.isArray(e); var r = t ? e : Object.keys(e); var o = -1; var i = r.length; var a = ''; if (t) for (;++o < i;)a += n.toIndexableString(r[o]); else for (;++o < i;) { var s = r[o]; a += n.toIndexableString(s) + n.toIndexableString(e[s]) } return a } return '' } function o (e, t) { var n; var r = t; var o = e[t] === '1'; if (o)n = 0, t++; else { var i = e[t] === '0'; t++; var a = ''; var s = e.substring(t, t + d); var u = parseInt(s, 10) + l; for (i && (u = -u), t += d; ;) { var c = e[t]; if (c === '\x00') break; a += c, t++ }a = a.split('.'), n = a.length === 1 ? parseInt(a, 10) : parseFloat(a[0] + '.' + a[1]), i && (n -= 10), u !== 0 && (n = parseFloat(n + 'e' + u)) } return { num: n, length: t - r } } function i (e, t) { var n = e.pop(); if (t.length) { var r = t[t.length - 1]; n === r.element && (t.pop(), r = t[t.length - 1]); var o = r.element; var i = r.index; if (Array.isArray(o))o.push(n); else if (i === e.length - 2) { var a = e.pop(); o[a] = n } else e.push(n) } } function a (e, t) { for (var r = Math.min(e.length, t.length), o = 0; r > o; o++) { var i = n.collate(e[o], t[o]); if (i !== 0) return i } return e.length === t.length ? 0 : e.length > t.length ? 1 : -1 } function s (e, t) { return e === t ? 0 : e > t ? 1 : -1 } function u (e, t) { for (var r = Object.keys(e), o = Object.keys(t), i = Math.min(r.length, o.length), a = 0; i > a; a++) { var s = n.collate(r[a], o[a]); if (s !== 0) return s; if (s = n.collate(e[r[a]], t[o[a]]), s !== 0) return s } return r.length === o.length ? 0 : r.length > o.length ? 1 : -1 } function c (e) { var t = ['boolean', 'number', 'string', 'object']; var n = t.indexOf(typeof e); return ~n ? e === null ? 1 : Array.isArray(e) ? 5 : n < 3 ? n + 2 : n + 3 : Array.isArray(e) ? 5 : void 0 } function f (e) { if (e === 0) return '1'; var t = e.toExponential().split(/e\+?/); var n = parseInt(t[1], 10); var r = e < 0; var o = r ? '0' : '2'; var i = (r ? -n : n) - l; var a = p.padLeft(i.toString(), '0', d); o += h + a; var s = Math.abs(parseFloat(t[0])); r && (s = 10 - s); var u = s.toFixed(20); return u = u.replace(/\.?0+$/, ''), o += h + u } var l = -324; var d = 3; var h = ''; var p = e('./utils'); n.collate = function (e, t) { if (e === t) return 0; e = n.normalizeKey(e), t = n.normalizeKey(t); var r = c(e); var o = c(t); if (r - o !== 0) return r - o; if (e === null) return 0; switch (typeof e) { case 'number':return e - t; case 'boolean':return e === t ? 0 : t > e ? -1 : 1; case 'string':return s(e, t) } return Array.isArray(e) ? a(e, t) : u(e, t) }, n.normalizeKey = function (e) { switch (typeof e) { case 'undefined':return null; case 'number':return e === 1 / 0 || e === -(1 / 0) || isNaN(e) ? null : e; case 'object':var t = e; if (Array.isArray(e)) { var r = e.length; e = new Array(r); for (var o = 0; r > o; o++)e[o] = n.normalizeKey(t[o]) } else { if (e instanceof Date) return e.toJSON(); if (e !== null) { e = {}; for (var i in t) if (t.hasOwnProperty(i)) { var a = t[i]; typeof a !== 'undefined' && (e[i] = n.normalizeKey(a)) } } } } return e }, n.toIndexableString = function (e) { var t = '\x00'; return e = n.normalizeKey(e), c(e) + h + r(e) + t }, n.parseIndexableString = function (e) { for (var t = [], n = [], r = 0; ;) { var a = e[r++]; if (a !== '\x00') switch (a) { case '1':t.push(null); break; case '2':t.push(e[r] === '1'), r++; break; case '3':var s = o(e, r); t.push(s.num), r += s.length; break; case '4':for (var u = ''; ;) { var c = e[r]; if (c === '\x00') break; u += c, r++ }u = u.replace(/\u0001\u0001/g, '\x00').replace(/\u0001\u0002/g, '').replace(/\u0002\u0002/g, ''), t.push(u); break; case '5':var f = { element: [], index: t.length }; t.push(f.element), n.push(f); break; case '6':var l = { element: {}, index: t.length }; t.push(l.element), n.push(l); break; default:throw new Error('bad collationIndex or unexpectedly reached end of input: ' + a) } else { if (t.length === 1) return t.pop(); i(t, n) } } } }, { './utils': 12 }],
  12: [function (e, t, n) { 'use strict'; function r (e, t, n) { for (var r = '', o = n - e.length; r.length < o;)r += t; return r }n.padLeft = function (e, t, n) { var o = r(e, t, n); return o + e }, n.padRight = function (e, t, n) { var o = r(e, t, n); return e + o }, n.stringLexCompare = function (e, t) { var n; var r = e.length; var o = t.length; for (n = 0; r > n; n++) { if (n === o) return 1; var i = e.charAt(n); var a = t.charAt(n); if (i !== a) return a > i ? -1 : 1 } return o > r ? -1 : 0 }, n.intToDecimalForm = function (e) { var t = e < 0; var n = ''; do { var r = t ? -Math.ceil(e % 10) : Math.floor(e % 10); n = r + n, e = t ? Math.ceil(e / 10) : Math.floor(e / 10) } while (e);return t && n !== '0' && (n = '-' + n), n } }, {}],
  13: [function (e, t, n) { 'use strict'; function r () { this.store = {} } function o (e) { if (this.store = new r(), e && Array.isArray(e)) for (var t = 0, n = e.length; n > t; t++) this.add(e[t]) }n.Map = r, n.Set = o, r.prototype.mangle = function (e) { if (typeof e !== 'string') throw new TypeError('key must be a string but Got ' + e); return '$' + e }, r.prototype.unmangle = function (e) { return e.substring(1) }, r.prototype.get = function (e) { var t = this.mangle(e); return t in this.store ? this.store[t] : void 0 }, r.prototype.set = function (e, t) { var n = this.mangle(e); return this.store[n] = t, !0 }, r.prototype.has = function (e) { var t = this.mangle(e); return t in this.store }, r.prototype['delete'] = function (e) { var t = this.mangle(e); return t in this.store ? (delete this.store[t], !0) : !1 }, r.prototype.forEach = function (e) { for (var t = Object.keys(this.store), n = 0, r = t.length; r > n; n++) { var o = t[n]; var i = this.store[o]; o = this.unmangle(o), e(i, o) } }, o.prototype.add = function (e) { return this.store.set(e, !0) }, o.prototype.has = function (e) { return this.store.has(e) }, o.prototype['delete'] = function (e) { return this.store['delete'](e) } }, {}],
  14: [function (e, t, n) { 'use strict'; function r (e) { return e && typeof e === 'object' && 'default' in e ? e['default'] : e } function o (e) { Error.call(this, e.reason), this.status = e.status, this.name = e.error, this.message = e.reason, this.error = !0 } function i (e, t, n) { function r (t) { for (var r in e) typeof e[r] !== 'function' && (this[r] = e[r]); void 0 !== n && (this.name = n), void 0 !== t && (this.reason = t) } return r.prototype = o.prototype, new r(t) } function a (e) { var t, n, r, o, a; return n = e.error === !0 && typeof e.name === 'string' ? e.name : e.error, a = e.reason, r = L('name', n, a), e.missing || a === 'missing' || a === 'deleted' || n === 'not_found' ? r = f : n === 'doc_validation' ? (r = b, o = a) : n === 'bad_request' && r.message !== a && (r = w), r || (r = L('status', e.status, a) || y), t = i(r, a, n), o && (t.message = o), e.id && (t.id = e.id), e.status && (t.status = e.status), e.missing && (t.missing = e.missing), t }Object.defineProperty(n, '__esModule', { value: !0 }); var s = r(e('inherits')); s(o, Error), o.prototype.toString = function () { return JSON.stringify({ status: this.status, name: this.name, message: this.message, reason: this.reason }) }; var u = new o({ status: 401, error: 'unauthorized', reason: 'Name or password is incorrect.' }); var c = new o({ status: 400, error: 'bad_request', reason: "Missing JSON list of 'docs'" }); var f = new o({ status: 404, error: 'not_found', reason: 'missing' }); var l = new o({ status: 409, error: 'conflict', reason: 'Document update conflict' }); var d = new o({ status: 400, error: 'invalid_id', reason: '_id field must contain a string' }); var h = new o({ status: 412, error: 'missing_id', reason: '_id is required for puts' }); var p = new o({ status: 400, error: 'bad_request', reason: 'Only reserved document ids may start with underscore.' }); var v = new o({ status: 412, error: 'precondition_failed', reason: 'Database not open' }); var y = new o({ status: 500, error: 'unknown_error', reason: 'Database encountered an unknown error' }); var _ = new o({ status: 500, error: 'badarg', reason: 'Some query argument is invalid' }); var m = new o({ status: 400, error: 'invalid_request', reason: 'Request was invalid' }); var g = new o({ status: 400, error: 'query_parse_error', reason: 'Some query parameter is invalid' }); var b = new o({ status: 500, error: 'doc_validation', reason: 'Bad special document member' }); var w = new o({ status: 400, error: 'bad_request', reason: 'Something wrong with the request' }); var E = new o({ status: 400, error: 'bad_request', reason: 'Document must be a JSON object' }); var S = new o({ status: 404, error: 'not_found', reason: 'Database not found' }); var k = new o({ status: 500, error: 'indexed_db_went_bad', reason: 'unknown' }); var q = new o({ status: 500, error: 'web_sql_went_bad', reason: 'unknown' }); var x = new o({ status: 500, error: 'levelDB_went_went_bad', reason: 'unknown' }); var A = new o({ status: 403, error: 'forbidden', reason: 'Forbidden by design doc validate_doc_update function' }); var T = new o({ status: 400, error: 'bad_request', reason: 'Invalid rev format' }); var O = new o({ status: 412, error: 'file_exists', reason: 'The database could not be created, the file already exists.' }); var j = new o({ status: 412, error: 'missing_stub' }); var I = new o({ status: 413, error: 'invalid_url', reason: 'Provided URL is invalid' }); var C = [u, c, f, l, d, h, p, v, y, _, m, g, b, w, E, S, q, x, A, T, O, j, k, I]; var L = function (e, t, n) { var r = C.filter(function (n) { return n[e] === t }); return n && r.filter(function (e) { return e.message === n })[0] || r[0] }; n.UNAUTHORIZED = u, n.MISSING_BULK_DOCS = c, n.MISSING_DOC = f, n.REV_CONFLICT = l, n.INVALID_ID = d, n.MISSING_ID = h, n.RESERVED_ID = p, n.NOT_OPEN = v, n.UNKNOWN_ERROR = y, n.BAD_ARG = _, n.INVALID_REQUEST = m, n.QUERY_PARSE_ERROR = g, n.DOC_VALIDATION = b, n.BAD_REQUEST = w, n.NOT_AN_OBJECT = E, n.DB_MISSING = S, n.WSQ_ERROR = q, n.LDB_ERROR = x, n.FORBIDDEN = A, n.INVALID_REV = T, n.FILE_EXISTS = O, n.MISSING_STUB = j, n.IDB_ERROR = k, n.INVALID_URL = I, n.getErrorTypeByProp = L, n.createError = i, n.generateErrorFromResponse = a }, { inherits: 7 }],
  15: [function (e, t, n) { 'use strict'; function r (e) { return e && typeof e === 'object' && 'default' in e ? e['default'] : e } var o = r(e('lie')); var i = typeof Promise === 'function' ? Promise : o; t.exports = i }, { lie: 9 }],
  16: [function (e, t, n) { (function (t) { 'use strict'; function r (e) { return e && typeof e === 'object' && 'default' in e ? e['default'] : e } function o (e) { return e instanceof ArrayBuffer || typeof Blob !== 'undefined' && e instanceof Blob } function i (e) { if (typeof e.slice === 'function') return e.slice(0); var t = new ArrayBuffer(e.byteLength); var n = new Uint8Array(t); var r = new Uint8Array(e); return n.set(r), t } function a (e) { if (e instanceof ArrayBuffer) return i(e); var t = e.size; var n = e.type; return typeof e.slice === 'function' ? e.slice(0, t, n) : e.webkitSlice(0, t, n) } function s (e) { var t = Object.getPrototypeOf(e); if (t === null) return !0; var n = t.constructor; return typeof n === 'function' && n instanceof n && V.call(n) == z } function u (e) { var t, n, r; if (!e || typeof e !== 'object') return e; if (Array.isArray(e)) { for (t = [], n = 0, r = e.length; r > n; n++)t[n] = u(e[n]); return t } if (e instanceof Date) return e.toISOString(); if (o(e)) return a(e); if (!s(e)) return e; t = {}; for (n in e) if (Object.prototype.hasOwnProperty.call(e, n)) { var i = u(e[n]); typeof i !== 'undefined' && (t[n] = i) } return t } function c (e) { var t = !1; return H(function (n) { if (t) throw new Error('once called more than once'); t = !0, e.apply(this, n) }) } function f (e) { return H(function (n) { n = u(n); var r; var o = this; var i = typeof n[n.length - 1] === 'function' ? n.pop() : !1; i && (r = function (e, n) { t.nextTick(function () { i(e, n) }) }); var a = new P(function (t, r) { var i; try { var a = c(function (e, n) { e ? r(e) : t(n) }); n.push(a), i = e.apply(o, n), i && typeof i.then === 'function' && t(i) } catch (s) { r(s) } }); return r && a.then(function (e) { r(null, e) }, r), a }) } function l (e, t) { function n (e, t, n) { if (X.enabled) { for (var r = [e._db_name, t], o = 0; o < n.length - 1; o++)r.push(n[o]); X.apply(null, r); var i = n[n.length - 1]; n[n.length - 1] = function (n, r) { var o = [e._db_name, t]; o = o.concat(n ? ['error', n] : ['success', r]), X.apply(null, o), i(n, r) } } } return f(H(function (r) { if (this._closed) return P.reject(new Error('database is closed')); if (this._destroyed) return P.reject(new Error('database is destroyed')); var o = this; return n(o, e, r), this.taskqueue.isReady ? t.apply(this, r) : new P(function (t, n) { o.taskqueue.addTask(function (i) { i ? n(i) : t(o[e].apply(o, r)) }) }) })) } function d (e, t) { for (var n = {}, r = 0, o = t.length; o > r; r++) { var i = t[r]; i in e && (n[i] = e[i]) } return n } function h (e) { return e } function p (e) { return [{ ok: e }] } function v (e, t, n) { function r () { var e = []; v.forEach(function (t) { t.docs.forEach(function (n) { e.push({ id: t.id, docs: [n] }) }) }), n(null, { results: e }) } function o () { ++l === f && r() } function i (e, t, n) { v[e] = { id: t, docs: n }, o() } function a () { if (!(_ >= y.length)) { var e = Math.min(_ + Q, y.length); var t = y.slice(_, e); s(t, _), _ += t.length } } function s (n, r) { n.forEach(function (n, o) { var s = r + o; var u = c[n]; var f = d(u[0], ['atts_since', 'attachments']); f.open_revs = u.map(function (e) { return e.rev }), f.open_revs = f.open_revs.filter(h); var l = h; f.open_revs.length === 0 && (delete f.open_revs, l = p), ['revs', 'attachments', 'binary', 'ajax'].forEach(function (e) { e in t && (f[e] = t[e]) }), e.get(n, f, function (e, t) { var r; r = e ? [{ error: e }] : l(t), i(s, n, r), a() }) }) } var u = t.docs; var c = {}; u.forEach(function (e) { e.id in c ? c[e.id].push(e) : c[e.id] = [e] }); var f = Object.keys(c).length; var l = 0; var v = new Array(f); var y = Object.keys(c); var _ = 0; a() } function y () { return typeof chrome !== 'undefined' && typeof chrome.storage !== 'undefined' && typeof chrome.storage.local !== 'undefined' } function _ () { return U } function m (e) { y() ? chrome.storage.onChanged.addListener(function (t) { t.db_name != null && e.emit(t.dbName.newValue) }) : _() && (typeof addEventListener !== 'undefined' ? addEventListener('storage', function (t) { e.emit(t.key) }) : window.attachEvent('storage', function (t) { e.emit(t.key) })) } function g () { K.EventEmitter.call(this), this._listeners = {}, m(this) } function b (e) { if (console !== 'undefined' && e in console) { var t = Array.prototype.slice.call(arguments, 1); console[e].apply(console, t) } } function w (e, t) { var n = 6e5; e = parseInt(e, 10) || 0, t = parseInt(t, 10), t !== t || e >= t ? t = (e || 1) << 1 : t += 1, t > n && (e = n >> 1, t = n); var r = Math.random(); var o = t - e; return ~~(o * r + e) } function E (e) { var t = 0; return e || (t = 2e3), w(e, t) } function S (e, t) { b('info', 'The above ' + e + ' is totally normal. ' + t) } function k (e, t) { for (var n in t) if (t.hasOwnProperty(n)) { var r = u(t[n]); typeof r !== 'undefined' && (e[n] = r) } } function q (e, t, n) { return k(e, t), n && k(e, n), e } function x (e, t, n) { try { return !e(t, n) } catch (r) { var o = 'Filter function threw: ' + r.toString(); return G.createError(G.BAD_REQUEST, o) } } function A (e) { var t = {}; var n = e.filter && typeof e.filter === 'function'; return t.query = e.query_params, function (r) { r.doc || (r.doc = {}); var o = n && x(e.filter, r.doc, t); if (typeof o === 'object') return o; if (o) return !1; if (e.include_docs) { if (!e.attachments) for (var i in r.doc._attachments)r.doc._attachments.hasOwnProperty(i) && (r.doc._attachments[i].stub = !0) } else delete r.doc; return !0 } } function T (e) { for (var t = [], n = 0, r = e.length; r > n; n++)t = t.concat(e[n]); return t } function O () {} function j (e) { var t; if (e ? typeof e !== 'string' ? t = G.createError(G.INVALID_ID) : /^_/.test(e) && !/^_(design|local)/.test(e) && (t = G.createError(G.RESERVED_ID)) : t = G.createError(G.MISSING_ID), t) throw t } function I () { return typeof cordova !== 'undefined' || typeof PhoneGap !== 'undefined' || typeof phonegap !== 'undefined' } function C (e, t) { return 'listenerCount' in e ? e.listenerCount(t) : K.EventEmitter.listenerCount(e, t) } function L (e) { if (!e) return null; var t = e.split('/'); return t.length === 2 ? t : t.length === 1 ? [e, e] : null } function D (e) { var t = L(e); return t ? t.join('/') : null } function R (e) { for (var t = oe.exec(e), n = {}, r = 14; r--;) { var o = te[r]; var i = t[r] || ''; var a = ['user', 'password'].indexOf(o) !== -1; n[o] = a ? decodeURIComponent(i) : i } return n[ne] = {}, n[te[12]].replace(re, function (e, t, r) { t && (n[ne][t] = r) }), n } function N (e, t, n) { return new P(function (r, o) { e.get(t, function (i, a) { if (i) { if (i.status !== 404) return o(i); a = {} } var s = a._rev; var u = n(a); return u ? (u._id = t, u._rev = s, void r(B(e, u, n))) : r({ updated: !1, rev: s }) }) }) } function B (e, t, n) { return e.put(t).then(function (e) { return { updated: !0, rev: e.rev } }, function (r) { if (r.status !== 409) throw r; return N(e, t._id, n) }) } function M (e) { return 0 | Math.random() * e } function F (e, t) { t = t || ie.length; var n = ''; var r = -1; if (e) { for (;++r < e;)n += ie[M(t)]; return n } for (;++r < 36;) switch (r) { case 8:case 13:case 18:case 23:n += '-'; break; case 19:n += ie[3 & M(16) | 8]; break; default:n += ie[M(16)] } return n }Object.defineProperty(n, '__esModule', { value: !0 }); var U; var P = r(e('pouchdb-promise')); var H = r(e('argsarray')); var J = r(e('debug')); var K = e('events'); var W = r(e('inherits')); var G = e('pouchdb-errors'); var V = Function.prototype.toString; var z = V.call(Object); var X = J('pouchdb:api'); var Q = 6; if (y())U = !1; else try { localStorage.setItem('_pouch_check_localstorage', 1), U = !!localStorage.getItem('_pouch_check_localstorage') } catch ($) { U = !1 }W(g, K.EventEmitter), g.prototype.addListener = function (e, t, n, r) { function o () { function e () { a = !1 } if (i._listeners[t]) { if (a) return void (a = 'waiting'); a = !0; var s = d(r, ['style', 'include_docs', 'attachments', 'conflicts', 'filter', 'doc_ids', 'view', 'since', 'query_params', 'binary']); n.changes(s).on('change', function (e) { e.seq > r.since && !r.cancelled && (r.since = e.seq, r.onChange(e)) }).on('complete', function () { a === 'waiting' && setTimeout(function () { o() }, 0), a = !1 }).on('error', e) } } if (!this._listeners[t]) { var i = this; var a = !1; this._listeners[t] = o, this.on(e, o) } }, g.prototype.removeListener = function (e, t) { t in this._listeners && K.EventEmitter.prototype.removeListener.call(this, e, this._listeners[t]) }, g.prototype.notifyLocalWindows = function (e) { y() ? chrome.storage.local.set({ dbName: e }) : _() && (localStorage[e] = localStorage[e] === 'a' ? 'b' : 'a') }, g.prototype.notify = function (e) { this.emit(e), this.notifyLocalWindows(e) }; var Y; var Z = O.name; Y = Z ? function (e) { return e.name } : function (e) { return e.toString().match(/^\s*function\s*(\S*)\s*\(/)[1] }; var ee = Y; var te = ['source', 'protocol', 'authority', 'userInfo', 'user', 'password', 'host', 'port', 'relative', 'path', 'directory', 'file', 'query', 'anchor']; var ne = 'queryKey'; var re = /(?:^|&)([^&=]*)=?([^&]*)/g; var oe = /^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/; var ie = '0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz'.split(''); n.adapterFun = l, n.bulkGetShim = v, n.changesHandler = g, n.clone = u, n.defaultBackOff = E, n.explainError = S, n.extend = q, n.filterChange = A, n.flatten = T, n.functionName = ee, n.guardedConsole = b, n.hasLocalStorage = _, n.invalidIdError = j, n.isChromeApp = y, n.isCordova = I, n.listenerCount = C, n.normalizeDdocFunctionName = D, n.once = c, n.parseDdocFunctionName = L, n.parseUri = R, n.pick = d, n.toPromise = f, n.upsert = N, n.uuid = F }).call(this, e('_process')) }, { _process: 18, argsarray: 2, debug: 3, events: 5, inherits: 7, 'pouchdb-errors': 14, 'pouchdb-promise': 15 }],
  17: [function (e, t, n) {
    (function (n, r) {
      'use strict'; function o (e) { return e && typeof e === 'object' && 'default' in e ? e['default'] : e } function i (e) { return e instanceof ArrayBuffer || typeof Blob !== 'undefined' && e instanceof Blob } function a (e) { if (typeof e.slice === 'function') return e.slice(0); var t = new ArrayBuffer(e.byteLength); var n = new Uint8Array(t); var r = new Uint8Array(e); return n.set(r), t } function s (e) { if (e instanceof ArrayBuffer) return a(e); var t = e.size; var n = e.type; return typeof e.slice === 'function' ? e.slice(0, t, n) : e.webkitSlice(0, t, n) } function u (e) { var t = Object.getPrototypeOf(e); if (t === null) return !0; var n = t.constructor; return typeof n === 'function' && n instanceof n && xr.call(n) == Ar } function c (e) { var t, n, r; if (!e || typeof e !== 'object') return e; if (Array.isArray(e)) { for (t = [], n = 0, r = e.length; r > n; n++)t[n] = c(e[n]); return t } if (e instanceof Date) return e.toISOString(); if (i(e)) return s(e); if (!u(e)) return e; t = {}; for (n in e) if (Object.prototype.hasOwnProperty.call(e, n)) { var o = c(e[n]); typeof o !== 'undefined' && (t[n] = o) } return t } function f (e) { var t = !1; return gr(function (n) { if (t) throw new Error('once called more than once'); t = !0, e.apply(this, n) }) } function l (e) { return gr(function (t) { t = c(t); var r; var o = this; var i = typeof t[t.length - 1] === 'function' ? t.pop() : !1; i && (r = function (e, t) { n.nextTick(function () { i(e, t) }) }); var a = new qr(function (n, r) { var i; try { var a = f(function (e, t) { e ? r(e) : n(t) }); t.push(a), i = e.apply(o, t), i && typeof i.then === 'function' && n(i) } catch (s) { r(s) } }); return r && a.then(function (e) { r(null, e) }, r), a }) } function d (e, t) {
        function n (e, t, n) {
          if (Tr.enabled) {
            for (var r = [e._db_name, t], o = 0; o < n.length - 1; o++)r.push(n[o]); Tr.apply(null, r); var i = n[n.length - 1]; n[n.length - 1] = function (n, r) {
              var o = [e._db_name, t]; o = o.concat(n ? ['error', n] : ['success', r]), Tr.apply(null, o), i(n, r)
            }
          }
        } return l(gr(function (r) { if (this._closed) return qr.reject(new Error('database is closed')); if (this._destroyed) return qr.reject(new Error('database is destroyed')); var o = this; return n(o, e, r), this.taskqueue.isReady ? t.apply(this, r) : new qr(function (t, n) { o.taskqueue.addTask(function (i) { i ? n(i) : t(o[e].apply(o, r)) }) }) }))
      } function h (e, t) { for (var n = {}, r = 0, o = t.length; o > r; r++) { var i = t[r]; i in e && (n[i] = e[i]) } return n } function p (e) { return e } function v (e) { return [{ ok: e }] } function y (e, t, n) { function r () { var e = []; d.forEach(function (t) { t.docs.forEach(function (n) { e.push({ id: t.id, docs: [n] }) }) }), n(null, { results: e }) } function o () { ++l === f && r() } function i (e, t, n) { d[e] = { id: t, docs: n }, o() } function a () { if (!(_ >= y.length)) { var e = Math.min(_ + Or, y.length); var t = y.slice(_, e); s(t, _), _ += t.length } } function s (n, r) { n.forEach(function (n, o) { var s = r + o; var u = c[n]; var f = h(u[0], ['atts_since', 'attachments']); f.open_revs = u.map(function (e) { return e.rev }), f.open_revs = f.open_revs.filter(p); var l = p; f.open_revs.length === 0 && (delete f.open_revs, l = v), ['revs', 'attachments', 'binary', 'ajax'].forEach(function (e) { e in t && (f[e] = t[e]) }), e.get(n, f, function (e, t) { var r; r = e ? [{ error: e }] : l(t), i(s, n, r), a() }) }) } var u = t.docs; var c = {}; u.forEach(function (e) { e.id in c ? c[e.id].push(e) : c[e.id] = [e] }); var f = Object.keys(c).length; var l = 0; var d = new Array(f); var y = Object.keys(c); var _ = 0; a() } function _ () { return typeof chrome !== 'undefined' && typeof chrome.storage !== 'undefined' && typeof chrome.storage.local !== 'undefined' } function m () { return hr } function g (e) { _() ? chrome.storage.onChanged.addListener(function (t) { t.db_name != null && e.emit(t.dbName.newValue) }) : m() && (typeof addEventListener !== 'undefined' ? addEventListener('storage', function (t) { e.emit(t.key) }) : window.attachEvent('storage', function (t) { e.emit(t.key) })) } function b () { br.EventEmitter.call(this), this._listeners = {}, g(this) } function w (e) { if (console !== 'undefined' && e in console) { var t = Array.prototype.slice.call(arguments, 1); console[e].apply(console, t) } } function E (e, t) { var n = 6e5; e = parseInt(e, 10) || 0, t = parseInt(t, 10), t !== t || e >= t ? t = (e || 1) << 1 : t += 1, t > n && (e = n >> 1, t = n); var r = Math.random(); var o = t - e; return ~~(o * r + e) } function S (e) { var t = 0; return e || (t = 2e3), E(e, t) } function k (e, t) { w('info', 'The above ' + e + ' is totally normal. ' + t) } function q (e) { Error.call(this, e.reason), this.status = e.status, this.name = e.error, this.message = e.reason, this.error = !0 } function x (e, t, n) { function r (t) { for (var r in e) typeof e[r] !== 'function' && (this[r] = e[r]); void 0 !== n && (this.name = n), void 0 !== t && (this.reason = t) } return r.prototype = q.prototype, new r(t) } function A (e) { var t, n, r, o, i; return n = e.error === !0 && typeof e.name === 'string' ? e.name : e.error, i = e.reason, r = no('name', n, i), e.missing || i === 'missing' || i === 'deleted' || n === 'not_found' ? r = Lr : n === 'doc_validation' ? (r = Jr, o = i) : n === 'bad_request' && r.message !== i && (r = Kr), r || (r = no('status', e.status, i) || Fr), t = x(r, i, n), o && (t.message = o), e.id && (t.id = e.id), e.status && (t.status = e.status), e.missing && (t.missing = e.missing), t } function T (e, t, n) { try { return !e(t, n) } catch (r) { var o = 'Filter function threw: ' + r.toString(); return x(Kr, o) } } function O (e) { var t = {}; var n = e.filter && typeof e.filter === 'function'; return t.query = e.query_params, function (r) { r.doc || (r.doc = {}); var o = n && T(e.filter, r.doc, t); if (typeof o === 'object') return o; if (o) return !1; if (e.include_docs) { if (!e.attachments) for (var i in r.doc._attachments)r.doc._attachments.hasOwnProperty(i) && (r.doc._attachments[i].stub = !0) } else delete r.doc; return !0 } } function j (e) { for (var t = [], n = 0, r = e.length; r > n; n++)t = t.concat(e[n]); return t } function I (e) { var t; if (e ? typeof e !== 'string' ? t = x(Rr) : /^_/.test(e) && !/^_(design|local)/.test(e) && (t = x(Br)) : t = x(Nr), t) throw t } function C (e, t) { return 'listenerCount' in e ? e.listenerCount(t) : br.EventEmitter.listenerCount(e, t) } function L (e) { if (!e) return null; var t = e.split('/'); return t.length === 2 ? t : t.length === 1 ? [e, e] : null } function D (e) { var t = L(e); return t ? t.join('/') : null } function R (e) { for (var t = ao.exec(e), n = {}, r = 14; r--;) { var o = ro[r]; var i = t[r] || ''; var a = ['user', 'password'].indexOf(o) !== -1; n[o] = a ? decodeURIComponent(i) : i } return n[oo] = {}, n[ro[12]].replace(io, function (e, t, r) { t && (n[oo][t] = r) }), n } function N (e, t, n) { return new qr(function (r, o) { e.get(t, function (i, a) { if (i) { if (i.status !== 404) return o(i); a = {} } var s = a._rev; var u = n(a); return u ? (u._id = t, u._rev = s, void r(B(e, u, n))) : r({ updated: !1, rev: s }) }) }) } function B (e, t, n) { return e.put(t).then(function (e) { return { updated: !0, rev: e.rev } }, function (r) { if (r.status !== 409) throw r; return N(e, t._id, n) }) } function M (e) { return 0 | Math.random() * e } function F (e, t) { t = t || so.length; var n = ''; var r = -1; if (e) { for (;++r < e;)n += so[M(t)]; return n } for (;++r < 36;) switch (r) { case 8:case 13:case 18:case 23:n += '-'; break; case 19:n += so[3 & M(16) | 8]; break; default:n += so[M(16)] } return n } function U (e) { for (var t, n, r, o, i = e.rev_tree.slice(); o = i.pop();) { var a = o.ids; var s = a[2]; var u = o.pos; if (s.length) for (var c = 0, f = s.length; f > c; c++)i.push({ pos: u + 1, ids: s[c] }); else { var l = !!a[1].deleted; var d = a[0]; t && !(r !== l ? r : n !== u ? u > n : d > t) || (t = d, n = u, r = l) } } return n + '-' + t } function P (e, t) { for (var n, r = e.slice(); n = r.pop();) for (var o = n.pos, i = n.ids, a = i[2], s = t(a.length === 0, o, i[0], n.ctx, i[1]), u = 0, c = a.length; c > u; u++)r.push({ pos: o + 1, ids: a[u], ctx: s }) } function H (e, t) { return e.pos - t.pos } function J (e) { var t = []; P(e, function (e, n, r, o, i) { e && t.push({ rev: n + '-' + r, pos: n, opts: i }) }), t.sort(H).reverse(); for (var n = 0, r = t.length; r > n; n++) delete t[n].pos; return t } function K (e) { for (var t = U(e), n = J(e.rev_tree), r = [], o = 0, i = n.length; i > o; o++) { var a = n[o]; a.rev === t || a.opts.deleted || r.push(a.rev) } return r } function W (e) { var t = []; return P(e.rev_tree, function (e, n, r, o, i) { i.status !== 'available' || e || (t.push(n + '-' + r), i.status = 'missing') }), t } function G (e) { for (var t, n = [], r = e.slice(); t = r.pop();) { var o = t.pos; var i = t.ids; var a = i[0]; var s = i[1]; var u = i[2]; var c = u.length === 0; var f = t.history ? t.history.slice() : []; f.push({ id: a, opts: s }), c && n.push({ pos: o + 1 - f.length, ids: f }); for (var l = 0, d = u.length; d > l; l++)r.push({ pos: o + 1, ids: u[l], history: f }) } return n.reverse() } function V (e, t) { return e.pos - t.pos } function z (e, t, n) { for (var r, o = 0, i = e.length; i > o;)r = o + i >>> 1, n(e[r], t) < 0 ? o = r + 1 : i = r; return o } function X (e, t, n) { var r = z(e, t, n); e.splice(r, 0, t) } function Q (e, t) { for (var n, r, o = t, i = e.length; i > o; o++) { var a = e[o]; var s = [a.id, a.opts, []]; r ? (r[2].push(s), r = s) : n = r = s } return n } function $ (e, t) { return e[0] < t[0] ? -1 : 1 } function Y (e, t) { for (var n = [{ tree1: e, tree2: t }], r = !1; n.length > 0;) { var o = n.pop(); var i = o.tree1; var a = o.tree2; (i[1].status || a[1].status) && (i[1].status = i[1].status === 'available' || a[1].status === 'available' ? 'available' : 'missing'); for (var s = 0; s < a[2].length; s++) if (i[2][0]) { for (var u = !1, c = 0; c < i[2].length; c++)i[2][c][0] === a[2][s][0] && (n.push({ tree1: i[2][c], tree2: a[2][s] }), u = !0); u || (r = 'new_branch', X(i[2], a[2][s], $)) } else r = 'new_leaf', i[2][0] = a[2][s] } return { conflicts: r, tree: e } } function Z (e, t, n) { var r; var o = []; var i = !1; var a = !1; if (!e.length) return { tree: [t], conflicts: 'new_leaf' }; for (var s = 0, u = e.length; u > s; s++) { var c = e[s]; if (c.pos === t.pos && c.ids[0] === t.ids[0])r = Y(c.ids, t.ids), o.push({ pos: c.pos, ids: r.tree }), i = i || r.conflicts, a = !0; else if (n !== !0) { var f = c.pos < t.pos ? c : t; var l = c.pos < t.pos ? t : c; var d = l.pos - f.pos; var h = []; var p = []; for (p.push({ ids: f.ids, diff: d, parent: null, parentIdx: null }); p.length > 0;) { var v = p.pop(); if (v.diff !== 0) for (var y = v.ids[2], _ = 0, m = y.length; m > _; _++)p.push({ ids: y[_], diff: v.diff - 1, parent: v.ids, parentIdx: _ }); else v.ids[0] === l.ids[0] && h.push(v) } var g = h[0]; g ? (r = Y(g.ids, l.ids), g.parent[2][g.parentIdx] = r.tree, o.push({ pos: f.pos, ids: f.ids }), i = i || r.conflicts, a = !0) : o.push(c) } else o.push(c) } return a || o.push(t), o.sort(V), { tree: o, conflicts: i || 'internal_node' } } function ee (e, t) { for (var n, r = G(e), o = {}, i = 0, a = r.length; a > i; i++) { for (var s = r[i], u = s.ids, c = Math.max(0, u.length - t), f = { pos: s.pos + c, ids: Q(u, c) }, l = 0; c > l; l++) { var d = s.pos + l + '-' + u[l].id; o[d] = !0 }n = n ? Z(n, f, !0).tree : [f] } return P(n, function (e, t, n) { delete o[t + '-' + n] }), { tree: n, revs: Object.keys(o) } } function te (e, t, n) { var r = Z(e, t); var o = ee(r.tree, n); return { tree: o.tree, stemmedRevs: o.revs, conflicts: r.conflicts } } function ne (e, t) { for (var n, r = e.slice(), o = t.split('-'), i = parseInt(o[0], 10), a = o[1]; n = r.pop();) { if (n.pos === i && n.ids[0] === a) return !0; for (var s = n.ids[2], u = 0, c = s.length; c > u; u++)r.push({ pos: n.pos + 1, ids: s[u] }) } return !1 } function re (e) { return e.ids } function oe (e, t) { t || (t = U(e)); for (var n, r = t.substring(t.indexOf('-') + 1), o = e.rev_tree.map(re); n = o.pop();) { if (n[0] === r) return !!n[1].deleted; o = o.concat(n[2]) } } function ie (e) { return /^_local/.test(e) } function ae (e) { return wr('return ' + e + ';', {}) } function se (e) { return new Function('doc', ['var emitted = false;', 'var emit = function (a, b) {', '  emitted = true;', '};', 'var view = ' + e + ';', 'view(doc);', 'if (emitted) {', '  return true;', '}'].join('\n')) } function ue (e, t) { try { e.emit('change', t) } catch (n) { w('error', 'Error in .on("change", function):', n) } } function ce (e, t, n) { function r () { o.cancel() }br.EventEmitter.call(this); var o = this; this.db = e, t = t ? c(t) : {}; var i = t.complete = f(function (t, n) { t ? C(o, 'error') > 0 && o.emit('error', t) : o.emit('complete', n), o.removeAllListeners(), e.removeListener('destroyed', r) }); n && (o.on('complete', function (e) { n(null, e) }), o.on('error', n)), e.once('destroyed', r), t.onChange = function (e) { t.isCancelled || (ue(o, e), o.startSeq && o.startSeq <= e.seq && (o.startSeq = !1)) }; var a = new qr(function (e, n) { t.complete = function (t, r) { t ? n(t) : e(r) } }); o.once('cancel', function () { e.removeListener('destroyed', r), t.complete(null, { status: 'cancelled' }) }), this.then = a.then.bind(a), this['catch'] = a['catch'].bind(a), this.then(function (e) { i(null, e) }, i), e.taskqueue.isReady ? o.doChanges(t) : e.taskqueue.addTask(function () { o.isCancelled ? o.emit('cancel') : o.doChanges(t) }) } function fe (e, t, n) { var r = [{ rev: e._rev }]; n.style === 'all_docs' && (r = J(t.rev_tree).map(function (e) { return { rev: e.rev } })); var o = { id: t.id, changes: r, doc: e }; return oe(t, e._rev) && (o.deleted = !0), n.conflicts && (o.doc._conflicts = K(t), o.doc._conflicts.length || delete o.doc._conflicts), o } function le (e, t) { return t > e ? -1 : e > t ? 1 : 0 } function de (e, t) { for (var n = 0; n < e.length; n++) if (t(e[n], n) === !0) return e[n] } function he (e) { return function (t, n) { t || n[0] && n[0].error ? e(t || n[0]) : e(null, n.length ? n[0] : n) } } function pe (e) { for (var t = 0; t < e.length; t++) { var n = e[t]; if (n._deleted) delete n._attachments; else if (n._attachments) for (var r = Object.keys(n._attachments), o = 0; o < r.length; o++) { var i = r[o]; n._attachments[i] = h(n._attachments[i], ['data', 'digest', 'content_type', 'length', 'revpos', 'stub']) } } } function ve (e, t) { var n = le(e._id, t._id); if (n !== 0) return n; var r = e._revisions ? e._revisions.start : 0; var o = t._revisions ? t._revisions.start : 0; return le(r, o) } function ye (e) { var t = {}; var n = []; return P(e, function (e, r, o, i) { var a = r + '-' + o; return e && (t[a] = 0), void 0 !== i && n.push({ from: i, to: a }), a }), n.reverse(), n.forEach(function (e) { void 0 === t[e.from] ? t[e.from] = 1 + t[e.to] : t[e.from] = Math.min(t[e.from], 1 + t[e.to]) }), t } function _e (e, t, n) { var r = 'limit' in t ? t.keys.slice(t.skip, t.limit + t.skip) : t.skip > 0 ? t.keys.slice(t.skip) : t.keys; if (t.descending && r.reverse(), !r.length) return e._allDocs({ limit: 0 }, n); var o = { offset: t.skip }; return qr.all(r.map(function (n) { var r = pr.extend({ key: n, deleted: 'ok' }, t); return ['limit', 'skip', 'keys'].forEach(function (e) { delete r[e] }), new qr(function (t, i) { e._allDocs(r, function (e, r) { return e ? i(e) : (o.total_rows = r.total_rows, void t(r.rows[0] || { key: n, error: 'not_found' })) }) }) })).then(function (e) { return o.rows = e, o }) } function me (e) { var t = e._compactionQueue[0]; var r = t.opts; var o = t.callback; e.get('_local/compaction')['catch'](function () { return !1 }).then(function (t) { t && t.last_seq && (r.last_seq = t.last_seq), e._compact(r, function (t, r) { t ? o(t) : o(null, r), n.nextTick(function () { e._compactionQueue.shift(), e._compactionQueue.length && me(e) }) }) }) } function ge (e) { return e.charAt(0) === '_' ? e + "is not a valid attachment name, attachment names cannot start with '_'" : !1 } function be () { br.EventEmitter.call(this) } function we () { this.isReady = !1, this.failed = !1, this.queue = [] } function Ee (e) { e && r.debug && w('error', e) } function Se (e, t) { function n () { i.emit('destroyed', o) } function r () { e.removeListener('destroyed', n), e.emit('destroyed', e) } var o = t.originalName; var i = e.constructor; var a = i._destructionListeners; e.once('destroyed', n), a.has(o) || a.set(o, []), a.get(o).push(r) } function ke (e, t, n) { if (!(this instanceof ke)) return new ke(e, t, n); var r = this; if (typeof t !== 'function' && typeof t !== 'undefined' || (n = t, t = {}), e && typeof e === 'object' && (t = e, e = void 0), typeof n === 'undefined')n = Ee; else { var o = n; n = function () { return w('warn', 'Using a callback for new PouchDB()is deprecated.'), o.apply(null, arguments) } }e = e || t.name, t = c(t), delete t.name, this.__opts = t; var i = n; r.auto_compaction = t.auto_compaction, r.prefix = ke.prefix, be.call(r), r.taskqueue = new we(); var a = new qr(function (o, i) { n = function (e, t) { return e ? i(e) : (delete t.then, void o(t)) }, t = c(t); var a, s; return (function () { try { if (typeof e !== 'string') throw s = new Error('Missing/invalid DB name'), s.code = 400, s; var n = (t.prefix || '') + e; if (a = ke.parseAdapter(n, t), t.originalName = e, t.name = a.name, t.adapter = t.adapter || a.adapter, r._adapter = t.adapter, vr('pouchdb:adapter')('Picked adapter: ' + t.adapter), r._db_name = e, !ke.adapters[t.adapter]) throw s = new Error('Adapter is missing'), s.code = 404, s; if (!ke.adapters[t.adapter].valid()) throw s = new Error('Invalid Adapter'), s.code = 404, s } catch (o) { r.taskqueue.fail(o) } }()), s ? i(s) : (r.adapter = t.adapter, r.replicate = {}, r.replicate.from = function (e, t, n) { return r.constructor.replicate(e, r, t, n) }, r.replicate.to = function (e, t, n) { return r.constructor.replicate(r, e, t, n) }, r.sync = function (e, t, n) { return r.constructor.sync(r, e, t, n) }, r.replicate.sync = r.sync, void ke.adapters[t.adapter].call(r, t, function (e) { return e ? (r.taskqueue.fail(e), void n(e)) : (Se(r, t), r.emit('created', r), ke.emit('created', t.originalName), r.taskqueue.ready(r), void n(null, r)) })) }); a.then(function (e) { i(null, e) }, i), r.then = a.then.bind(a), r['catch'] = a['catch'].bind(a) } function qe (e) { Object.keys(br.EventEmitter.prototype).forEach(function (t) { typeof br.EventEmitter.prototype[t] === 'function' && (e[t] = uo[t].bind(uo)) }); var t = e._destructionListeners = new mr.Map(); e.on('destroyed', function (e) { t.get(e).forEach(function (e) { e() }), t['delete'](e) }) } function xe (e) { return e.reduce(function (e, t) { return e[t] = !0, e }, {}) } function Ae (e) { if (!/^\d+\-./.test(e)) return x($r); var t = e.indexOf('-'); var n = e.substring(0, t); var r = e.substring(t + 1); return { prefix: parseInt(n, 10), id: r } } function Te (e, t) { for (var n = e.start - e.ids.length + 1, r = e.ids, o = [r[0], t, []], i = 1, a = r.length; a > i; i++)o = [r[i], { status: 'missing' }, [o]]; return [{ pos: n, ids: o }] } function Oe (e, t) { var n; var r; var o; var i = { status: 'available' }; if (e._deleted && (i.deleted = !0), t) if (e._id || (e._id = F()), r = F(32, 16).toLowerCase(), e._rev) { if (o = Ae(e._rev), o.error) return o; e._rev_tree = [{ pos: o.prefix, ids: [o.id, { status: 'missing' }, [[r, i, []]]] }], n = o.prefix + 1 } else e._rev_tree = [{ pos: 1, ids: [r, i, []] }], n = 1; else if (e._revisions && (e._rev_tree = Te(e._revisions, i), n = e._revisions.start, r = e._revisions.ids[0]), !e._rev_tree) { if (o = Ae(e._rev), o.error) return o; n = o.prefix, r = o.id, e._rev_tree = [{ pos: n, ids: [r, i, []] }] }I(e._id), e._rev = n + '-' + r; var a = { metadata: {}, data: {} }; for (var s in e) if (Object.prototype.hasOwnProperty.call(e, s)) { var u = s[0] === '_'; if (u && !lo[s]) { var c = x(Jr, s); throw c.message = Jr.message + ': ' + s, c }u && !ho[s] ? a.metadata[s.slice(1)] = e[s] : a.data[s] = e[s] } return a } function je (e) { for (var t = '', n = new Uint8Array(e), r = n.byteLength, o = 0; r > o; o++)t += String.fromCharCode(n[o]); return t } function Ie (e) { return vo(je(e)) } function Ce (e, t) { e = e || [], t = t || {}; try { return new Blob(e, t) } catch (n) { if (n.name !== 'TypeError') throw n; for (var r = typeof BlobBuilder !== 'undefined' ? BlobBuilder : typeof MSBlobBuilder !== 'undefined' ? MSBlobBuilder : typeof MozBlobBuilder !== 'undefined' ? MozBlobBuilder : WebKitBlobBuilder, o = new r(), i = 0; i < e.length; i += 1)o.append(e[i]); return o.getBlob(t.type) } } function Le (e) { for (var t = e.length, n = new ArrayBuffer(t), r = new Uint8Array(n), o = 0; t > o; o++)r[o] = e.charCodeAt(o); return n } function De (e, t) { return Ce([Le(e)], { type: t }) } function Re (e, t) { return De(po(e), t) } function Ne (e, t) { if (typeof FileReader === 'undefined') return t(je((new FileReaderSync()).readAsArrayBuffer(e))); var n = new FileReader(); var r = typeof n.readAsBinaryString === 'function'; n.onloadend = function (e) { var n = e.target.result || ''; return r ? t(n) : void t(je(n)) }, r ? n.readAsBinaryString(e) : n.readAsArrayBuffer(e) } function Be (e, t) { Ne(e, function (e) { t(vo(e)) }) } function Me (e, t) { if (typeof FileReader === 'undefined') return t((new FileReaderSync()).readAsArrayBuffer(e)); var n = new FileReader(); n.onloadend = function (e) { var n = e.target.result || new ArrayBuffer(0); t(n) }, n.readAsArrayBuffer(e) } function Fe (e) { return vo(e) } function Ue (e, t, n, r) { (n > 0 || r < t.byteLength) && (t = new Uint8Array(t, n, Math.min(r, t.byteLength) - n)), e.append(t) } function Pe (e, t, n, r) { (n > 0 || r < t.length) && (t = t.substring(n, r)), e.appendBinary(t) } function He (e, t) { function n () { var r = s * i; var o = r + i; if (s++, a > s)c(u, e, r, o), yo(n); else { c(u, e, r, o); var f = u.end(!0); var l = Fe(f); t(l), u.destroy() } } var r = typeof e === 'string'; var o = r ? e.length : e.byteLength; var i = Math.min(_o, o); var a = Math.ceil(o / i); var s = 0; var u = r ? new Er() : new Er.ArrayBuffer(); var c = r ? Pe : Ue; n() } function Je (e) { return Er.hash(e) } function Ke (e, t, n) { function r (e) { try { return po(e) } catch (t) { var n = x(Ur, 'Attachment is not a valid base64 string'); return { error: n } } } function o (e, n) { if (e.stub) return n(); if (typeof e.data === 'string') { var o = r(e.data); if (o.error) return n(o.error); e.length = o.length, t === 'blob' ? e.data = De(o, e.content_type) : t === 'base64' ? e.data = vo(o) : e.data = o, He(o, function (t) { e.digest = 'md5-' + t, n() }) } else Me(e.data, function (r) { t === 'binary' ? e.data = je(r) : t === 'base64' && (e.data = Ie(r)), He(r, function (t) { e.digest = 'md5-' + t, e.length = r.byteLength, n() }) }) } function i () { s++, e.length === s && (a ? n(a) : n()) } if (!e.length) return n(); var a; var s = 0; e.forEach(function (e) { function t (e) { a = e, r++, r === n.length && i() } var n = e.data && e.data._attachments ? Object.keys(e.data._attachments) : []; var r = 0; if (!n.length) return i(); for (var s in e.data._attachments)e.data._attachments.hasOwnProperty(s) && o(e.data._attachments[s], t) }) } function We (e, t, n, r, o, i, a, s) { if (ne(t.rev_tree, n.metadata.rev)) return r[o] = n, i(); var u = t.winningRev || U(t); var c = 'deleted' in t ? t.deleted : oe(t, u); var f = 'deleted' in n.metadata ? n.metadata.deleted : oe(n.metadata); var l = /^1-/.test(n.metadata.rev); if (c && !f && s && l) { var d = n.data; d._rev = u, d._id = n.metadata.id, n = Oe(d, s) } var h = te(t.rev_tree, n.metadata.rev_tree[0], e); var p = s && (c && f || !c && h.conflicts !== 'new_leaf' || c && !f && h.conflicts === 'new_branch'); if (p) { var v = x(Dr); return r[o] = v, i() } var y = n.metadata.rev; n.metadata.rev_tree = h.tree, n.stemmedRevs = h.stemmedRevs || [], t.rev_map && (n.metadata.rev_map = t.rev_map); var _; var m = U(n.metadata); var g = oe(n.metadata, m); var b = c === g ? 0 : g > c ? -1 : 1; _ = y === m ? g : oe(n.metadata, y), a(n, m, g, _, !0, b, o, i) } function Ge (e) { return e.metadata.rev_tree[0].ids[1].status === 'missing' } function Ve (e, t, n, r, o, i, a, s, u) { function c (e, t, n) { var r = U(e.metadata); var o = oe(e.metadata, r); if ('was_delete' in s && o) return i[t] = x(Lr, 'deleted'), n(); var u = l && Ge(e); if (u) { var c = x(Dr); return i[t] = c, n() } var f = o ? 0 : 1; a(e, r, o, o, !1, f, t, n) } function f () { ++h === p && u && u() }e = e || 1e3; var l = s.new_edits; var d = new mr.Map(); var h = 0; var p = t.length; t.forEach(function (e, t) { if (e._id && ie(e._id)) { var r = e._deleted ? '_removeLocal' : '_putLocal'; return void n[r](e, { ctx: o }, function (e, n) { i[t] = e || n, f() }) } var a = e.metadata.id; d.has(a) ? (p--, d.get(a).push([e, t])) : d.set(a, [[e, t]]) }), d.forEach(function (t, n) { function o () { ++u < t.length ? s() : f() } function s () { var s = t[u]; var f = s[0]; var d = s[1]; if (r.has(n))We(e, r.get(n), f, i, d, o, a, l); else { var h = te([], f.metadata.rev_tree[0], e); f.metadata.rev_tree = h.tree, f.stemmedRevs = h.stemmedRevs || [], c(f, d, o) } } var u = 0; s() }) } function ze (e) { try { return JSON.parse(e) } catch (t) { return Sr.parse(e) } } function Xe (e) { return e.length < 5e4 ? JSON.parse(e) : ze(e) } function Qe (e) { try { return JSON.stringify(e) } catch (t) { return Sr.stringify(e) } } function $e (e, t, n, r) { try { e.apply(t, n) } catch (o) { r.emit('error', o) } } function Ye (e) { if (!xo.running && xo.queue.length) { xo.running = !0; var t = xo.queue.shift(); t.action(function (r, o) { $e(t.callback, this, [r, o], e), xo.running = !1, n.nextTick(function () { Ye(e) }) }) } } function Ze (e) { return function (t) { var n = 'unknown_error'; t.target && t.target.error && (n = t.target.error.name || t.target.error.message), e(x(Vr, n, t.type)) } } function et (e, t, n) { return { data: Qe(e), winningRev: t, deletedOrLocal: n ? '1' : '0', seq: e.seq, id: e.id } } function tt (e) { if (!e) return null; var t = Xe(e.data); return t.winningRev = e.winningRev, t.deleted = e.deletedOrLocal === '1', t.seq = e.seq, t } function nt (e) { if (!e) return e; var t = e._doc_id_rev.lastIndexOf(':'); return e._id = e._doc_id_rev.substring(0, t - 1), e._rev = e._doc_id_rev.substring(t + 1), delete e._doc_id_rev, e } function rt (e, t, n, r) { n ? r(e ? typeof e !== 'string' ? e : Re(e, t) : Ce([''], { type: t })) : e ? typeof e !== 'string' ? Ne(e, function (e) { r(vo(e)) }) : r(e) : r('') } function ot (e, t, n, r) { function o () { ++s === a.length && r && r() } function i (e, t) { var r = e._attachments[t]; var i = r.digest; var a = n.objectStore(wo).get(i); a.onsuccess = function (e) { r.body = e.target.result.body, o() } } var a = Object.keys(e._attachments || {}); if (!a.length) return r && r(); var s = 0; a.forEach(function (n) { t.attachments && t.include_docs ? i(e, n) : (e._attachments[n].stub = !0, o()) }) } function it (e, t) { return qr.all(e.map(function (e) { if (e.doc && e.doc._attachments) { var n = Object.keys(e.doc._attachments); return qr.all(n.map(function (n) { var r = e.doc._attachments[n]; if ('body' in r) { var o = r.body; var i = r.content_type; return new qr(function (a) { rt(o, i, t, function (t) { e.doc._attachments[n] = pr.extend(h(r, ['digest', 'content_type']), { data: t }), a() }) }) } })) } })) } function at (e, t, n) { function r () { c--, c || o() } function o () { i.length && i.forEach(function (e) { var t = u.index('digestSeq').count(IDBKeyRange.bound(e + '::', e + '::', !1, !1)); t.onsuccess = function (t) { var n = t.target.result; n || s['delete'](e) } }) } var i = []; var a = n.objectStore(bo); var s = n.objectStore(wo); var u = n.objectStore(Eo); var c = e.length; e.forEach(function (e) { var n = a.index('_doc_id_rev'); var o = t + '::' + e; n.getKey(o).onsuccess = function (e) { var t = e.target.result; if (typeof t !== 'number') return r(); a['delete'](t); var n = u.index('seq').openCursor(IDBKeyRange.only(t)); n.onsuccess = function (e) { var t = e.target.result; if (t) { var n = t.value.digestSeq.split('::')[0]; i.push(n), u['delete'](t.primaryKey), t['continue']() } else r() } } }) } function st (e, t, n) { try { return { txn: e.transaction(t, n) } } catch (r) { return { error: r } } } function ut (e, t, n, r, o, i, a) { function s () { var e = [go, bo, wo, ko, Eo]; var t = st(o, e, 'readwrite'); return t.error ? a(t.error) : (m = t.txn, m.onabort = Ze(a), m.ontimeout = Ze(a), m.oncomplete = f, g = m.objectStore(go), b = m.objectStore(bo), w = m.objectStore(wo), E = m.objectStore(Eo), void d(function (e) { return e ? (C = !0, a(e)) : void c() })) } function u () { Ve(e.revs_limit, k, r, I, m, j, h, n) } function c () { function e () { ++n === k.length && u() } function t (t) { var n = tt(t.target.result); n && I.set(n.id, n), e() } if (k.length) for (var n = 0, r = 0, o = k.length; o > r; r++) { var i = k[r]; if (i._id && ie(i._id))e(); else { var a = g.get(i.metadata.id); a.onsuccess = t } } } function f () { C || (i.notify(r._meta.name), r._meta.docCount += q, a(null, j)) } function l (e, t) { var n = w.get(e); n.onsuccess = function (n) { if (n.target.result)t(); else { var r = x(Zr, 'unknown stub attachment with digest ' + e); r.status = 412, t(r) } } } function d (e) { function t () { ++o === n.length && e(r) } var n = []; if (k.forEach(function (e) { e.data && e.data._attachments && Object.keys(e.data._attachments).forEach(function (t) { var r = e.data._attachments[t]; r.stub && n.push(r.digest) }) }), !n.length) return e(); var r; var o = 0; n.forEach(function (e) { l(e, function (e) { e && !r && (r = e), t() }) }) } function h (e, t, n, r, o, i, a, s) { q += i, e.metadata.winningRev = t, e.metadata.deleted = n; var u = e.data; u._id = e.metadata.id, u._rev = e.metadata.rev, r && (u._deleted = !0); var c = u._attachments && Object.keys(u._attachments).length; return c ? v(e, t, n, o, a, s) : void p(e, t, n, o, a, s) } function p (e, t, n, o, i, a) { function s (i) { var a = e.stemmedRevs || []; o && r.auto_compaction && (a = a.concat(W(e.metadata))), a && a.length && at(a, e.metadata.id, m), l.seq = i.target.result, delete l.rev; var s = et(l, t, n); var u = g.put(s); u.onsuccess = c } function u (e) { e.preventDefault(), e.stopPropagation(); var t = b.index('_doc_id_rev'); var n = t.getKey(f._doc_id_rev); n.onsuccess = function (e) { var t = b.put(f, e.target.result); t.onsuccess = s } } function c () { j[i] = { ok: !0, id: l.id, rev: t }, I.set(e.metadata.id, e.metadata), y(e, l.seq, a) } var f = e.data; var l = e.metadata; f._doc_id_rev = l.id + '::' + l.rev, delete f._id, delete f._rev; var d = b.put(f); d.onsuccess = s, d.onerror = u } function v (e, t, n, r, o, i) { function a () { c === f.length && p(e, t, n, r, o, i) } function s () { c++, a() } var u = e.data; var c = 0; var f = Object.keys(u._attachments); f.forEach(function (n) { var r = e.data._attachments[n]; if (r.stub)c++, a(); else { var o = r.data; delete r.data, r.revpos = parseInt(t, 10); var i = r.digest; _(i, o, s) } }) } function y (e, t, n) { function r () { ++i === a.length && n() } function o (n) { var o = e.data._attachments[n].digest; var i = E.put({ seq: t, digestSeq: o + '::' + t }); i.onsuccess = r, i.onerror = function (e) { e.preventDefault(), e.stopPropagation(), r() } } var i = 0; var a = Object.keys(e.data._attachments || {}); if (!a.length) return n(); for (var s = 0; s < a.length; s++)o(a[s]) } function _ (e, t, n) { var r = w.count(e); r.onsuccess = function (r) { var o = r.target.result; if (o) return n(); var i = { digest: e, body: t }; var a = w.put(i); a.onsuccess = n } } for (var m, g, b, w, E, S, k = t.docs, q = 0, A = 0, T = k.length; T > A; A++) { var O = k[A]; O._id && ie(O._id) || (O = k[A] = Oe(O, n.new_edits), O.error && !S && (S = O)) } if (S) return a(S); var j = new Array(k.length); var I = new mr.Map(); var C = !1; var L = r._meta.blobSupport ? 'blob' : 'base64'; Ke(k, L, function (e) { return e ? a(e) : void s() }) } function ct (e, t, n, r, o) { try { if (e && t) return o ? IDBKeyRange.bound(t, e, !n, !1) : IDBKeyRange.bound(e, t, !1, !n); if (e) return o ? IDBKeyRange.upperBound(e) : IDBKeyRange.lowerBound(e); if (t) return o ? IDBKeyRange.lowerBound(t, !n) : IDBKeyRange.upperBound(t, !n); if (r) return IDBKeyRange.only(r) } catch (i) { return { error: i } } return null } function ft (e, t, n, r) { return n.name === 'DataError' && n.code === 0 ? r(null, { total_rows: e._meta.docCount, offset: t.skip, rows: [] }) : void r(x(Vr, n.name, n.message)) } function lt (e, t, n, r) { function o (e, r) { function o (t, n, r) { var o = t.id + '::' + r; S.get(o).onsuccess = function (r) { n.doc = nt(r.target.result), e.conflicts && (n.doc._conflicts = K(t)), ot(n.doc, e, g) } } function i (t, n, r) { var i = { id: r.id, key: r.id, value: { rev: n } }; var a = r.deleted; if (e.deleted === 'ok')k.push(i), a ? (i.value.deleted = !0, i.doc = null) : e.include_docs && o(r, i, n); else if (!a && d-- <= 0 && (k.push(i), e.include_docs && o(r, i, n), --h === 0)) return; t['continue']() } function a (e) { q = t._meta.docCount; var n = e.target.result; if (n) { var r = tt(n.value); var o = r.winningRev; i(n, o, r) } } function s () { r(null, { total_rows: q, offset: e.skip, rows: k }) } function u () { e.attachments ? it(k, e.binary).then(s) : s() } var c = 'startkey' in e ? e.startkey : !1; var f = 'endkey' in e ? e.endkey : !1; var l = 'key' in e ? e.key : !1; var d = e.skip || 0; var h = typeof e.limit === 'number' ? e.limit : -1; var p = e.inclusive_end !== !1; var v = 'descending' in e && e.descending ? 'prev' : null; var y = ct(c, f, p, l, v); if (y && y.error) return ft(t, e, y.error, r); var _ = [go, bo]; e.attachments && _.push(wo); var m = st(n, _, 'readonly'); if (m.error) return r(m.error); var g = m.txn; var b = g.objectStore(go); var w = g.objectStore(bo); var E = v ? b.openCursor(y, v) : b.openCursor(y); var S = w.index('_doc_id_rev'); var k = []; var q = 0; g.oncomplete = u, E.onsuccess = a } function i (e, n) { return e.limit === 0 ? n(null, { total_rows: t._meta.docCount, offset: e.skip, rows: [] }) : void o(e, n) }i(e, r) } function dt (e) { return new qr(function (t) { var n = Ce(['']); e.objectStore(qo).put(n, 'key'), e.onabort = function (e) { e.preventDefault(), e.stopPropagation(), t(!1) }, e.oncomplete = function () { var e = navigator.userAgent.match(/Chrome\/(\d+)/); var n = navigator.userAgent.match(/Edge\//); t(n || !e || parseInt(e[1], 10) >= 43) } })['catch'](function () { return !1 }) } function ht (e, t) { var n = this; xo.queue.push({ action: function (t) { pt(n, e, t) }, callback: t }), Ye(n.constructor) } function pt (e, t, r) {
        function o (e) { var t = e.createObjectStore(go, { keyPath: 'id' }); e.createObjectStore(bo, { autoIncrement: !0 }).createIndex('_doc_id_rev', '_doc_id_rev', { unique: !0 }), e.createObjectStore(wo, { keyPath: 'digest' }), e.createObjectStore(So, { keyPath: 'id', autoIncrement: !1 }), e.createObjectStore(qo), t.createIndex('deletedOrLocal', 'deletedOrLocal', { unique: !1 }), e.createObjectStore(ko, { keyPath: '_id' }); var n = e.createObjectStore(Eo, { autoIncrement: !0 }); n.createIndex('seq', 'seq'), n.createIndex('digestSeq', 'digestSeq', { unique: !0 }) } function i (e, t) { var n = e.objectStore(go); n.createIndex('deletedOrLocal', 'deletedOrLocal', { unique: !1 }), n.openCursor().onsuccess = function (e) { var r = e.target.result; if (r) { var o = r.value; var i = oe(o); o.deletedOrLocal = i ? '1' : '0', n.put(o), r['continue']() } else t() } } function a (e) { e.createObjectStore(ko, { keyPath: '_id' }).createIndex('_doc_id_rev', '_doc_id_rev', { unique: !0 }) } function s (e, t) { var n = e.objectStore(ko); var r = e.objectStore(go); var o = e.objectStore(bo); var i = r.openCursor(); i.onsuccess = function (e) { var i = e.target.result; if (i) { var a = i.value; var s = a.id; var u = ie(s); var c = U(a); if (u) { var f = s + '::' + c; var l = s + '::'; var d = s + '::~'; var h = o.index('_doc_id_rev'); var p = IDBKeyRange.bound(l, d, !1, !1); var v = h.openCursor(p); v.onsuccess = function (e) { if (v = e.target.result) { var t = v.value; t._doc_id_rev === f && n.put(t), o['delete'](v.primaryKey), v['continue']() } else r['delete'](i.primaryKey), i['continue']() } } else i['continue']() } else t && t() } } function u (e) { var t = e.createObjectStore(Eo, { autoIncrement: !0 }); t.createIndex('seq', 'seq'), t.createIndex('digestSeq', 'digestSeq', { unique: !0 }) } function f (e, t) { var n = e.objectStore(bo); var r = e.objectStore(wo); var o = e.objectStore(Eo); var i = r.count(); i.onsuccess = function (e) { var r = e.target.result; return r ? void (n.openCursor().onsuccess = function (e) { var n = e.target.result; if (!n) return t(); for (var r = n.value, i = n.primaryKey, a = Object.keys(r._attachments || {}), s = {}, u = 0; u < a.length; u++) { var c = r._attachments[a[u]]; s[c.digest] = !0 } var f = Object.keys(s); for (u = 0; u < f.length; u++) { var l = f[u]; o.put({ seq: i, digestSeq: l + '::' + i }) }n['continue']() }) : t() } } function d (e) { function t (e) { return e.data ? tt(e) : (e.deleted = e.deletedOrLocal === '1', e) } var n = e.objectStore(bo); var r = e.objectStore(go); var o = r.openCursor(); o.onsuccess = function (e) { function o () { var e = s.id + '::'; var t = s.id + '::'; var r = n.index('_doc_id_rev').openCursor(IDBKeyRange.bound(e, t)); var o = 0; r.onsuccess = function (e) { var t = e.target.result; if (!t) return s.seq = o, i(); var n = t.primaryKey; n > o && (o = n), t['continue']() } } function i () { var e = et(s, s.winningRev, s.deleted); var t = r.put(e); t.onsuccess = function () { a['continue']() } } var a = e.target.result; if (a) { var s = t(a.value); return s.winningRev = s.winningRev || U(s), s.seq ? i() : void o() } } } var h = t.name; var p = null; e._meta = null, e.type = function () { return 'idb' }, e._id = l(function (t) { t(null, e._meta.instanceId) }), e._bulkDocs = function (n, r, o) { ut(t, n, r, e, p, To, o) }, e._get = function (e, t, n) { function r () { n(a, { doc: o, metadata: i, ctx: s }) } var o; var i; var a; var s = t.ctx; if (!s) { var u = st(p, [go, bo, wo], 'readonly'); if (u.error) return n(u.error); s = u.txn }s.objectStore(go).get(e).onsuccess = function (e) { if (i = tt(e.target.result), !i) return a = x(Lr, 'missing'), r(); if (oe(i) && !t.rev) return a = x(Lr, 'deleted'), r(); var n = s.objectStore(bo); var u = t.rev || i.winningRev; var c = i.id + '::' + u; n.index('_doc_id_rev').get(c).onsuccess = function (e) { return o = e.target.result, o && (o = nt(o)), o ? void r() : (a = x(Lr, 'missing'), r()) } } }, e._getAttachment = function (e, t, n, r, o) { var i; if (r.ctx)i = r.ctx; else { var a = st(p, [go, bo, wo], 'readonly'); if (a.error) return o(a.error); i = a.txn } var s = n.digest; var u = n.content_type; i.objectStore(wo).get(s).onsuccess = function (e) { var t = e.target.result.body; rt(t, u, r.binary, function (e) { o(null, e) }) } }, e._info = function (t) { if (p === null || !Ao.has(h)) { var n = new Error("db isn't open"); return n.id = 'idbNull', t(n) } var r; var o; var i = st(p, [bo], 'readonly'); if (i.error) return t(i.error); var a = i.txn; var s = a.objectStore(bo).openCursor(null, 'prev'); s.onsuccess = function (t) { var n = t.target.result; r = n ? n.key : 0, o = e._meta.docCount }, a.oncomplete = function () { t(null, { doc_count: o, update_seq: r, idb_attachment_format: e._meta.blobSupport ? 'binary' : 'base64' }) } }, e._allDocs = function (t, n) { lt(t, e, p, n) }, e._changes = function (t) {
          function n (e) { function n () { return c.seq !== a ? e['continue']() : (u = a, c.winningRev === i._rev ? o(i) : void r()) } function r () { var e = i._id + '::' + c.winningRev; var t = _.get(e); t.onsuccess = function (e) { o(nt(e.target.result)) } } function o (n) { var r = t.processChange(n, c, t); r.seq = c.seq; var o = b(r); return typeof o === 'object' ? t.complete(o) : (o && (g++, l && m.push(r), t.attachments && t.include_docs ? ot(n, t, d, function () { it([r], t.binary).then(function () { t.onChange(r) }) }) : t.onChange(r)), void (g !== f && e['continue']())) } var i = nt(e.value); var a = e.key; if (s && !s.has(i._id)) return e['continue'](); var c; return (c = w.get(i._id)) ? n() : void (y.get(i._id).onsuccess = function (e) { c = tt(e.target.result), w.set(i._id, c), n() }) } function r (e) { var t = e.target.result; t && n(t) } function o () { var e = [go, bo]; t.attachments && e.push(wo); var n = st(p, e, 'readonly'); if (n.error) return t.complete(n.error); d = n.txn, d.onabort = Ze(t.complete), d.oncomplete = i, v = d.objectStore(bo), y = d.objectStore(go), _ = v.index('_doc_id_rev'); var o; o = t.descending ? v.openCursor(null, 'prev') : v.openCursor(IDBKeyRange.lowerBound(t.since, !0)), o.onsuccess = r } function i () { function e () { t.complete(null, { results: m, last_seq: u }) }!t.continuous && t.attachments ? it(m).then(e) : e() } if (t = c(t), t.continuous) {
            var a = h + ':' + F(); return To.addListener(h, a, e, t), To.notify(h), { cancel: function () { To.removeListener(h, a) } }
          } var s = t.doc_ids && new mr.Set(t.doc_ids); t.since = t.since || 0; var u = t.since; var f = 'limit' in t ? t.limit : -1; f === 0 && (f = 1); var l; l = 'return_docs' in t ? t.return_docs : 'returnDocs' in t ? t.returnDocs : !0; var d; var v; var y; var _; var m = []; var g = 0; var b = O(t); var w = new mr.Map(); o()
        }, e._close = function (e) { return p === null ? e(x(Mr)) : (p.close(), Ao['delete'](h), p = null, void e()) }, e._getRevisionTree = function (e, t) { var n = st(p, [go], 'readonly'); if (n.error) return t(n.error); var r = n.txn; var o = r.objectStore(go).get(e); o.onsuccess = function (e) { var n = tt(e.target.result); n ? t(null, n.rev_tree) : t(x(Lr)) } }, e._doCompaction = function (e, t, n) { var r = [go, bo, wo, Eo]; var o = st(p, r, 'readwrite'); if (o.error) return n(o.error); var i = o.txn; var a = i.objectStore(go); a.get(e).onsuccess = function (n) { var r = tt(n.target.result); P(r.rev_tree, function (e, n, r, o, i) { var a = n + '-' + r; t.indexOf(a) !== -1 && (i.status = 'missing') }), at(t, e, i); var o = r.winningRev; var a = r.deleted; i.objectStore(go).put(et(r, o, a)) }, i.onabort = Ze(n), i.oncomplete = function () { n() } }, e._getLocal = function (e, t) { var n = st(p, [ko], 'readonly'); if (n.error) return t(n.error); var r = n.txn; var o = r.objectStore(ko).get(e); o.onerror = Ze(t), o.onsuccess = function (e) { var n = e.target.result; n ? (delete n._doc_id_rev, t(null, n)) : t(x(Lr)) } }, e._putLocal = function (e, t, n) { typeof t === 'function' && (n = t, t = {}), delete e._revisions; var r = e._rev; var o = e._id; r ? e._rev = '0-' + (parseInt(r.split('-')[1], 10) + 1) : e._rev = '0-1'; var i; var a = t.ctx; if (!a) { var s = st(p, [ko], 'readwrite'); if (s.error) return n(s.error); a = s.txn, a.onerror = Ze(n), a.oncomplete = function () { i && n(null, i) } } var u; var c = a.objectStore(ko); r ? (u = c.get(o), u.onsuccess = function (o) { var a = o.target.result; if (a && a._rev === r) { var s = c.put(e); s.onsuccess = function () { i = { ok: !0, id: e._id, rev: e._rev }, t.ctx && n(null, i) } } else n(x(Dr)) }) : (u = c.add(e), u.onerror = function (e) { n(x(Dr)), e.preventDefault(), e.stopPropagation() }, u.onsuccess = function () { i = { ok: !0, id: e._id, rev: e._rev }, t.ctx && n(null, i) }) }, e._removeLocal = function (e, t, n) { typeof t === 'function' && (n = t, t = {}); var r = t.ctx; if (!r) { var o = st(p, [ko], 'readwrite'); if (o.error) return n(o.error); r = o.txn, r.oncomplete = function () { i && n(null, i) } } var i; var a = e._id; var s = r.objectStore(ko); var u = s.get(a); u.onerror = Ze(n), u.onsuccess = function (r) { var o = r.target.result; o && o._rev === e._rev ? (s['delete'](a), i = { ok: !0, id: a, rev: '0-0' }, t.ctx && n(null, i)) : n(x(Lr)) } }, e._destroy = function (e, t) { To.removeAllListeners(h); var n = Oo.get(h); n && n.result && (n.result.close(), Ao['delete'](h)); var r = indexedDB.deleteDatabase(h); r.onsuccess = function () { Oo['delete'](h), m() && h in localStorage && delete localStorage[h], t(null, { ok: !0 }) }, r.onerror = Ze(t) }; var v = Ao.get(h); if (v) return p = v.idb, e._meta = v.global, void n.nextTick(function () { r(null, e) }); var y; y = t.storage ? vt(h, t.storage) : indexedDB.open(h, mo), Oo.set(h, y), y.onupgradeneeded = function (e) { function t () { var e = c[l - 1]; l++, e && e(r, t) } var n = e.target.result; if (e.oldVersion < 1) return o(n); var r = e.currentTarget.transaction; e.oldVersion < 3 && a(n), e.oldVersion < 4 && u(n); var c = [i, s, f, d]; var l = e.oldVersion; t() }, y.onsuccess = function (t) { p = t.target.result, p.onversionchange = function () { p.close(), Ao['delete'](h) }, p.onabort = function (e) { w('error', 'Database has a global failure', e.target.error), p.close(), Ao['delete'](h) }; var n = p.transaction([So, qo, go], 'readwrite'); var o = n.objectStore(So).get(So); var i = null; var a = null; var s = null; o.onsuccess = function (t) { var o = function () { i !== null && a !== null && s !== null && (e._meta = { name: h, instanceId: s, blobSupport: i, docCount: a }, Ao.set(h, { idb: p, global: e._meta }), r(null, e)) }; var u = t.target.result || { id: So }; h + '_id' in u ? (s = u[h + '_id'], o()) : (s = F(), u[h + '_id'] = s, n.objectStore(So).put(u).onsuccess = function () { o() }), fo || (fo = dt(n)), fo.then(function (e) { i = e, o() }); var c = n.objectStore(go).index('deletedOrLocal'); c.count(IDBKeyRange.only('0')).onsuccess = function (e) { a = e.target.result, o() } } }, y.onerror = function () { var e = 'Failed to open indexedDB, are you in private browsing mode?'; w('error', e), r(x(Vr, e)) }
      } function vt (e, t) { try { return indexedDB.open(e, { version: mo, storage: t }) } catch (n) { return indexedDB.open(e, mo) } } function yt (e) { e.adapter('idb', ht, !0) } function _t (e) { return decodeURIComponent(escape(e)) } function mt (e) { return e < 65 ? e - 48 : e - 55 } function gt (e, t, n) { for (var r = ''; n > t;)r += String.fromCharCode(mt(e.charCodeAt(t++)) << 4 | mt(e.charCodeAt(t++))); return r } function bt (e, t, n) { for (var r = ''; n > t;)r += String.fromCharCode(mt(e.charCodeAt(t + 2)) << 12 | mt(e.charCodeAt(t + 3)) << 8 | mt(e.charCodeAt(t)) << 4 | mt(e.charCodeAt(t + 1))), t += 4; return r } function wt (e, t) { return t === 'UTF-8' ? _t(gt(e, 0, e.length)) : bt(e, 0, e.length) } function Et (e) { return "'" + e + "'" } function St (e) { return e.replace(/\u0002/g, '').replace(/\u0001/g, '').replace(/\u0000/g, '') } function kt (e) { return e.replace(/\u0001\u0001/g, '\x00').replace(/\u0001\u0002/g, '').replace(/\u0002\u0002/g, '') } function qt (e) { return delete e._id, delete e._rev, JSON.stringify(e) } function xt (e, t, n) { return e = JSON.parse(e), e._id = t, e._rev = n, e } function At (e) { for (var t = '('; e--;)t += '?', e && (t += ','); return t + ')' } function Tt (e, t, n, r, o) { return 'SELECT ' + e + ' FROM ' + (typeof t === 'string' ? t : t.join(' JOIN ')) + (n ? ' ON ' + n : '') + (r ? ' WHERE ' + (typeof r === 'string' ? r : r.join(' AND ')) : '') + (o ? ' ORDER BY ' + o : '') } function Ot (e, t, n) { function r () { ++i === e.length && o() } function o () { if (a.length) { var e = 'SELECT DISTINCT digest AS digest FROM ' + No + ' WHERE seq IN ' + At(a.length); n.executeSql(e, a, function (e, t) { for (var n = [], r = 0; r < t.rows.length; r++)n.push(t.rows.item(r).digest); if (n.length) { var o = 'DELETE FROM ' + No + ' WHERE seq IN (' + a.map(function () { return '?' }).join(',') + ')'; e.executeSql(o, a, function (e) { var t = 'SELECT digest FROM ' + No + ' WHERE digest IN (' + n.map(function () { return '?' }).join(',') + ')'; e.executeSql(t, n, function (e, t) { for (var r = new mr.Set(), o = 0; o < t.rows.length; o++)r.add(t.rows.item(o).digest); n.forEach(function (t) { r.has(t) || (e.executeSql('DELETE FROM ' + No + ' WHERE digest=?', [t]), e.executeSql('DELETE FROM ' + Lo + ' WHERE digest=?', [t])) }) }) }) } }) } } if (e.length) { var i = 0; var a = []; e.forEach(function (e) { var o = 'SELECT seq FROM ' + Co + ' WHERE doc_id=? AND rev=?'; n.executeSql(o, [t, e], function (e, t) { if (!t.rows.length) return r(); var n = t.rows.item(0).seq; a.push(n), e.executeSql('DELETE FROM ' + Co + ' WHERE seq=?', [n], r) }) }) } } function jt (e) { return function (t) { w('error', 'WebSQL threw an error', t); var n = t && t.constructor.toString().match(/function ([^\(]+)/); var r = n && n[1] || t.type; var o = t.target || t.message; e(x(zr, o, r)) } } function It (e) { if ('size' in e) return 1e6 * e.size; var t = typeof navigator !== 'undefined' && /Android/.test(navigator.userAgent); return t ? 5e6 : 1 } function Ct (e, t, n, r, o, i, a) { function s () { return g ? a(g) : (i.notify(r._name), r._docCount = -1, void a(null, b)) } function u (e, t) { var n = 'SELECT count(*) as cnt FROM ' + Lo + ' WHERE digest=?'; m.executeSql(n, [e], function (n, r) { if (r.rows.item(0).cnt === 0) { var o = x(Zr, 'unknown stub attachment with digest ' + e); t(o) } else t() }) } function c (e) { function t () { ++o === n.length && e(r) } var n = []; if (y.forEach(function (e) { e.data && e.data._attachments && Object.keys(e.data._attachments).forEach(function (t) { var r = e.data._attachments[t]; r.stub && n.push(r.digest) }) }), !n.length) return e(); var r; var o = 0; n.forEach(function (e) { u(e, function (e) { e && !r && (r = e), t() }) }) } function f (e, t, n, o, i, a, s, u) { function c () { function t (e, t) { function r () { return ++i === a.length && t(), !1 } function o (t) { var o = 'INSERT INTO ' + No + ' (digest, seq) VALUES (?,?)'; var i = [n._attachments[t].digest, e]; m.executeSql(o, i, r, r) } var i = 0; var a = Object.keys(n._attachments || {}); if (!a.length) return t(); for (var s = 0; s < a.length; s++)o(a[s]) } var n = e.data; var r = o ? 1 : 0; var i = n._id; var a = n._rev; var s = qt(n); var u = 'INSERT INTO ' + Co + ' (doc_id, rev, json, deleted) VALUES (?, ?, ?, ?);'; var c = [i, a, s, r]; m.executeSql(u, c, function (e, n) { var r = n.insertId; t(r, function () { d(e, r) }) }, function () { var e = Tt('seq', Co, null, 'doc_id=? AND rev=?'); return m.executeSql(e, [i, a], function (e, n) { var o = n.rows.item(0).seq; var u = 'UPDATE ' + Co + ' SET json=?, deleted=? WHERE doc_id=? AND rev=?;'; var c = [s, r, i, a]; e.executeSql(u, c, function (e) { t(o, function () { d(e, o) }) }) }), !1 }) } function f (e) { p || (e ? (p = e, u(p)) : v === y.length && c()) } function l (e) { v++, f(e) } function d (n, o) { var a = e.metadata.id; var c = e.stemmedRevs || []; i && r.auto_compaction && (c = W(e.metadata).concat(c)), c.length && Ot(c, a, n), e.metadata.seq = o, delete e.metadata.rev; var f = i ? 'UPDATE ' + Io + ' SET json=?, max_seq=?, winningseq=(SELECT seq FROM ' + Co + ' WHERE doc_id=' + Io + '.id AND rev=?) WHERE id=?' : 'INSERT INTO ' + Io + ' (id, winningseq, max_seq, json) VALUES (?,?,?,?);'; var l = Qe(e.metadata); var d = i ? [l, o, t, a] : [a, o, o, l]; n.executeSql(f, d, function () { b[s] = { ok: !0, id: e.metadata.id, rev: t }, w.set(a, e.metadata), u() }) } var p = null; var v = 0; e.data._id = e.metadata.id, e.data._rev = e.metadata.rev; var y = Object.keys(e.data._attachments || {}); o && (e.data._deleted = !0), y.forEach(function (n) { var r = e.data._attachments[n]; if (r.stub)v++, f(); else { var o = r.data; delete r.data, r.revpos = parseInt(t, 10); var i = r.digest; h(i, o, l) } }), y.length || c() } function l () { Ve(e.revs_limit, y, r, w, m, b, f, n) } function d (e) { function t () { ++n === y.length && e() } if (!y.length) return e(); var n = 0; y.forEach(function (e) { if (e._id && ie(e._id)) return t(); var n = e.metadata.id; m.executeSql('SELECT json FROM ' + Io + ' WHERE id = ?', [n], function (e, r) { if (r.rows.length) { var o = Xe(r.rows.item(0).json); w.set(n, o) }t() }) }) } function h (e, t, n) { var r = 'SELECT digest FROM ' + Lo + ' WHERE digest=?'; m.executeSql(r, [e], function (o, i) { return i.rows.length ? n() : (r = 'INSERT INTO ' + Lo + ' (digest, body, escaped) VALUES (?,?,1)', void o.executeSql(r, [e, St(t)], function () { n() }, function () { return n(), !1 })) }) } var p = n.new_edits; var v = t.docs; var y = v.map(function (e) { if (e._id && ie(e._id)) return e; var t = Oe(e, p); return t }); var _ = y.filter(function (e) { return e.error }); if (_.length) return a(_[0]); var m; var g; var b = new Array(y.length); var w = new mr.Map(); Ke(y, 'binary', function (e) { return e ? a(e) : void o.transaction(function (e) { m = e, c(function (e) { e ? g = e : d(l) }) }, jt(a), s) }) } function Lt (e) { return e.websql(e.name, e.version, e.description, e.size) } function Dt (e) { try { return { db: Lt(e) } } catch (t) { return { error: t } } } function Rt (e) { var t = Bo.get(e.name); return t || (t = Dt(e), Bo.set(e.name, t), t.db && (t.db._sqlitePlugin = typeof sqlitePlugin !== 'undefined')), t } function Nt (e, t, n, r, o) { function i () { ++u === s.length && o && o() } function a (e, o) { var a = e._attachments[o]; var s = { binary: t.binary, ctx: r }; n._getAttachment(e._id, o, a, s, function (t, n) { e._attachments[o] = pr.extend(h(a, ['digest', 'content_type']), { data: n }), i() }) } var s = Object.keys(e._attachments || {}); if (!s.length) return o && o(); var u = 0; s.forEach(function (n) { t.attachments && t.include_docs ? a(e, n) : (e._attachments[n].stub = !0, i()) }) } function Bt (e, t) { function n () { m() && (window.localStorage['_pouch__websqldb_' + g._name] = !0), t(null, g) } function r (e, t) { e.executeSql(Ho), e.executeSql('ALTER TABLE ' + Co + ' ADD COLUMN deleted TINYINT(1) DEFAULT 0', [], function () { e.executeSql(Uo), e.executeSql('ALTER TABLE ' + Io + ' ADD COLUMN local TINYINT(1) DEFAULT 0', [], function () { e.executeSql("CREATE INDEX IF NOT EXISTS 'doc-store-local-idx' ON " + Io + ' (local, id)'); var n = 'SELECT ' + Io + '.winningseq AS seq, ' + Io + '.json AS metadata FROM ' + Co + ' JOIN ' + Io + ' ON ' + Co + '.seq = ' + Io + '.winningseq'; e.executeSql(n, [], function (e, n) { for (var r = [], o = [], i = 0; i < n.rows.length; i++) { var a = n.rows.item(i); var s = a.seq; var u = JSON.parse(a.metadata); oe(u) && r.push(s), ie(u.id) && o.push(u.id) }e.executeSql('UPDATE ' + Io + 'SET local = 1 WHERE id IN ' + At(o.length), o, function () { e.executeSql('UPDATE ' + Co + ' SET deleted = 1 WHERE seq IN ' + At(r.length), r, t) }) }) }) }) } function o (e, t) { var n = 'CREATE TABLE IF NOT EXISTS ' + Do + ' (id UNIQUE, rev, json)'; e.executeSql(n, [], function () { var n = 'SELECT ' + Io + '.id AS id, ' + Co + '.json AS data FROM ' + Co + ' JOIN ' + Io + ' ON ' + Co + '.seq = ' + Io + '.winningseq WHERE local = 1'; e.executeSql(n, [], function (e, n) { function r () { if (!o.length) return t(e); var n = o.shift(); var i = JSON.parse(n.data)._rev; e.executeSql('INSERT INTO ' + Do + ' (id, rev, json) VALUES (?,?,?)', [n.id, i, n.data], function (e) { e.executeSql('DELETE FROM ' + Io + ' WHERE id=?', [n.id], function (e) { e.executeSql('DELETE FROM ' + Co + ' WHERE seq=?', [n.seq], function () { r() }) }) }) } for (var o = [], i = 0; i < n.rows.length; i++)o.push(n.rows.item(i)); r() }) }) } function i (e, t) { function n (n) { function r () { if (!n.length) return t(e); var o = n.shift(); var i = wt(o.hex, _); var a = i.lastIndexOf('::'); var s = i.substring(0, a); var u = i.substring(a + 2); var c = 'UPDATE ' + Co + ' SET doc_id=?, rev=? WHERE doc_id_rev=?'; e.executeSql(c, [s, u, i], function () { r() }) }r() } var r = 'ALTER TABLE ' + Co + ' ADD COLUMN doc_id'; e.executeSql(r, [], function (e) { var t = 'ALTER TABLE ' + Co + ' ADD COLUMN rev'; e.executeSql(t, [], function (e) { e.executeSql(Po, [], function (e) { var t = 'SELECT hex(doc_id_rev) as hex FROM ' + Co; e.executeSql(t, [], function (e, t) { for (var r = [], o = 0; o < t.rows.length; o++)r.push(t.rows.item(o)); n(r) }) }) }) }) } function a (e, t) { function n (e) { var n = 'SELECT COUNT(*) AS cnt FROM ' + Lo; e.executeSql(n, [], function (e, n) { function r () { var n = Tt(Go + ', ' + Io + '.id AS id', [Io, Co], Wo, null, Io + '.id '); n += ' LIMIT ' + a + ' OFFSET ' + i, i += a, e.executeSql(n, [], function (e, n) { function o (e, t) { var n = i[e] = i[e] || []; n.indexOf(t) === -1 && n.push(t) } if (!n.rows.length) return t(e); for (var i = {}, a = 0; a < n.rows.length; a++) for (var s = n.rows.item(a), u = xt(s.data, s.id, s.rev), c = Object.keys(u._attachments || {}), f = 0; f < c.length; f++) { var l = u._attachments[c[f]]; o(l.digest, s.seq) } var d = []; if (Object.keys(i).forEach(function (e) { var t = i[e]; t.forEach(function (t) { d.push([e, t]) }) }), !d.length) return r(); var h = 0; d.forEach(function (t) { var n = 'INSERT INTO ' + No + ' (digest, seq) VALUES (?,?)'; e.executeSql(n, t, function () { ++h === d.length && r() }) }) }) } var o = n.rows.item(0).cnt; if (!o) return t(e); var i = 0; var a = 10; r() }) } var r = 'CREATE TABLE IF NOT EXISTS ' + No + ' (digest, seq INTEGER)'; e.executeSql(r, [], function (e) { e.executeSql(Ko, [], function (e) { e.executeSql(Jo, [], n) }) }) } function s (e, t) { var n = 'ALTER TABLE ' + Lo + ' ADD COLUMN escaped TINYINT(1) DEFAULT 0'; e.executeSql(n, [], t) } function u (e, t) { var n = 'ALTER TABLE ' + Io + ' ADD COLUMN max_seq INTEGER'; e.executeSql(n, [], function (e) { var n = 'UPDATE ' + Io + ' SET max_seq=(SELECT MAX(seq) FROM ' + Co + ' WHERE doc_id=id)'; e.executeSql(n, [], function (e) { var n = "CREATE UNIQUE INDEX IF NOT EXISTS 'doc-max-seq-idx' ON " + Io + ' (max_seq)'; e.executeSql(n, [], t) }) }) } function f (e, t) { e.executeSql('SELECT HEX("a") AS hex', [], function (e, n) { var r = n.rows.item(0).hex; _ = r.length === 2 ? 'UTF-8' : 'UTF-16', t() }) } function d () { for (;E.length > 0;) { var e = E.pop(); e(null, b) } } function h (e, t) { if (t === 0) { var n = 'CREATE TABLE IF NOT EXISTS ' + Ro + ' (dbid, db_version INTEGER)'; var c = 'CREATE TABLE IF NOT EXISTS ' + Lo + ' (digest UNIQUE, escaped TINYINT(1), body BLOB)'; var f = 'CREATE TABLE IF NOT EXISTS ' + No + ' (digest, seq INTEGER)'; var l = 'CREATE TABLE IF NOT EXISTS ' + Io + ' (id unique, json, winningseq, max_seq INTEGER UNIQUE)'; var h = 'CREATE TABLE IF NOT EXISTS ' + Co + ' (seq INTEGER NOT NULL PRIMARY KEY AUTOINCREMENT, json, deleted TINYINT(1), doc_id, rev)'; var p = 'CREATE TABLE IF NOT EXISTS ' + Do + ' (id UNIQUE, rev, json)'; e.executeSql(c), e.executeSql(p), e.executeSql(f, [], function () { e.executeSql(Jo), e.executeSql(Ko) }), e.executeSql(l, [], function () { e.executeSql(Ho), e.executeSql(h, [], function () { e.executeSql(Uo), e.executeSql(Po), e.executeSql(n, [], function () { var t = 'INSERT INTO ' + Ro + ' (db_version, dbid) VALUES (?,?)'; b = F(); var n = [jo, b]; e.executeSql(t, n, function () { d() }) }) }) }) } else { var v = function () { var n = jo > t; n && e.executeSql('UPDATE ' + Ro + ' SET db_version = ' + jo); var r = 'SELECT dbid FROM ' + Ro; e.executeSql(r, [], function (e, t) { b = t.rows.item(0).dbid, d() }) }; var y = [r, o, i, a, s, u, v]; var _ = t; var m = function (e) { y[_ - 1](e, m), _++ }; m(e) } } function p () { q.transaction(function (e) { f(e, function () { v(e) }) }, jt(t), n) } function v (e) { var t = 'SELECT sql FROM sqlite_master WHERE tbl_name = ' + Ro; e.executeSql(t, [], function (e, t) { t.rows.length ? /db_version/.test(t.rows.item(0).sql) ? e.executeSql('SELECT db_version FROM ' + Ro, [], function (e, t) { var n = t.rows.item(0).db_version; h(e, n) }) : e.executeSql('ALTER TABLE ' + Ro + ' ADD COLUMN db_version INTEGER', [], function () { h(e, 1) }) : h(e, 0) }) } function y (e, t) { if (g._docCount !== -1) return t(g._docCount); var n = Tt('COUNT(' + Io + ".id) AS 'num'", [Io, Co], Wo, Co + '.deleted=0'); e.executeSql(n, [], function (e, n) { g._docCount = n.rows.item(0).num, t(g._docCount) }) } var _; var g = this; var b = null; var w = It(e); var E = []; g._docCount = -1, g._name = e.name; var S = pr.extend({}, e, { version: Fo, description: e.name, size: w }); var k = Rt(S); if (k.error) return jt(t)(k.error); var q = k.db; typeof q.readTransaction !== 'function' && (q.readTransaction = q.transaction), p(), g.type = function () { return 'websql' }, g._id = l(function (e) { e(null, b) }), g._info = function (e) { q.readTransaction(function (t) { y(t, function (n) { var r = 'SELECT MAX(seq) AS seq FROM ' + Co; t.executeSql(r, [], function (t, r) { var o = r.rows.item(0).seq || 0; e(null, { doc_count: n, update_seq: o, sqlite_plugin: q._sqlitePlugin, websql_encoding: _ }) }) }) }, jt(e)) }, g._bulkDocs = function (t, n, r) { Ct(e, t, n, g, q, Mo, r) }, g._get = function (e, t, n) { function r () { n(a, { doc: o, metadata: i, ctx: s }) } var o; var i; var a; var s = t.ctx; if (!s) return q.readTransaction(function (r) { g._get(e, pr.extend({ ctx: r }, t), n) }); var u, c; t.rev ? (u = Tt(Go, [Io, Co], Io + '.id=' + Co + '.doc_id', [Co + '.doc_id=?', Co + '.rev=?']), c = [e, t.rev]) : (u = Tt(Go, [Io, Co], Wo, Io + '.id=?'), c = [e]), s.executeSql(u, c, function (e, n) { if (!n.rows.length) return a = x(Lr, 'missing'), r(); var s = n.rows.item(0); return i = Xe(s.metadata), s.deleted && !t.rev ? (a = x(Lr, 'deleted'), r()) : (o = xt(s.data, i.id, s.rev), void r()) }) }, g._allDocs = function (e, t) { var n; var r = []; var o = 'startkey' in e ? e.startkey : !1; var i = 'endkey' in e ? e.endkey : !1; var a = 'key' in e ? e.key : !1; var s = 'descending' in e ? e.descending : !1; var u = 'limit' in e ? e.limit : -1; var c = 'skip' in e ? e.skip : 0; var f = e.inclusive_end !== !1; var l = []; var d = []; if (a !== !1)d.push(Io + '.id = ?'), l.push(a); else if (o !== !1 || i !== !1) { if (o !== !1 && (d.push(Io + '.id ' + (s ? '<=' : '>=') + ' ?'), l.push(o)), i !== !1) { var h = s ? '>' : '<'; f && (h += '='), d.push(Io + '.id ' + h + ' ?'), l.push(i) }a !== !1 && (d.push(Io + '.id = ?'), l.push(a)) }e.deleted !== 'ok' && d.push(Co + '.deleted = 0'), q.readTransaction(function (t) { y(t, function (o) { if (n = o, u !== 0) { var i = Tt(Go, [Io, Co], Wo, d, Io + '.id ' + (s ? 'DESC' : 'ASC')); i += ' LIMIT ' + u + ' OFFSET ' + c, t.executeSql(i, l, function (t, n) { for (var o = 0, i = n.rows.length; i > o; o++) { var a = n.rows.item(o); var s = Xe(a.metadata); var u = s.id; var c = xt(a.data, u, a.rev); var f = c._rev; var l = { id: u, key: u, value: { rev: f } }; if (e.include_docs && (l.doc = c, l.doc._rev = f, e.conflicts && (l.doc._conflicts = K(s)), Nt(l.doc, e, g, t)), a.deleted) { if (e.deleted !== 'ok') continue; l.value.deleted = !0, l.doc = null }r.push(l) } }) } }) }, jt(t), function () { t(null, { total_rows: n, offset: e.skip, rows: r }) }) }, g._changes = function (e) { function t () { var t = Io + '.json AS metadata, ' + Io + '.max_seq AS maxSeq, ' + Co + '.json AS winningDoc, ' + Co + '.rev AS winningRev '; var n = Io + ' JOIN ' + Co; var u = Io + '.id=' + Co + '.doc_id AND ' + Io + '.winningseq=' + Co + '.seq'; var c = ['maxSeq > ?']; var f = [e.since]; e.doc_ids && (c.push(Io + '.id IN ' + At(e.doc_ids.length)), f = f.concat(e.doc_ids)); var l = 'maxSeq ' + (r ? 'DESC' : 'ASC'); var d = Tt(t, n, u, c, l); var h = O(e); e.view || e.filter || (d += ' LIMIT ' + o); var p = e.since || 0; q.readTransaction(function (t) { t.executeSql(d, f, function (t, n) { function r (t) { return function () { e.onChange(t) } } for (var u = 0, c = n.rows.length; c > u; u++) { var f = n.rows.item(u); var l = Xe(f.metadata); p = f.maxSeq; var d = xt(f.winningDoc, l.id, f.winningRev); var v = e.processChange(d, l, e); v.seq = f.maxSeq; var y = h(v); if (typeof y === 'object') return e.complete(y); if (y && (s++, i && a.push(v), e.attachments && e.include_docs ? Nt(d, e, g, t, r(v)) : r(v)()), s === o) break } }) }, jt(e.complete), function () { e.continuous || e.complete(null, { results: a, last_seq: p }) }) } if (e = c(e), e.continuous) { var n = g._name + ':' + F(); return Mo.addListener(g._name, n, g, e), Mo.notify(g._name), { cancel: function () { Mo.removeListener(g._name, n) } } } var r = e.descending; e.since = e.since && !r ? e.since : 0; var o = 'limit' in e ? e.limit : -1; o === 0 && (o = 1); var i; i = 'return_docs' in e ? e.return_docs : 'returnDocs' in e ? e.returnDocs : !0; var a = []; var s = 0; t() }, g._close = function (e) { e() }, g._getAttachment = function (e, t, n, r, o) { var i; var a = r.ctx; var s = n.digest; var u = n.content_type; var c = 'SELECT escaped, CASE WHEN escaped = 1 THEN body ELSE HEX(body) END AS body FROM ' + Lo + ' WHERE digest=?'; a.executeSql(c, [s], function (e, t) { var n = t.rows.item(0); var a = n.escaped ? kt(n.body) : wt(n.body, _); i = r.binary ? De(a, u) : vo(a), o(null, i) }) }, g._getRevisionTree = function (e, t) { q.readTransaction(function (n) { var r = 'SELECT json AS metadata FROM ' + Io + ' WHERE id = ?'; n.executeSql(r, [e], function (e, n) { if (n.rows.length) { var r = Xe(n.rows.item(0).metadata); t(null, r.rev_tree) } else t(x(Lr)) }) }) }, g._doCompaction = function (e, t, n) { return t.length ? void q.transaction(function (n) { var r = 'SELECT json AS metadata FROM ' + Io + ' WHERE id = ?'; n.executeSql(r, [e], function (n, r) { var o = Xe(r.rows.item(0).metadata); P(o.rev_tree, function (e, n, r, o, i) { var a = n + '-' + r; t.indexOf(a) !== -1 && (i.status = 'missing') }); var i = 'UPDATE ' + Io + ' SET json = ? WHERE id = ?'; n.executeSql(i, [Qe(o), e]) }), Ot(t, e, n) }, jt(n), function () { n() }) : n() }, g._getLocal = function (e, t) { q.readTransaction(function (n) { var r = 'SELECT json, rev FROM ' + Do + ' WHERE id=?'; n.executeSql(r, [e], function (n, r) { if (r.rows.length) { var o = r.rows.item(0); var i = xt(o.json, e, o.rev); t(null, i) } else t(x(Lr)) }) }) }, g._putLocal = function (e, t, n) { function r (e) { var r, c; i ? (r = 'UPDATE ' + Do + ' SET rev=?, json=? WHERE id=? AND rev=?', c = [o, u, a, i]) : (r = 'INSERT INTO ' + Do + ' (id, rev, json) VALUES (?,?,?)', c = [a, o, u]), e.executeSql(r, c, function (e, r) { r.rowsAffected ? (s = { ok: !0, id: a, rev: o }, t.ctx && n(null, s)) : n(x(Dr)) }, function () { return n(x(Dr)), !1 }) } typeof t === 'function' && (n = t, t = {}), delete e._revisions; var o; var i = e._rev; var a = e._id; o = i ? e._rev = '0-' + (parseInt(i.split('-')[1], 10) + 1) : e._rev = '0-1'; var s; var u = qt(e); t.ctx ? r(t.ctx) : q.transaction(r, jt(n), function () { s && n(null, s) }) }, g._removeLocal = function (e, t, n) { function r (r) { var i = 'DELETE FROM ' + Do + ' WHERE id=? AND rev=?'; var a = [e._id, e._rev]; r.executeSql(i, a, function (r, i) { return i.rowsAffected ? (o = { ok: !0, id: e._id, rev: '0-0' }, void (t.ctx && n(null, o))) : n(x(Lr)) }) } typeof t === 'function' && (n = t, t = {}); var o; t.ctx ? r(t.ctx) : q.transaction(r, jt(n), function () { o && n(null, o) }) }, g._destroy = function (e, t) { Mo.removeAllListeners(g._name), q.transaction(function (e) { var t = [Io, Co, Lo, Ro, Do, No]; t.forEach(function (t) { e.executeSql('DROP TABLE IF EXISTS ' + t, []) }) }, jt(t), function () { m() && (delete window.localStorage['_pouch__websqldb_' + g._name], delete window.localStorage[g._name]), t(null, { ok: !0 }) }) } } function Mt () { try { return openDatabase('_pouch_validate_websql', 1, '', 1), !0 } catch (e) { return !1 } } function Ft () { if (typeof indexedDB === 'undefined' || indexedDB === null || !/iP(hone|od|ad)/.test(navigator.userAgent)) return !0; var e = m(); var t = '_pouch__websqldb_valid_' + navigator.userAgent; if (e && localStorage[t]) return localStorage[t] === '1'; var n = Mt(); return e && (localStorage[t] = n ? '1' : '0'), n } function Ut () { return typeof SQLitePlugin !== 'undefined' ? !0 : typeof openDatabase === 'undefined' ? !1 : Ft() } function Pt (e) { return function (t, n, r, o) { if (typeof sqlitePlugin !== 'undefined') { var i = pr.extend({}, e, { name: t, version: n, description: r, size: o }); return sqlitePlugin.openDatabase(i) } return openDatabase(t, n, r, o) } } function Ht (e, t) { var n = Pt(e); var r = pr.extend({ websql: n }, e); Bt.call(this, r, t) } function Jt (e) { e.adapter('websql', Ht, !0) } function Kt () { for (var e = {}, t = new qr(function (t, n) { e.resolve = t, e.reject = n }), n = new Array(arguments.length), r = 0; r < n.length; r++)n[r] = arguments[r]; return e.promise = t, qr.resolve().then(function () { return fetch.apply(null, n) }).then(function (t) { e.resolve(t) })['catch'](function (t) { e.reject(t) }), e } function Wt (e, t) { var n; var r; var o; var i = new Headers(); var a = { method: e.method, credentials: 'include', headers: i }; return e.json && (i.set('Accept', 'application/json'), i.set('Content-Type', e.headers['Content-Type'] || 'application/json')), e.body && e.body instanceof Blob ? Me(e.body, function (e) { a.body = e }) : e.body && e.processData && typeof e.body !== 'string' ? a.body = JSON.stringify(e.body) : 'body' in e ? a.body = e.body : a.body = null, Object.keys(e.headers).forEach(function (t) { e.headers.hasOwnProperty(t) && i.set(t, e.headers[t]) }), n = Kt(e.url, a), e.timeout > 0 && (r = setTimeout(function () { n.reject(new Error('Load timeout for resource: ' + e.url)) }, e.timeout)), n.promise.then(function (t) { return o = { statusCode: t.status }, e.timeout > 0 && clearTimeout(r), o.statusCode >= 200 && o.statusCode < 300 ? e.binary ? t.blob() : t.text() : t.json() }).then(function (e) { o.statusCode >= 200 && o.statusCode < 300 ? t(null, o, e) : t(e, o) })['catch'](function (e) { t(e, o) }), { abort: n.reject } } function Gt (e, t) { var n; var r; var o = !1; var i = function () { n.abort() }; var a = function () { o = !0, n.abort() }; n = e.xhr ? new e.xhr() : new XMLHttpRequest(); try { n.open(e.method, e.url) } catch (s) { t(s, { statusCode: 413 }) }n.withCredentials = 'withCredentials' in e ? e.withCredentials : !0, e.method === 'GET' ? delete e.headers['Content-Type'] : e.json && (e.headers.Accept = 'application/json', e.headers['Content-Type'] = e.headers['Content-Type'] || 'application/json', e.body && e.processData && typeof e.body !== 'string' && (e.body = JSON.stringify(e.body))), e.binary && (n.responseType = 'arraybuffer'), 'body' in e || (e.body = null); for (var u in e.headers)e.headers.hasOwnProperty(u) && n.setRequestHeader(u, e.headers[u]); return e.timeout > 0 && (r = setTimeout(a, e.timeout), n.onprogress = function () { clearTimeout(r), n.readyState !== 4 && (r = setTimeout(a, e.timeout)) }, typeof n.upload !== 'undefined' && (n.upload.onprogress = n.onprogress)), n.onreadystatechange = function () { if (n.readyState === 4) { var r = { statusCode: n.status }; if (n.status >= 200 && n.status < 300) { var i; i = e.binary ? Ce([n.response || ''], { type: n.getResponseHeader('Content-Type') }) : n.responseText, t(null, r, i) } else { var a = {}; if (o)a = new Error('ETIMEDOUT'), r.statusCode = 400; else try { a = JSON.parse(n.response) } catch (s) {}t(a, r) } } }, e.body && e.body instanceof Blob ? Me(e.body, function (e) { n.send(e) }) : n.send(e.body), { abort: i } } function Vt () { try { return new XMLHttpRequest(), !0 } catch (e) { return !1 } } function zt (e, t) { return Vo || e.xhr ? Gt(e, t) : Wt(e, t) } function Xt () { return '' } function Qt (e, t) { function n (t, n, r) { if (!e.binary && e.json && typeof t === 'string') try { t = JSON.parse(t) } catch (o) { return r(o) }Array.isArray(t) && (t = t.map(function (e) { return e.error || e.missing ? A(e) : e })), e.binary && zo(t, n), r(null, t, n) } function r (e, t) { var n, r; if (e.code && e.status) { var o = new Error(e.message || e.code); return o.status = e.status, t(o) } if (e.message && e.message === 'ETIMEDOUT') return t(e); try { n = JSON.parse(e.responseText), r = A(n) } catch (i) { r = A(e) }t(r) }e = c(e); var o = { method: 'GET', headers: {}, json: !0, processData: !0, timeout: 1e4, cache: !1 }; return e = pr.extend(o, e), e.json && (e.binary || (e.headers.Accept = 'application/json'), e.headers['Content-Type'] = e.headers['Content-Type'] || 'application/json'), e.binary && (e.encoding = null, e.json = !1), e.processData || (e.json = !1), zt(e, function (o, i, a) { if (o) return o.status = i ? i.statusCode : 400, r(o, t); var s; var u = i.headers && i.headers['content-type']; var c = a || Xt(); if (!e.binary && (e.json || !e.processData) && typeof c !== 'object' && (/json/.test(u) || /^[\s]*\{/.test(c) && /\}[\s]*$/.test(c))) try { c = JSON.parse(c.toString()) } catch (f) {}i.statusCode >= 200 && i.statusCode < 300 ? n(c, i, t) : (s = A(c), s.status = i.statusCode, t(s)) }) } function $t (e, t) { var n = navigator && navigator.userAgent ? navigator.userAgent.toLowerCase() : ''; var r = n.indexOf('safari') !== -1 && n.indexOf('chrome') === -1; var o = n.indexOf('msie') !== -1; var i = n.indexOf('edge') !== -1; var a = r || (o || i) && e.method === 'GET'; var s = 'cache' in e ? e.cache : !0; var u = /^blob:/.test(e.url); if (!u && (a || !s)) { var c = e.url.indexOf('?') !== -1; e.url += (c ? '&' : '?') + '_nonce=' + Date.now() } return Qt(e, t) } function Yt (e) { var t = e.doc && e.doc._attachments; t && Object.keys(t).forEach(function (e) { var n = t[e]; n.data = Re(n.data, n.content_type) }) } function Zt (e) { return /^_design/.test(e) ? '_design/' + encodeURIComponent(e.slice(8)) : /^_local/.test(e) ? '_local/' + encodeURIComponent(e.slice(7)) : encodeURIComponent(e) } function en (e) { return e._attachments && Object.keys(e._attachments) ? qr.all(Object.keys(e._attachments).map(function (t) { var n = e._attachments[t]; return n.data && typeof n.data !== 'string' ? new qr(function (e) { Be(n.data, e) }).then(function (e) { n.data = e }) : void 0 })) : qr.resolve() } function tn (e) { var t = R(e); (t.user || t.password) && (t.auth = { username: t.user, password: t.password }); var n = t.path.replace(/(^\/|\/$)/g, '').split('/'); return t.db = n.pop(), t.db.indexOf('%') === -1 && (t.db = encodeURIComponent(t.db)), t.path = n.join('/'), t } function nn (e, t) { return rn(e, e.db + '/' + t) } function rn (e, t) { var n = e.path ? '/' : ''; return e.protocol + '://' + e.host + (e.port ? ':' + e.port : '') + '/' + e.path + n + t } function on (e) { return '?' + Object.keys(e).map(function (t) { return t + '=' + encodeURIComponent(e[t]) }).join('&') } function an (e, t) {
        function n (e, t, n) { var r = e.ajax || {}; var o = pr.extend(c(p), r, t); return Zo(o.method + ' ' + o.url), s._ajax(o, n) } function r (e, t) { return new qr(function (r, o) { n(e, t, function (e, t) { return e ? o(e) : void r(t) }) }) } function o (e, t) { return d(e, gr(function (e) { i().then(function () { return t.apply(this, e) })['catch'](function (t) { var n = e.pop(); n(t) }) })) } function i () { if (e.skipSetup || e.skip_setup) return qr.resolve(); if (g) return g; var t = { method: 'GET', url: l }; return g = r({}, t)['catch'](function (e) { return e && e.status && e.status === 404 ? (k(404, 'PouchDB is just detecting if the remote exists.'), r({}, { method: 'PUT', url: l })) : qr.reject(e) })['catch'](function (e) { return e && e.status && e.status === 412 ? !0 : qr.reject(e) }), g['catch'](function () { g = null }), g } function a (e) { return e.split('/').map(encodeURIComponent).join('/') } var s = this; var u = tn; e.getHost && (u = e.getHost); var f = u(e.name, e); var l = nn(f, ''); e = c(e); var p = e.ajax || {}; if (s.getUrl = function () { return l }, s.getHeaders = function () { return p.headers || {} }, e.auth || f.auth) { var v = e.auth || f.auth; var _ = v.username + ':' + v.password; var m = vo(unescape(encodeURIComponent(_))); p.headers = p.headers || {}, p.headers.Authorization = 'Basic ' + m }s._ajax = $t; var g; setTimeout(function () { t(null, s) }), s.type = function () { return 'http' }, s.id = o('id', function (e) { n({}, { method: 'GET', url: rn(f, '') }, function (t, n) { var r = n && n.uuid ? n.uuid + f.db : nn(f, ''); e(null, r) }) }), s.request = o('request', function (e, t) { e.url = nn(f, e.url), n({}, e, t) }), s.compact = o('compact', function (e, t) { typeof e === 'function' && (t = e, e = {}), e = c(e), n(e, { url: nn(f, '_compact'), method: 'POST' }, function () { function n () { s.info(function (r, o) { o && !o.compact_running ? t(null, { ok: !0 }) : setTimeout(n, e.interval || 200) }) }n() }) }), s.bulkGet = d('bulkGet', function (e, t) { function r (t) { var r = {}; e.revs && (r.revs = !0), e.attachments && (r.attachments = !0), n({}, { url: nn(f, '_bulk_get' + on(r)), method: 'POST', body: { docs: e.docs } }, t) } function o () { function n (e) { return function (n, r) { s[e] = r.results, ++a === o && t(null, { results: j(s) }) } } for (var r = Qo, o = Math.ceil(e.docs.length / r), a = 0, s = new Array(o), u = 0; o > u; u++) { var c = h(e, ['revs', 'attachments']); c.ajax = p, c.docs = e.docs.slice(u * r, Math.min(e.docs.length, (u + 1) * r)), y(i, c, n(u)) } } var i = this; var a = rn(f, ''); var s = $o[a]; typeof s !== 'boolean' ? r(function (e, n) { if (e) { var r = Math.floor(e.status / 100); r === 4 || r === 5 ? ($o[a] = !1, k(e.status, 'PouchDB is just detecting if the remote supports the _bulk_get API.'), o()) : t(e) } else $o[a] = !0, t(null, n) }) : s ? r(t) : o() }), s._info = function (e) { i().then(function () { n({}, { method: 'GET', url: nn(f, '') }, function (t, n) { return t ? e(t) : (n.host = nn(f, ''), void e(null, n)) }) })['catch'](e) }, s.get = o('get', function (e, t, n) { function o (e) { var n = e._attachments; var o = n && Object.keys(n); return n && o.length ? qr.all(o.map(function (o) { var i = n[o]; var s = Zt(e._id) + '/' + a(o) + '?rev=' + e._rev; return r(t, { method: 'GET', url: nn(f, s), binary: !0 }).then(function (e) { return t.binary ? e : new qr(function (t) { Be(e, t) }) }).then(function (e) { delete i.stub, delete i.length, i.data = e }) })) : void 0 } function i (e) { return Array.isArray(e) ? qr.all(e.map(function (e) { return e.ok ? o(e.ok) : void 0 })) : o(e) } typeof t === 'function' && (n = t, t = {}), t = c(t); var s = {}; t.revs && (s.revs = !0), t.revs_info && (s.revs_info = !0), t.open_revs && (t.open_revs !== 'all' && (t.open_revs = JSON.stringify(t.open_revs)), s.open_revs = t.open_revs), t.rev && (s.rev = t.rev), t.conflicts && (s.conflicts = t.conflicts), e = Zt(e); var u = { method: 'GET', url: nn(f, e + on(s)) }; r(t, u).then(function (e) { return qr.resolve().then(function () { return t.attachments ? i(e) : void 0 }).then(function () { n(null, e) }) })['catch'](n) }), s.remove = o('remove', function (e, t, r, o) { var i; typeof t === 'string' ? (i = { _id: e, _rev: t }, typeof r === 'function' && (o = r, r = {})) : (i = e, typeof t === 'function' ? (o = t, r = {}) : (o = r, r = t)); var a = i._rev || r.rev; n(r, { method: 'DELETE', url: nn(f, Zt(i._id)) + '?rev=' + a }, o) }), s.getAttachment = o('getAttachment', function (e, t, r, o) { typeof r === 'function' && (o = r, r = {}); var i = r.rev ? '?rev=' + r.rev : ''; var s = nn(f, Zt(e)) + '/' + a(t) + i; n(r, { method: 'GET', url: s, binary: !0 }, o) }), s.removeAttachment = o('removeAttachment', function (e, t, r, o) { var i = nn(f, Zt(e) + '/' + a(t)) + '?rev=' + r; n({}, { method: 'DELETE', url: i }, o) }), s.putAttachment = o('putAttachment', function (e, t, r, o, i, s) { typeof i === 'function' && (s = i, i = o, o = r, r = null); var u = Zt(e) + '/' + a(t); var c = nn(f, u); if (r && (c += '?rev=' + r), typeof o === 'string') { var l; try { l = po(o) } catch (d) { return s(x(Ur, 'Attachment is not a valid base64 string')) }o = l ? De(l, i) : '' } var h = { headers: { 'Content-Type': i }, method: 'PUT', url: c, processData: !1, body: o, timeout: p.timeout || 6e4 }; n({}, h, s) }), s._bulkDocs = function (e, t, r) {
          e.new_edits = t.new_edits, i().then(function () { return qr.all(e.docs.map(en)) }).then(function () {
            n(t, { method: 'POST', url: nn(f, '_bulk_docs'), body: e }, function (e, t) {
              return e ? r(e) : (t.forEach(function (e) { e.ok = !0 }), void r(null, t))
            })
          })['catch'](r)
        }, s.allDocs = o('allDocs', function (e, t) { typeof e === 'function' && (t = e, e = {}), e = c(e); var n; var o = {}; var i = 'GET'; e.conflicts && (o.conflicts = !0), e.descending && (o.descending = !0), e.include_docs && (o.include_docs = !0), e.attachments && (o.attachments = !0), e.key && (o.key = JSON.stringify(e.key)), e.start_key && (e.startkey = e.start_key), e.startkey && (o.startkey = JSON.stringify(e.startkey)), e.end_key && (e.endkey = e.end_key), e.endkey && (o.endkey = JSON.stringify(e.endkey)), typeof e.inclusive_end !== 'undefined' && (o.inclusive_end = !!e.inclusive_end), typeof e.limit !== 'undefined' && (o.limit = e.limit), typeof e.skip !== 'undefined' && (o.skip = e.skip); var a = on(o); if (typeof e.keys !== 'undefined') { var s = 'keys=' + encodeURIComponent(JSON.stringify(e.keys)); s.length + a.length + 1 <= Yo ? a += '&' + s : (i = 'POST', n = { keys: e.keys }) }r(e, { method: i, url: nn(f, '_all_docs' + a), body: n }).then(function (n) { e.include_docs && e.attachments && e.binary && n.rows.forEach(Yt), t(null, n) })['catch'](t) }), s._changes = function (e) { var t = 'batch_size' in e ? e.batch_size : Xo; e = c(e), e.timeout = 'timeout' in e ? e.timeout : 'timeout' in p ? p.timeout : 3e4; var r; var o = e.timeout ? { timeout: e.timeout - 5e3 } : {}; var a = typeof e.limit !== 'undefined' ? e.limit : !1; r = 'return_docs' in e ? e.return_docs : 'returnDocs' in e ? e.returnDocs : !0; var s = a; if (e.style && (o.style = e.style), (e.include_docs || e.filter && typeof e.filter === 'function') && (o.include_docs = !0), e.attachments && (o.attachments = !0), e.continuous && (o.feed = 'longpoll'), e.conflicts && (o.conflicts = !0), e.descending && (o.descending = !0), 'heartbeat' in e ? e.heartbeat && (o.heartbeat = e.heartbeat) : o.heartbeat = 1e4, e.filter && typeof e.filter === 'string' && (o.filter = e.filter), e.view && typeof e.view === 'string' && (o.filter = '_view', o.view = e.view), e.query_params && typeof e.query_params === 'object') for (var u in e.query_params)e.query_params.hasOwnProperty(u) && (o[u] = e.query_params[u]); var l; var d = 'GET'; if (e.doc_ids) { o.filter = '_doc_ids'; var h = JSON.stringify(e.doc_ids); h.length < Yo ? o.doc_ids = h : (d = 'POST', l = { doc_ids: e.doc_ids }) } var v; var y; var _ = function (r, u) { if (!e.aborted) { o.since = r, typeof o.since === 'object' && (o.since = JSON.stringify(o.since)), e.descending ? a && (o.limit = s) : o.limit = !a || s > t ? t : s; var c = { method: d, url: nn(f, '_changes' + on(o)), timeout: e.timeout, body: l }; y = r, e.aborted || i().then(function () { v = n(e, c, u) })['catch'](u) } }; var m = { results: [] }; var g = function (n, o) { if (!e.aborted) { var i = 0; if (o && o.results) { i = o.results.length, m.last_seq = o.last_seq; var u = {}; u.query = e.query_params, o.results = o.results.filter(function (t) { s--; var n = O(e)(t); return n && (e.include_docs && e.attachments && e.binary && Yt(t), r && m.results.push(t), e.onChange(t)), n }) } else if (n) return e.aborted = !0, void e.complete(n); o && o.last_seq && (y = o.last_seq); var c = a && s <= 0 || o && t > i || e.descending; (!e.continuous || a && s <= 0) && c ? e.complete(null, m) : setTimeout(function () { _(y, g) }, 0) } }; return _(e.since || 0, g), { cancel: function () { e.aborted = !0, v && v.abort() } } }, s.revsDiff = o('revsDiff', function (e, t, r) { typeof t === 'function' && (r = t, t = {}), n(t, { method: 'POST', url: nn(f, '_revs_diff'), body: e }, r) }), s._close = function (e) { e() }, s._destroy = function (e, t) { n(e, { url: nn(f, ''), method: 'DELETE' }, function (e, n) { return e && e.status && e.status !== 404 ? t(e) : void t(null, n) }) }
      } function sn (e) { e.adapter('http', an, !1), e.adapter('https', an, !1) } function un () { this.promise = new qr(function (e) { e() }) } function cn (e) { var t = e.db; var n = e.viewName; var r = e.map; var o = e.reduce; var i = e.temporary; var a = r.toString() + (o && o.toString()) + 'undefined'; if (!i && t._cachedViews) { var s = t._cachedViews[a]; if (s) return qr.resolve(s) } return t.info().then(function (e) { function s (e) { e.views = e.views || {}; var t = n; t.indexOf('/') === -1 && (t = n + '/' + n); var r = e.views[t] = e.views[t] || {}; if (!r[u]) return r[u] = !0, e } var u = e.db_name + '-mrview-' + (i ? 'temp' : Je(a)); return N(t, '_local/mrviews', s).then(function () { return t.registerDependentDatabase(u).then(function (e) { var n = e.db; n.auto_compaction = !0; var s = { name: u, db: n, sourceDB: t, adapter: t.adapter, mapFun: r, reduceFun: o }; return s.db.get('_local/lastSeq')['catch'](function (e) { if (e.status !== 404) throw e }).then(function (e) { return s.seq = e ? e.seq : 0, i || (t._cachedViews = t._cachedViews || {}, t._cachedViews[a] = s, s.db.once('destroyed', function () { delete t._cachedViews[a] })), s }) }) }) }) } function fn (e, t, n, r, o, i) { return wr('return (' + e.replace(/;\s*$/, '') + ');', { emit: t, sum: n, log: r, isArray: o, toJSON: i }) } function ln (e) { return e.indexOf('/') === -1 ? [e, e] : e.split('/') } function dn (e) { return e.length === 1 && /^1-/.test(e[0].rev) } function hn (e, t) { try { e.emit('error', t) } catch (n) { w('error', "The user's map/reduce function threw an uncaught error.\nYou can debug this error by doing:\nmyDatabase.on('error', function (err) { debugger; });\nPlease double-check your map/reduce function."), w('error', t) } } function pn (e, t, n) { try { return { output: t.apply(null, n) } } catch (r) { return hn(e, r), { error: r } } } function vn (e, t) { var n = kr.collate(e.key, t.key); return n !== 0 ? n : kr.collate(e.value, t.value) } function yn (e, t, n) { return n = n || 0, typeof t === 'number' ? e.slice(n, t + n) : n > 0 ? e.slice(n) : e } function _n (e) { var t = e.value; var n = t && typeof t === 'object' && t._id || e.id; return n } function mn (e) { e.rows.forEach(function (e) { var t = e.doc && e.doc._attachments; t && Object.keys(t).forEach(function (e) { var n = t[e]; t[e].data = Re(n.data, n.content_type) }) }) } function gn (e) { return function (t) { return e.include_docs && e.attachments && e.binary && mn(t), t } } function bn (e) { var t = 'builtin ' + e + ' function requires map values to be numbers or number arrays'; return new Kn(t) } function wn (e) { for (var t = 0, n = 0, r = e.length; r > n; n++) { var o = e[n]; if (typeof o !== 'number') { if (!Array.isArray(o)) throw bn('_sum'); t = typeof t === 'number' ? [t] : t; for (var i = 0, a = o.length; a > i; i++) { var s = o[i]; if (typeof s !== 'number') throw bn('_sum'); typeof t[i] === 'undefined' ? t.push(s) : t[i] += s } } else typeof t === 'number' ? t += o : t[0] += o } return t } function En (e, t, n, r) { var o = t[e]; typeof o !== 'undefined' && (r && (o = encodeURIComponent(JSON.stringify(o))), n.push(e + '=' + o)) } function Sn (e) { if (typeof e !== 'undefined') { var t = Number(e); return isNaN(t) || t !== parseInt(e, 10) ? e : t } } function kn (e) { return e.group_level = Sn(e.group_level), e.limit = Sn(e.limit), e.skip = Sn(e.skip), e } function qn (e) { if (e) { if (typeof e !== 'number') return new Hn('Invalid value for integer: "' + e + '"'); if (e < 0) return new Hn('Invalid value for positive integer: "' + e + '"') } } function xn (e, t) { var n = e.descending ? 'endkey' : 'startkey'; var r = e.descending ? 'startkey' : 'endkey'; if (typeof e[n] !== 'undefined' && typeof e[r] !== 'undefined' && kr.collate(e[n], e[r]) > 0) throw new Hn('No rows can match your key range, reverse your start_key and end_key or set {descending : true}'); if (t.reduce && e.reduce !== !1) { if (e.include_docs) throw new Hn('{include_docs:true} is invalid for reduce'); if (e.keys && e.keys.length > 1 && !e.group && !e.group_level) throw new Hn('Multi-key fetches for reduce views must use {group: true}') }['group_level', 'limit', 'skip'].forEach(function (t) { var n = qn(e[t]); if (n) throw n }) } function An (e, t, n) { var r; var o = []; var i = 'GET'; if (En('reduce', n, o), En('include_docs', n, o), En('attachments', n, o), En('limit', n, o), En('descending', n, o), En('group', n, o), En('group_level', n, o), En('skip', n, o), En('stale', n, o), En('conflicts', n, o), En('startkey', n, o, !0), En('start_key', n, o, !0), En('endkey', n, o, !0), En('end_key', n, o, !0), En('inclusive_end', n, o), En('key', n, o, !0), o = o.join('&'), o = o === '' ? '' : '?' + o, typeof n.keys !== 'undefined') { var a = 2e3; var s = 'keys=' + encodeURIComponent(JSON.stringify(n.keys)); s.length + o.length + 1 <= a ? o += (o[0] === '?' ? '&' : '?') + s : (i = 'POST', typeof t === 'string' ? r = { keys: n.keys } : t.keys = n.keys) } if (typeof t === 'string') { var u = ln(t); return e.request({ method: i, url: '_design/' + u[0] + '/_view/' + u[1] + o, body: r }).then(gn(n)) } return r = r || {}, Object.keys(t).forEach(function (e) { Array.isArray(t[e]) ? r[e] = t[e] : r[e] = t[e].toString() }), e.request({ method: 'POST', url: '_temp_view' + o, body: r }).then(gn(n)) } function Tn (e, t, n) { return new qr(function (r, o) { e._query(t, n, function (e, t) { return e ? o(e) : void r(t) }) }) } function On (e) { return new qr(function (t, n) { e._viewCleanup(function (e, r) { return e ? n(e) : void t(r) }) }) } function jn (e) { return function (t) { if (t.status === 404) return e; throw t } } function In (e, t, n) { function r () { return dn(f) ? qr.resolve(s) : t.db.get(a)['catch'](jn(s)) } function o (e) { return e.keys.length ? t.db.allDocs({ keys: e.keys, include_docs: !0 }) : qr.resolve({ rows: [] }) } function i (e, t) { for (var n = [], r = {}, o = 0, i = t.rows.length; i > o; o++) { var a = t.rows[o]; var s = a.doc; if (s && (n.push(s), r[s._id] = !0, s._deleted = !c[s._id], !s._deleted)) { var u = c[s._id]; 'value' in u && (s.value = u.value) } } var f = Object.keys(c); return f.forEach(function (e) { if (!r[e]) { var t = { _id: e }; var o = c[e]; 'value' in o && (t.value = o.value), n.push(t) } }), e.keys = oi(f.concat(e.keys)), n.push(e), n } var a = '_local/doc_' + e; var s = { _id: a, keys: [] }; var u = n[e]; var c = u.indexableKeysToKeyValues; var f = u.changes; return r().then(function (e) { return o(e).then(function (t) { return i(e, t) }) }) } function Cn (e, t, n) { var r = '_local/lastSeq'; return e.db.get(r)['catch'](jn({ _id: r, seq: 0 })).then(function (r) { var o = Object.keys(t); return qr.all(o.map(function (n) { return In(n, e, t) })).then(function (t) { var o = j(t); return r.seq = n, o.push(r), e.db.bulkDocs({ docs: o }) }) }) } function Ln (e) { var t = typeof e === 'string' ? e : e.name; var n = ii[t]; return n || (n = ii[t] = new un()), n } function Dn (e) { return ri(Ln(e), function () { return Rn(e) })() } function Rn (e) { function t (e, t) { var n = { id: o._id, key: kr.normalizeKey(e) }; typeof t !== 'undefined' && t !== null && (n.value = kr.normalizeKey(t)), r.push(n) } function n (t, n) { return function () { return Cn(e, t, n) } } var r, o, i; if (typeof e.mapFun === 'function' && e.mapFun.length === 2) { var a = e.mapFun; i = function (e) { return a(e, t) } } else i = fn(e.mapFun.toString(), t, wn, ui, Array.isArray, JSON.parse); var s = e.seq || 0; var u = new un(); return new qr(function (t, a) { function c () { u.finish().then(function () { e.seq = s, t() }) } function f () { function t (e) { a(e) }e.sourceDB.changes({ conflicts: !0, include_docs: !0, style: 'all_docs', since: s, limit: si }).on('complete', function (t) { var a = t.results; if (!a.length) return c(); for (var l = {}, d = 0, h = a.length; h > d; d++) { var p = a[d]; if (p.doc._id[0] !== '_') { r = [], o = p.doc, o._deleted || pn(e.sourceDB, i, [o]), r.sort(vn); for (var v, y = {}, _ = 0, m = r.length; m > _; _++) { var g = r[_]; var b = [g.key, g.id]; kr.collate(g.key, v) === 0 && b.push(_); var w = kr.toIndexableString(b); y[w] = g, v = g.key }l[p.doc._id] = { indexableKeysToKeyValues: y, changes: p.changes } }s = p.seq } return u.add(n(l, s)), a.length < si ? c() : f() }).on('error', t) }f() }) } function Nn (e, t, n) { n.group_level === 0 && delete n.group_level; var r; var o = n.group || n.group_level; r = ci[e.reduceFun] ? ci[e.reduceFun] : fn(e.reduceFun.toString(), null, wn, ui, Array.isArray, JSON.parse); var i = []; var a = isNaN(n.group_level) ? Number.POSITIVE_INFINITY : n.group_level; t.forEach(function (e) { var t = i[i.length - 1]; var n = o ? e.key : null; return o && Array.isArray(n) && (n = n.slice(0, a)), t && kr.collate(t.groupKey, n) === 0 ? (t.keys.push([e.key, e.id]), void t.values.push(e.value)) : void i.push({ keys: [[e.key, e.id]], values: [e.value], groupKey: n }) }), t = []; for (var s = 0, u = i.length; u > s; s++) { var c = i[s]; var f = pn(e.sourceDB, r, [c.keys, c.values, !1]); if (f.error && f.error instanceof Kn) throw f.error; t.push({ value: f.error ? null : f.output, key: c.groupKey }) } return { rows: yn(t, n.limit, n.skip) } } function Bn (e, t) { return ri(Ln(e), function () { return Mn(e, t) })() } function Mn (e, t) { function n (t) { return t.include_docs = !0, e.db.allDocs(t).then(function (e) { return o = e.total_rows, e.rows.map(function (e) { if ('value' in e.doc && typeof e.doc.value === 'object' && e.doc.value !== null) { var t = Object.keys(e.doc.value).sort(); var n = ['id', 'key', 'value']; if (!(n > t || t > n)) return e.doc.value } var r = kr.parseIndexableString(e.doc._id); return { key: r[0], id: r[1], value: 'value' in e.doc ? e.doc.value : null } }) }) } function r (n) { var r; if (r = i ? Nn(e, n, t) : { total_rows: o, offset: a, rows: n }, t.include_docs) { var s = oi(n.map(_n)); return e.sourceDB.allDocs({ keys: s, include_docs: !0, conflicts: t.conflicts, attachments: t.attachments, binary: t.binary }).then(function (e) { var t = {}; return e.rows.forEach(function (e) { e.doc && (t['$' + e.id] = e.doc) }), n.forEach(function (e) { var n = _n(e); var r = t['$' + n]; r && (e.doc = r) }), r }) } return r } var o; var i = e.reduceFun && t.reduce !== !1; var a = t.skip || 0; if (typeof t.keys === 'undefined' || t.keys.length || (t.limit = 0, delete t.keys), typeof t.keys !== 'undefined') { var s = t.keys; var u = s.map(function (e) { var t = { startkey: kr.toIndexableString([e]), endkey: kr.toIndexableString([e, {}]) }; return n(t) }); return qr.all(u).then(j).then(r) } var c = { descending: t.descending }; if (t.start_key && (t.startkey = t.start_key), t.end_key && (t.endkey = t.end_key), typeof t.startkey !== 'undefined' && (c.startkey = t.descending ? kr.toIndexableString([t.startkey, {}]) : kr.toIndexableString([t.startkey])), typeof t.endkey !== 'undefined') { var f = t.inclusive_end !== !1; t.descending && (f = !f), c.endkey = kr.toIndexableString(f ? [t.endkey, {}] : [t.endkey]) } if (typeof t.key !== 'undefined') { var l = kr.toIndexableString([t.key]); var d = kr.toIndexableString([t.key, {}]); c.descending ? (c.endkey = l, c.startkey = d) : (c.startkey = l, c.endkey = d) } return i || (typeof t.limit === 'number' && (c.limit = t.limit), c.skip = a), n(c).then(r) } function Fn (e) { return e.request({ method: 'POST', url: '_view_cleanup' }) } function Un (e) { return e.get('_local/mrviews').then(function (t) { var n = {}; Object.keys(t.views).forEach(function (e) { var t = ln(e); var r = '_design/' + t[0]; var o = t[1]; n[r] = n[r] || {}, n[r][o] = !0 }); var r = { keys: Object.keys(n), include_docs: !0 }; return e.allDocs(r).then(function (r) { var o = {}; r.rows.forEach(function (e) { var r = e.key.substring(8); Object.keys(n[e.key]).forEach(function (n) { var i = r + '/' + n; t.views[i] || (i = n); var a = Object.keys(t.views[i]); var s = e.doc && e.doc.views && e.doc.views[n]; a.forEach(function (e) { o[e] = o[e] || s }) }) }); var i = Object.keys(o).filter(function (e) { return !o[e] }); var a = i.map(function (t) { return ri(Ln(t), function () { return new e.constructor(t, e.__opts).destroy() })() }); return qr.all(a).then(function () { return { ok: !0 } }) }) }, jn({ ok: !0 })) } function Pn (e, t, r) { if (e.type() === 'http') return An(e, t, r); if (typeof e._query === 'function') return Tn(e, t, r); if (typeof t !== 'string') { xn(r, t); var o = { db: e, viewName: 'temp_view/temp_view', map: t.map, reduce: t.reduce, temporary: !0 }; return ai.add(function () { return cn(o).then(function (e) { function t () { return e.db.destroy() } return ni(Dn(e).then(function () { return Bn(e, r) }), t) }) }), ai.finish() } var i = t; var a = ln(i); var s = a[0]; var u = a[1]; return e.get('_design/' + s).then(function (t) { var o = t.views && t.views[u]; if (!o || typeof o.map !== 'string') throw new Jn('ddoc ' + s + ' has no view named ' + u); xn(r, o); var a = { db: e, viewName: i, map: o.map, reduce: o.reduce }; return cn(a).then(function (e) { return r.stale === 'ok' || r.stale === 'update_after' ? (r.stale === 'update_after' && n.nextTick(function () { Dn(e) }), Bn(e, r)) : Dn(e).then(function () { return Bn(e, r) }) }) }) } function Hn (e) { this.status = 400, this.name = 'query_parse_error', this.message = e, this.error = !0; try { Error.captureStackTrace(this, Hn) } catch (t) {} } function Jn (e) { this.status = 404, this.name = 'not_found', this.message = e, this.error = !0; try { Error.captureStackTrace(this, Jn) } catch (t) {} } function Kn (e) { this.status = 500, this.name = 'invalid_value', this.message = e, this.error = !0; try { Error.captureStackTrace(this, Kn) } catch (t) {} } function Wn (e) { return /^1-/.test(e) } function Gn (e, t, n) { return !e._attachments || !e._attachments[n] || e._attachments[n].digest !== t._attachments[n].digest } function Vn (e, t) { var n = Object.keys(t._attachments); return qr.all(n.map(function (n) { return e.getAttachment(t._id, n, { rev: t._rev }) })) } function zn (e, t, n) { var r = t.type() === 'http' && e.type() !== 'http'; var o = Object.keys(n._attachments); return r ? e.get(n._id).then(function (r) { return qr.all(o.map(function (o) { return Gn(r, n, o) ? t.getAttachment(n._id, o) : e.getAttachment(r._id, o) })) })['catch'](function (e) { if (e.status !== 404) throw e; return Vn(t, n) }) : Vn(t, n) } function Xn (e) { var t = []; return Object.keys(e).forEach(function (n) { var r = e[n].missing; r.forEach(function (e) { t.push({ id: n, rev: e }) }) }), { docs: t, revs: !0 } } function Qn (e, t, n, r) { function o () { var o = Xn(n); if (o.docs.length) return e.bulkGet(o).then(function (n) { if (r.cancelled) throw new Error('cancelled'); return qr.all(n.results.map(function (n) { return qr.all(n.docs.map(function (n) { var r = n.ok; return n.error && (l = !1), r && r._attachments ? zn(t, e, r).then(function (e) { var t = Object.keys(r._attachments); return e.forEach(function (e, n) { var o = r._attachments[t[n]]; delete o.stub, delete o.length, o.data = e }), r }) : r })) })).then(function (e) { f = f.concat(j(e).filter(Boolean)) }) }) } function i (e) { return e._attachments && Object.keys(e._attachments).length > 0 } function a (t) { return e.allDocs({ keys: t, include_docs: !0 }).then(function (e) { if (r.cancelled) throw new Error('cancelled'); e.rows.forEach(function (e) { !e.deleted && e.doc && Wn(e.value.rev) && !i(e.doc) && (f.push(e.doc), delete n[e.id]) }) }) } function s () { var e = Object.keys(n).filter(function (e) { var t = n[e].missing; return t.length === 1 && Wn(t[0]) }); return e.length > 0 ? a(e) : void 0 } function u () { return { ok: l, docs: f } }n = c(n); var f = []; var l = !0; return qr.resolve().then(s).then(o).then(u) } function $n (e, t, n, r, o) { return e.get(t)['catch'](function (n) { if (n.status === 404) return e.type() === 'http' && k(404, 'PouchDB is just checking if a remote checkpoint exists.'), { session_id: r, _id: t, history: [], replicator: pi, version: hi }; throw n }).then(function (i) { return o.cancelled ? void 0 : (i.history = (i.history || []).filter(function (e) { return e.session_id !== r }), i.history.unshift({ last_seq: n, session_id: r }), i.history = i.history.slice(0, vi), i.version = hi, i.replicator = pi, i.session_id = r, i.last_seq = n, e.put(i)['catch'](function (i) { if (i.status === 409) return $n(e, t, n, r, o); throw i })) }) } function Yn (e, t, n, r) { this.src = e, this.target = t, this.id = n, this.returnValue = r } function Zn (e, t) { return e.session_id === t.session_id ? { last_seq: e.last_seq, history: e.history } : er(e.history, t.history) } function er (e, t) { var n = e[0]; var r = e.slice(1); var o = t[0]; var i = t.slice(1); if (!n || t.length === 0) return { last_seq: yi, history: [] }; var a = n.session_id; if (tr(a, t)) return { last_seq: n.last_seq, history: e }; var s = o.session_id; return tr(s, r) ? { last_seq: o.last_seq, history: i } : er(r, i) } function tr (e, t) { var n = t[0]; var r = t.slice(1); return e && t.length !== 0 ? e === n.session_id ? !0 : tr(e, r) : !1 } function nr (e) { return typeof e.status === 'number' && Math.floor(e.status / 100) === 4 } function rr (e, t, n, r) { return e.retry === !1 ? (t.emit('error', n), void t.removeAllListeners()) : (typeof e.back_off_function !== 'function' && (e.back_off_function = S), t.emit('requestError', n), t.state !== 'active' && t.state !== 'pending' || (t.emit('paused', n), t.state = 'stopped', t.once('active', function () { e.current_back_off = mi })), e.current_back_off = e.current_back_off || mi, e.current_back_off = e.back_off_function(e.current_back_off), void setTimeout(r, e.current_back_off)) } function or (e) { return Object.keys(e).sort(kr.collate).reduce(function (t, n) { return t[n] = e[n], t }, {}) } function ir (e, t, n) { var r = n.doc_ids ? n.doc_ids.sort(kr.collate) : ''; var o = n.filter ? n.filter.toString() : ''; var i = ''; var a = ''; return n.filter && n.query_params && (i = JSON.stringify(or(n.query_params))), n.filter && n.filter === '_view' && (a = n.view.toString()), qr.all([e.id(), t.id()]).then(function (e) { var t = e[0] + e[1] + o + a + i + r; return new qr(function (e) { He(t, e) }) }).then(function (e) { return e = e.replace(/\//g, '.').replace(/\+/g, '_'), '_local/' + e }) } function ar (e, t, n, r, o) { function i () { return S ? qr.resolve() : ir(e, t, n).then(function (n) { E = n, S = new Yn(e, t, E, r) }) } function a () { if (B = [], w.docs.length !== 0) { var e = w.docs; return t.bulkDocs({ docs: e, new_edits: !1 }).then(function (t) { if (r.cancelled) throw p(), new Error('cancelled'); var n = []; var i = {}; t.forEach(function (e) { e.error && (o.doc_write_failures++, n.push(e), i[e.id] = e) }), N = N.concat(n), o.docs_written += w.docs.length - n.length; var a = n.filter(function (e) { return e.name !== 'unauthorized' && e.name !== 'forbidden' }); if (e.forEach(function (e) { var t = i[e._id]; t ? r.emit('denied', c(t)) : B.push(e) }), a.length > 0) { var s = new Error('bulkDocs error'); throw s.other_errors = n, h('target.bulkDocs failed to write docs', s), new Error('bulkWrite partial failure') } }, function (t) { throw o.doc_write_failures += e.length, t }) } } function s () { if (w.error) throw new Error('There was a problem getting docs.'); o.last_seq = j = w.seq; var e = c(o); return B.length && (e.docs = B, r.emit('change', e)), x = !0, S.writeCheckpoint(w.seq, M).then(function () { if (x = !1, r.cancelled) throw p(), new Error('cancelled'); w = void 0, m() })['catch'](b) } function u () { var e = {}; return w.changes.forEach(function (t) { t.id !== '_user/' && (e[t.id] = t.changes.map(function (e) { return e.rev })) }), t.revsDiff(e).then(function (e) { if (r.cancelled) throw p(), new Error('cancelled'); w.diffs = e }) } function f () { return Qn(e, t, w.diffs, r).then(function (e) { w.error = !e.ok, e.docs.forEach(function (e) { delete w.diffs[e._id], o.docs_read++, w.docs.push(e) }) }) } function l () { if (!r.cancelled && !w) { if (k.length === 0) return void d(!0); w = k.shift(), u().then(f).then(a).then(s).then(l)['catch'](function (e) { h('batch processing terminated with error', e) }) } } function d (e) { return q.changes.length === 0 ? void (k.length !== 0 || w || ((I && U.live || A) && (r.state = 'pending', r.emit('paused')), A && p())) : void ((e || A || q.changes.length >= C) && (k.push(q), q = { seq: 0, changes: [], docs: [] }, r.state !== 'pending' && r.state !== 'stopped' || (r.state = 'active', r.emit('active')), l())) } function h (e, t) { T || (t.message || (t.message = e), o.ok = !1, o.status = 'aborting', o.errors.push(t), N = N.concat(t), k = [], q = { seq: 0, changes: [], docs: [] }, p()) } function p () { if (!(T || r.cancelled && (o.status = 'cancelled', x))) { o.status = o.status || 'complete', o.end_time = new Date(), o.last_seq = j, T = !0; var i = N.filter(function (e) { return e.name !== 'unauthorized' && e.name !== 'forbidden' }); if (i.length > 0) { var a = N.pop(); N.length > 0 && (a.other_errors = N), a.result = o, rr(n, r, a, function () { ar(e, t, n, r) }) } else o.errors = N, r.emit('complete', o), r.removeAllListeners() } } function v (e) { if (r.cancelled) return p(); var t = O(n)(e); t && (q.seq = e.seq, q.changes.push(e), d(k.length === 0 && U.live)) } function y (e) { if (D = !1, r.cancelled) return p(); if (e.results.length > 0)U.since = e.last_seq, m(), d(!0); else { var t = function () { I ? (U.live = !0, m()) : A = !0, d(!0) }; w || e.results.length !== 0 ? t() : (x = !0, S.writeCheckpoint(e.last_seq, M).then(function () { x = !1, o.last_seq = j = e.last_seq, t() })['catch'](b)) } } function _ (e) { return D = !1, r.cancelled ? p() : void h('changes rejected', e) } function m () { function t () { i.cancel() } function o () { r.removeListener('cancel', t) } if (!D && !A && k.length < L) { D = !0, r._changes && (r.removeListener('cancel', r._abortChanges), r._changes.cancel()), r.once('cancel', t); var i = e.changes(U).on('change', v); i.then(o, o), i.then(y)['catch'](_), n.retry && (r._changes = i, r._abortChanges = t) } } function g () { i().then(function () { return r.cancelled ? void p() : S.getCheckpoint().then(function (e) { j = e, U = { since: j, limit: C, batch_size: C, style: 'all_docs', doc_ids: R, return_docs: !0 }, n.filter && (typeof n.filter !== 'string' ? U.include_docs = !0 : U.filter = n.filter), 'heartbeat' in n && (U.heartbeat = n.heartbeat), 'timeout' in n && (U.timeout = n.timeout), n.query_params && (U.query_params = n.query_params), n.view && (U.view = n.view), m() }) })['catch'](function (e) { h('getCheckpoint rejected with ', e) }) } function b (e) { throw x = !1, h('writeCheckpoint completed with error', e), e } var w; var E; var S; var k = []; var q = { seq: 0, changes: [], docs: [] }; var x = !1; var A = !1; var T = !1; var j = 0; var I = n.continuous || n.live || !1; var C = n.batch_size || 100; var L = n.batches_limit || 10; var D = !1; var R = n.doc_ids; var N = []; var B = []; var M = F(); o = o || { ok: !0, start_time: new Date(), docs_read: 0, docs_written: 0, doc_write_failures: 0, errors: [] }; var U = {}; return r.ready(e, t), r.cancelled ? void p() : (r._addedListeners || (r.once('cancel', p), typeof n.complete === 'function' && (r.once('error', n.complete), r.once('complete', function (e) { n.complete(null, e) })), r._addedListeners = !0), void (typeof n.since === 'undefined' ? g() : i().then(function () { return x = !0, S.writeCheckpoint(n.since, M) }).then(function () { return x = !1, r.cancelled ? void p() : (j = n.since, void g()) })['catch'](b))) } function sr () { br.EventEmitter.call(this), this.cancelled = !1, this.state = 'pending'; var e = this; var t = new qr(function (t, n) { e.once('complete', t), e.once('error', n) }); e.then = function (e, n) { return t.then(e, n) }, e['catch'] = function (e) { return t['catch'](e) }, e['catch'](function () {}) } function ur (e, t) { var n = t.PouchConstructor; return typeof e === 'string' ? new n(e, t) : e } function cr (e, t, n, r) { if (typeof n === 'function' && (r = n, n = {}), typeof n === 'undefined' && (n = {}), n.doc_ids && !Array.isArray(n.doc_ids)) throw x(Kr, '`doc_ids` filter parameter is not a list.'); n.complete = r, n = c(n), n.continuous = n.continuous || n.live, n.retry = 'retry' in n ? n.retry : !1, n.PouchConstructor = n.PouchConstructor || this; var o = new sr(n); var i = ur(e, n); var a = ur(t, n); return ar(i, a, n, o), o } function fr (e, t, n, r) { return typeof n === 'function' && (r = n, n = {}), typeof n === 'undefined' && (n = {}), n = c(n), n.PouchConstructor = n.PouchConstructor || this, e = ur(e, n), t = ur(t, n), new lr(e, t, n, r) } function lr (e, t, n, r) { function o (e) { h.emit('change', { direction: 'pull', change: e }) } function i (e) { h.emit('change', { direction: 'push', change: e }) } function a (e) { h.emit('denied', { direction: 'push', doc: e }) } function s (e) { h.emit('denied', { direction: 'pull', doc: e }) } function u () { h.pushPaused = !0, h.pullPaused && h.emit('paused') } function c () { h.pullPaused = !0, h.pushPaused && h.emit('paused') } function f () { h.pushPaused = !1, h.pullPaused && h.emit('active', { direction: 'push' }) } function l () { h.pullPaused = !1, h.pushPaused && h.emit('active', { direction: 'pull' }) } function d (e) { return function (t, n) { var r = t === 'change' && (n === o || n === i); var d = t === 'denied' && (n === s || n === a); var p = t === 'paused' && (n === c || n === u); var v = t === 'active' && (n === l || n === f); (r || d || p || v) && (t in y || (y[t] = {}), y[t][e] = !0, Object.keys(y[t]).length === 2 && h.removeAllListeners(t)) } } var h = this; this.canceled = !1; var p = n.push ? pr.extend({}, n, n.push) : n; var v = n.pull ? pr.extend({}, n, n.pull) : n; this.push = cr(e, t, p), this.pull = cr(t, e, v), this.pushPaused = !0, this.pullPaused = !0; var y = {}; n.live && (this.push.on('complete', h.pull.cancel.bind(h.pull)), this.pull.on('complete', h.push.cancel.bind(h.push))), this.on('newListener', function (e) { e === 'change' ? (h.pull.on('change', o), h.push.on('change', i)) : e === 'denied' ? (h.pull.on('denied', s), h.push.on('denied', a)) : e === 'active' ? (h.pull.on('active', l), h.push.on('active', f)) : e === 'paused' && (h.pull.on('paused', c), h.push.on('paused', u)) }), this.on('removeListener', function (e) { e === 'change' ? (h.pull.removeListener('change', o), h.push.removeListener('change', i)) : e === 'denied' ? (h.pull.removeListener('denied', s), h.push.removeListener('denied', a)) : e === 'active' ? (h.pull.removeListener('active', l), h.push.removeListener('active', f)) : e === 'paused' && (h.pull.removeListener('paused', c), h.push.removeListener('paused', u)) }), this.pull.on('removeListener', d('pull')), this.push.on('removeListener', d('push')); var _ = qr.all([this.push, this.pull]).then(function (e) { var t = { push: e[0], pull: e[1] }; return h.emit('complete', t), r && r(null, t), h.removeAllListeners(), t }, function (e) { if (h.cancel(), r ? r(e) : h.emit('error', e), h.removeAllListeners(), r) throw e }); this.then = function (e, t) { return _.then(e, t) }, this['catch'] = function (e) { return _['catch'](e) } } function dr (e) { e.replicate = cr, e.sync = fr } var hr; var pr = e('js-extend'); var vr = o(e('debug')); var yr = o(e('inherits')); var _r = o(e('lie')); var mr = e('pouchdb-collections'); var gr = o(e('argsarray')); var br = e('events'); var wr = o(e('scope-eval')); var Er = o(e('spark-md5')); var Sr = o(e('vuvuzela')); var kr = e('pouchdb-collate'); var qr = typeof Promise === 'function' ? Promise : _r; var xr = Function.prototype.toString; var Ar = xr.call(Object); var Tr = vr('pouchdb:api'); var Or = 6; if (_())hr = !1; else try { localStorage.setItem('_pouch_check_localstorage', 1), hr = !!localStorage.getItem('_pouch_check_localstorage') } catch (jr) { hr = !1 }yr(b, br.EventEmitter), b.prototype.addListener = function (e, t, n, r) { function o () { function e () { a = !1 } if (i._listeners[t]) { if (a) return void (a = 'waiting'); a = !0; var s = h(r, ['style', 'include_docs', 'attachments', 'conflicts', 'filter', 'doc_ids', 'view', 'since', 'query_params', 'binary']); n.changes(s).on('change', function (e) { e.seq > r.since && !r.cancelled && (r.since = e.seq, r.onChange(e)) }).on('complete', function () { a === 'waiting' && setTimeout(function () { o() }, 0), a = !1 }).on('error', e) } } if (!this._listeners[t]) { var i = this; var a = !1; this._listeners[t] = o, this.on(e, o) } }, b.prototype.removeListener = function (e, t) { t in this._listeners && br.EventEmitter.prototype.removeListener.call(this, e, this._listeners[t]) }, b.prototype.notifyLocalWindows = function (e) { _() ? chrome.storage.local.set({ dbName: e }) : m() && (localStorage[e] = localStorage[e] === 'a' ? 'b' : 'a') }, b.prototype.notify = function (e) { this.emit(e), this.notifyLocalWindows(e) }, yr(q, Error), q.prototype.toString = function () { return JSON.stringify({ status: this.status, name: this.name, message: this.message, reason: this.reason }) }; var Ir = new q({ status: 401, error: 'unauthorized', reason: 'Name or password is incorrect.' }); var Cr = new q({ status: 400, error: 'bad_request', reason: "Missing JSON list of 'docs'" }); var Lr = new q({ status: 404, error: 'not_found', reason: 'missing' }); var Dr = new q({ status: 409, error: 'conflict', reason: 'Document update conflict' }); var Rr = new q({ status: 400, error: 'invalid_id', reason: '_id field must contain a string' }); var Nr = new q({ status: 412, error: 'missing_id', reason: '_id is required for puts' }); var Br = new q({ status: 400, error: 'bad_request', reason: 'Only reserved document ids may start with underscore.' }); var Mr = new q({ status: 412, error: 'precondition_failed', reason: 'Database not open' }); var Fr = new q({ status: 500, error: 'unknown_error', reason: 'Database encountered an unknown error' }); var Ur = new q({ status: 500, error: 'badarg', reason: 'Some query argument is invalid' }); var Pr = new q({ status: 400, error: 'invalid_request', reason: 'Request was invalid' }); var Hr = new q({ status: 400, error: 'query_parse_error', reason: 'Some query parameter is invalid' }); var Jr = new q({ status: 500, error: 'doc_validation', reason: 'Bad special document member' }); var Kr = new q({ status: 400, error: 'bad_request', reason: 'Something wrong with the request' }); var Wr = new q({ status: 400, error: 'bad_request', reason: 'Document must be a JSON object' }); var Gr = new q({ status: 404, error: 'not_found', reason: 'Database not found' }); var Vr = new q({ status: 500, error: 'indexed_db_went_bad', reason: 'unknown' }); var zr = new q({ status: 500, error: 'web_sql_went_bad', reason: 'unknown' }); var Xr = new q({ status: 500, error: 'levelDB_went_went_bad', reason: 'unknown' }); var Qr = new q({ status: 403, error: 'forbidden', reason: 'Forbidden by design doc validate_doc_update function' }); var $r = new q({ status: 400, error: 'bad_request', reason: 'Invalid rev format' }); var Yr = new q({ status: 412, error: 'file_exists', reason: 'The database could not be created, the file already exists.' }); var Zr = new q({ status: 412, error: 'missing_stub' }); var eo = new q({ status: 413, error: 'invalid_url', reason: 'Provided URL is invalid' }); var to = [Ir, Cr, Lr, Dr, Rr, Nr, Br, Mr, Fr, Ur, Pr, Hr, Jr, Kr, Wr, Gr, zr, Xr, Qr, $r, Yr, Zr, Vr, eo]; var no = function (e, t, n) { var r = to.filter(function (n) { return n[e] === t }); return n && r.filter(function (e) { return e.message === n })[0] || r[0] }; var ro = ['source', 'protocol', 'authority', 'userInfo', 'user', 'password', 'host', 'port', 'relative', 'path', 'directory', 'file', 'query', 'anchor']; var oo = 'queryKey'; var io = /(?:^|&)([^&=]*)=?([^&]*)/g; var ao = /^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/; var so = '0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz'.split(''); yr(ce, br.EventEmitter), ce.prototype.cancel = function () { this.isCancelled = !0, this.db.taskqueue.isReady && this.emit('cancel') }, ce.prototype.doChanges = function (e) { var t = this; var n = e.complete; if (e = c(e), 'live' in e && !('continuous' in e) && (e.continuous = e.live), e.processChange = fe, e.since === 'latest' && (e.since = 'now'), e.since || (e.since = 0), e.since === 'now') return void this.db.info().then(function (r) { return t.isCancelled ? void n(null, { status: 'cancelled' }) : (e.since = r.update_seq, void t.doChanges(e)) }, n); if (e.continuous && e.since !== 'now' && this.db.info().then(function (e) { t.startSeq = e.update_seq }, function (e) { if (e.id !== 'idbNull') throw e }), e.view && !e.filter && (e.filter = '_view'), e.filter && typeof e.filter === 'string' && (e.filter === '_view' ? e.view = D(e.view) : e.filter = D(e.filter), this.db.type() !== 'http' && !e.doc_ids)) return this.filterChanges(e); 'descending' in e || (e.descending = !1), e.limit = e.limit === 0 ? 1 : e.limit, e.complete = n; var r = this.db._changes(e); if (r && typeof r.cancel === 'function') { var o = t.cancel; t.cancel = gr(function (e) { r.cancel(), o.apply(this, e) }) } }, ce.prototype.filterChanges = function (e) { var t = this; var n = e.complete; if (e.filter === '_view') { if (!e.view || typeof e.view !== 'string') { var r = x(Kr, '`view` filter parameter not found or invalid.'); return n(r) } var o = L(e.view); this.db.get('_design/' + o[0], function (r, i) { if (t.isCancelled) return n(null, { status: 'cancelled' }); if (r) return n(A(r)); var a = i && i.views && i.views[o[1]] && i.views[o[1]].map; return a ? (e.filter = se(a), void t.doChanges(e)) : n(x(Lr, i.views ? 'missing json key: ' + o[1] : 'missing json key: views')) }) } else { var i = L(e.filter); if (!i) return t.doChanges(e); this.db.get('_design/' + i[0], function (r, o) { if (t.isCancelled) return n(null, { status: 'cancelled' }); if (r) return n(A(r)); var a = o && o.filters && o.filters[i[1]]; return a ? (e.filter = ae(a), void t.doChanges(e)) : n(x(Lr, o && o.filters ? 'missing json key: ' + i[1] : 'missing json key: filters')) }) } }, yr(be, br.EventEmitter), be.prototype.post = d('post', function (e, t, n) {
        return typeof t === 'function' && (n = t, t = {}), typeof e !== 'object' || Array.isArray(e) ? n(x(Wr)) : void this.bulkDocs({
          docs: [e] }, t, he(n))
      }), be.prototype.put = d('put', gr(function (e) { function t () { a || (w('warn', 'db.put(doc, id, rev) has been deprecated and will be removed in a future release, please use db.put({_id: id, _rev: rev}) instead'), a = !0) } var n; var r; var o; var i; var a = !1; var s = e.shift(); var u = '_id' in s; if (typeof s !== 'object' || Array.isArray(s)) return (i = e.pop())(x(Wr)); for (;;) if (n = e.shift(), r = typeof n, r !== 'string' || u ? r !== 'string' || !u || '_rev' in s ? r === 'object' ? o = n : r === 'function' && (i = n) : (t(), s._rev = n) : (t(), s._id = n, u = !0), !e.length) break; return o = o || {}, I(s._id), ie(s._id) && typeof this._putLocal === 'function' ? s._deleted ? this._removeLocal(s, i) : this._putLocal(s, i) : void this.bulkDocs({ docs: [s] }, o, he(i)) })), be.prototype.putAttachment = d('putAttachment', function (e, t, n, r, o) { function i (e) { var n = '_rev' in e ? parseInt(e._rev, 10) : 0; return e._attachments = e._attachments || {}, e._attachments[t] = { content_type: o, data: r, revpos: ++n }, a.put(e) } var a = this; return typeof o === 'function' && (o = r, r = n, n = null), typeof o === 'undefined' && (o = r, r = n, n = null), a.get(e).then(function (e) { if (e._rev !== n) throw x(Dr); return i(e) }, function (t) { if (t.reason === Lr.message) return i({ _id: e }); throw t }) }), be.prototype.removeAttachment = d('removeAttachment', function (e, t, n, r) { var o = this; o.get(e, function (e, i) { return e ? void r(e) : i._rev !== n ? void r(x(Dr)) : i._attachments ? (delete i._attachments[t], Object.keys(i._attachments).length === 0 && delete i._attachments, void o.put(i, r)) : r() }) }), be.prototype.remove = d('remove', function (e, t, n, r) { var o; typeof t === 'string' ? (o = { _id: e, _rev: t }, typeof n === 'function' && (r = n, n = {})) : (o = e, typeof t === 'function' ? (r = t, n = {}) : (r = n, n = t)), n = n || {}, n.was_delete = !0; var i = { _id: o._id, _rev: o._rev || n.rev }; return i._deleted = !0, ie(i._id) && typeof this._removeLocal === 'function' ? this._removeLocal(o, r) : void this.bulkDocs({ docs: [i] }, n, he(r)) }), be.prototype.revsDiff = d('revsDiff', function (e, t, n) { function r (e, t) { s.has(e) || s.set(e, { missing: [] }), s.get(e).missing.push(t) } function o (t, n) { var o = e[t].slice(0); P(n, function (e, n, i, a, s) { var u = n + '-' + i; var c = o.indexOf(u); c !== -1 && (o.splice(c, 1), s.status !== 'available' && r(t, u)) }), o.forEach(function (e) { r(t, e) }) } typeof t === 'function' && (n = t, t = {}); var i = Object.keys(e); if (!i.length) return n(null, {}); var a = 0; var s = new mr.Map(); i.map(function (t) { this._getRevisionTree(t, function (r, u) { if (r && r.status === 404 && r.message === 'missing')s.set(t, { missing: e[t] }); else { if (r) return n(r); o(t, u) } if (++a === i.length) { var c = {}; return s.forEach(function (e, t) { c[t] = e }), n(null, c) } }) }, this) }), be.prototype.bulkGet = d('bulkGet', function (e, t) { y(this, e, t) }), be.prototype.compactDocument = d('compactDocument', function (e, t, n) { var r = this; this._getRevisionTree(e, function (o, i) { if (o) return n(o); var a = ye(i); var s = []; var u = []; Object.keys(a).forEach(function (e) { a[e] > t && s.push(e) }), P(i, function (e, t, n, r, o) { var i = t + '-' + n; o.status === 'available' && s.indexOf(i) !== -1 && u.push(i) }), r._doCompaction(e, u, n) }) }), be.prototype.compact = d('compact', function (e, t) { typeof e === 'function' && (t = e, e = {}); var n = this; e = e || {}, n._compactionQueue = n._compactionQueue || [], n._compactionQueue.push({ opts: e, callback: t }), n._compactionQueue.length === 1 && me(n) }), be.prototype._compact = function (e, t) { function n (e) { a.push(o.compactDocument(e.id, 0)) } function r (e) { var n = e.last_seq; qr.all(a).then(function () { return N(o, '_local/compaction', function (e) { return !e.last_seq || e.last_seq < n ? (e.last_seq = n, e) : !1 }) }).then(function () { t(null, { ok: !0 }) })['catch'](t) } var o = this; var i = { return_docs: !1, last_seq: e.last_seq || 0 }; var a = []; o.changes(i).on('change', n).on('complete', r).on('error', t) }, be.prototype.get = d('get', function (e, t, n) { function r () { var r = []; var a = o.length; return a ? void o.forEach(function (o) { i.get(e, { rev: o, revs: t.revs, attachments: t.attachments }, function (e, t) { e ? r.push({ missing: o }) : r.push({ ok: t }), a--, a || n(null, r) }) }) : n(null, r) } if (typeof t === 'function' && (n = t, t = {}), typeof e !== 'string') return n(x(Rr)); if (ie(e) && typeof this._getLocal === 'function') return this._getLocal(e, n); var o = []; var i = this; if (!t.open_revs) return this._get(e, t, function (e, r) { if (e) return n(e); var o = r.doc; var a = r.metadata; var s = r.ctx; if (t.conflicts) { var u = K(a); u.length && (o._conflicts = u) } if (oe(a, o._rev) && (o._deleted = !0), t.revs || t.revs_info) { var c = G(a.rev_tree); var f = de(c, function (e) { return e.ids.map(function (e) { return e.id }).indexOf(o._rev.split('-')[1]) !== -1 }); var l = f.ids.map(function (e) { return e.id }).indexOf(o._rev.split('-')[1]) + 1; var d = f.ids.length - l; if (f.ids.splice(l, d), f.ids.reverse(), t.revs && (o._revisions = { start: f.pos + f.ids.length - 1, ids: f.ids.map(function (e) { return e.id }) }), t.revs_info) { var h = f.pos + f.ids.length; o._revs_info = f.ids.map(function (e) { return h--, { rev: h + '-' + e.id, status: e.opts.status } }) } } if (t.attachments && o._attachments) { var p = o._attachments; var v = Object.keys(p).length; if (v === 0) return n(null, o); Object.keys(p).forEach(function (e) { this._getAttachment(o._id, e, p[e], { rev: o._rev, binary: t.binary, ctx: s }, function (t, r) { var i = o._attachments[e]; i.data = r, delete i.stub, delete i.length, --v || n(null, o) }) }, i) } else { if (o._attachments) for (var y in o._attachments)o._attachments.hasOwnProperty(y) && (o._attachments[y].stub = !0); n(null, o) } }); if (t.open_revs === 'all') this._getRevisionTree(e, function (e, t) { return e ? n(e) : (o = J(t).map(function (e) { return e.rev }), void r()) }); else { if (!Array.isArray(t.open_revs)) return n(x(Fr, 'function_clause')); o = t.open_revs; for (var a = 0; a < o.length; a++) { var s = o[a]; if (typeof s !== 'string' || !/^\d+-/.test(s)) return n(x($r)) }r() } }), be.prototype.getAttachment = d('getAttachment', function (e, t, n, r) { var o = this; n instanceof Function && (r = n, n = {}), this._get(e, n, function (i, a) { return i ? r(i) : a.doc._attachments && a.doc._attachments[t] ? (n.ctx = a.ctx, n.binary = !0, o._getAttachment(e, t, a.doc._attachments[t], n, r), void 0) : r(x(Lr)) }) }), be.prototype.allDocs = d('allDocs', function (e, t) { if (typeof e === 'function' && (t = e, e = {}), e.skip = typeof e.skip !== 'undefined' ? e.skip : 0, e.start_key && (e.startkey = e.start_key), e.end_key && (e.endkey = e.end_key), 'keys' in e) { if (!Array.isArray(e.keys)) return t(new TypeError('options.keys must be an array')); var n = ['startkey', 'endkey', 'key'].filter(function (t) { return t in e })[0]; if (n) return void t(x(Hr, 'Query parameter `' + n + '` is not compatible with multi-get')); if (this.type() !== 'http') return _e(this, e, t) } return this._allDocs(e, t) }), be.prototype.changes = function (e, t) { return typeof e === 'function' && (t = e, e = {}), new ce(this, e, t) }, be.prototype.close = d('close', function (e) { return this._closed = !0, this._close(e) }), be.prototype.info = d('info', function (e) { var t = this; this._info(function (n, r) { return n ? e(n) : (r.db_name = r.db_name || t._db_name, r.auto_compaction = !(!t.auto_compaction || t.type() === 'http'), r.adapter = t.type(), void e(null, r)) }) }), be.prototype.id = d('id', function (e) { return this._id(e) }), be.prototype.type = function () { return typeof this._type === 'function' ? this._type() : this.adapter }, be.prototype.bulkDocs = d('bulkDocs', function (e, t, n) { if (typeof t === 'function' && (n = t, t = {}), t = t || {}, Array.isArray(e) && (e = { docs: e }), !e || !e.docs || !Array.isArray(e.docs)) return n(x(Cr)); for (var r = 0; r < e.docs.length; ++r) if (typeof e.docs[r] !== 'object' || Array.isArray(e.docs[r])) return n(x(Wr)); var o; return e.docs.forEach(function (e) { e._attachments && Object.keys(e._attachments).forEach(function (e) { o = o || ge(e) }) }), o ? n(x(Kr, o)) : ('new_edits' in t || ('new_edits' in e ? t.new_edits = e.new_edits : t.new_edits = !0), t.new_edits || this.type() === 'http' || e.docs.sort(ve), pe(e.docs), this._bulkDocs(e, t, function (e, r) { return e ? n(e) : (t.new_edits || (r = r.filter(function (e) { return e.error })), void n(null, r)) })) }), be.prototype.registerDependentDatabase = d('registerDependentDatabase', function (e, t) { function n (t) { return t.dependentDbs = t.dependentDbs || {}, t.dependentDbs[e] ? !1 : (t.dependentDbs[e] = !0, t) } var r = new this.constructor(e, this.__opts); N(this, '_local/_pouch_dependentDbs', n).then(function () { t(null, { db: r }) })['catch'](t) }), be.prototype.destroy = d('destroy', function (e, t) { function n () { r._destroy(e, function (e, n) { return e ? t(e) : (r._destroyed = !0, r.emit('destroyed'), void t(null, n || { ok: !0 })) }) } typeof e === 'function' && (t = e, e = {}); var r = this; var o = 'use_prefix' in r ? r.use_prefix : !0; return r.type() === 'http' ? n() : void r.get('_local/_pouch_dependentDbs', function (e, i) { if (e) return e.status !== 404 ? t(e) : n(); var a = i.dependentDbs; var s = r.constructor; var u = Object.keys(a).map(function (e) { var t = o ? e.replace(new RegExp('^' + s.prefix), '') : e; return new s(t, r.__opts).destroy() }); qr.all(u).then(n, t) }) }), we.prototype.execute = function () { var e; if (this.failed) for (;e = this.queue.shift();)e(this.failed); else for (;e = this.queue.shift();)e() }, we.prototype.fail = function (e) { this.failed = e, this.execute() }, we.prototype.ready = function (e) { this.isReady = !0, this.db = e, this.execute() }, we.prototype.addTask = function (e) { this.queue.push(e), this.failed && this.execute() }, yr(ke, be), ke.debug = vr, ke.adapters = {}, ke.preferredAdapters = [], ke.prefix = '_pouch_'; var uo = new br.EventEmitter(); qe(ke), ke.parseAdapter = function (e, t) { var n; var r; var o = e.match(/([a-z\-]*):\/\/(.*)/); if (o) { if (e = /http(s?)/.test(o[1]) ? o[1] + '://' + o[2] : o[2], n = o[1], !ke.adapters[n].valid()) throw 'Invalid adapter'; return { name: e, adapter: o[1] } } var i = 'idb' in ke.adapters && 'websql' in ke.adapters && m() && localStorage['_pouch__websqldb_' + ke.prefix + e]; if (t.adapter)r = t.adapter; else if (typeof t !== 'undefined' && t.db)r = 'leveldb'; else for (var a = 0; a < ke.preferredAdapters.length; ++a) if (r = ke.preferredAdapters[a], r in ke.adapters) { if (i && r === 'idb') { w('log', 'PouchDB is downgrading "' + e + '" to WebSQL to avoid data loss, because it was already opened with WebSQL.'); continue } break }n = ke.adapters[r]; var s = n && 'use_prefix' in n ? n.use_prefix : !0; return { name: s ? ke.prefix + e : e, adapter: r } }, ke.adapter = function (e, t, n) { t.valid() && (ke.adapters[e] = t, n && ke.preferredAdapters.push(e)) }, ke.plugin = function (e) { return typeof e === 'function' ? e(ke) : Object.keys(e).forEach(function (t) { ke.prototype[t] = e[t] }), ke }, ke.defaults = function (e) { function t (n, r, o) { return this instanceof t ? (typeof r !== 'function' && typeof r !== 'undefined' || (o = r, r = {}), n && typeof n === 'object' && (r = n, n = void 0), r = pr.extend({}, e, r), void ke.call(this, n, r, o)) : new t(n, r, o) } return yr(t, ke), t.preferredAdapters = ke.preferredAdapters.slice(), Object.keys(ke).forEach(function (e) { e in t || (t[e] = ke[e]) }), t }; var co = '5.4.4'; ke.version = co; var fo; var lo = xe(['_id', '_rev', '_attachments', '_deleted', '_revisions', '_revs_info', '_conflicts', '_deleted_conflicts', '_local_seq', '_rev_tree', '_replication_id', '_replication_state', '_replication_state_time', '_replication_state_reason', '_replication_stats', '_removed']); var ho = xe(['_attachments', '_replication_id', '_replication_state', '_replication_state_time', '_replication_state_reason', '_replication_stats']); var po = function (e) { return atob(e) }; var vo = function (e) { return btoa(e) }; var yo = r.setImmediate || r.setTimeout; var _o = 32768; var mo = 5; var go = 'document-store'; var bo = 'by-sequence'; var wo = 'attach-store'; var Eo = 'attach-seq-store'; var So = 'meta-store'; var ko = 'local-store'; var qo = 'detect-blob-support'; var xo = { running: !1, queue: [] }; var Ao = new mr.Map(); var To = new b(); var Oo = new mr.Map(); ht.valid = function () { var e = typeof openDatabase !== 'undefined' && /(Safari|iPhone|iPad|iPod)/.test(navigator.userAgent) && !/Chrome/.test(navigator.userAgent) && !/BlackBerry/.test(navigator.platform); return !e && typeof indexedDB !== 'undefined' && typeof IDBKeyRange !== 'undefined' }; var jo = 7; var Io = Et('document-store'); var Co = Et('by-sequence'); var Lo = Et('attach-store'); var Do = Et('local-store'); var Ro = Et('metadata-store'); var No = Et('attach-seq-store'); var Bo = new mr.Map(); var Mo = new b(); var Fo = 1; var Uo = "CREATE INDEX IF NOT EXISTS 'by-seq-deleted-idx' ON " + Co + ' (seq, deleted)'; var Po = "CREATE UNIQUE INDEX IF NOT EXISTS 'by-seq-doc-id-rev' ON " + Co + ' (doc_id, rev)'; var Ho = "CREATE INDEX IF NOT EXISTS 'doc-winningseq-idx' ON " + Io + ' (winningseq)'; var Jo = "CREATE INDEX IF NOT EXISTS 'attach-seq-seq-idx' ON " + No + ' (seq)'; var Ko = "CREATE UNIQUE INDEX IF NOT EXISTS 'attach-seq-digest-idx' ON " + No + ' (digest, seq)'; var Wo = Co + '.seq = ' + Io + '.winningseq'; var Go = Co + '.seq AS seq, ' + Co + '.deleted AS deleted, ' + Co + '.json AS data, ' + Co + '.rev AS rev, ' + Io + '.json AS metadata'; Ht.valid = Ut, Ht.use_prefix = !0; var Vo = Vt(); var zo = function () {}; var Xo = 25; var Qo = 50; var $o = {}; var Yo = 1800; var Zo = vr('pouchdb:http'); an.valid = function () { return !0 }, un.prototype.add = function (e) { return this.promise = this.promise['catch'](function () {}).then(function () { return e() }), this.promise }, un.prototype.finish = function () { return this.promise }; var ei = function (e, t) { return t && e.then(function (e) { n.nextTick(function () { t(null, e) }) }, function (e) { n.nextTick(function () { t(e) }) }), e }; var ti = function (e) { return gr(function (t) { var n = t.pop(); var r = e.apply(this, t); return typeof n === 'function' && ei(r, n), r }) }; var ni = function (e, t) { return e.then(function (e) { return t().then(function () { return e }) }, function (e) { return t().then(function () { throw e }) }) }; var ri = function (e, t) { return function () { var n = arguments; var r = this; return e.add(function () { return t.apply(r, n) }) } }; var oi = function (e) { for (var t = {}, n = 0, r = e.length; r > n; n++)t['$' + e[n]] = !0; var o = Object.keys(t); var i = new Array(o.length); for (n = 0, r = o.length; r > n; n++)i[n] = o[n].substring(1); return i }; var ii = {}; var ai = new un(); var si = 50; var ui = w.bind(null, 'log'); var ci = { _sum: function (e, t) { return wn(t) }, _count: function (e, t) { return t.length }, _stats: function (e, t) { function n (e) { for (var t = 0, n = 0, r = e.length; r > n; n++) { var o = e[n]; t += o * o } return t } return { sum: wn(t), min: Math.min.apply(null, t), max: Math.max.apply(null, t), count: t.length, sumsqr: n(t) } } }; var fi = ti(function () { var e = this; return e.type() === 'http' ? Fn(e) : typeof e._viewCleanup === 'function' ? On(e) : Un(e) }); var li = function (e, t, n) { typeof t === 'function' && (n = t, t = {}), t = t ? kn(t) : {}, typeof e === 'function' && (e = { map: e }); var r = this; var o = qr.resolve().then(function () { return Pn(r, e, t) }); return ei(o, n), o }; yr(Hn, Error), yr(Jn, Error), yr(Kn, Error); var di = { query: li, viewCleanup: fi }; var hi = 1; var pi = 'pouchdb'; var vi = 5; var yi = 0; Yn.prototype.writeCheckpoint = function (e, t) { var n = this; return this.updateTarget(e, t).then(function () { return n.updateSource(e, t) }) }, Yn.prototype.updateTarget = function (e, t) { return $n(this.target, this.id, e, t, this.returnValue) }, Yn.prototype.updateSource = function (e, t) { var n = this; return this.readOnlySource ? qr.resolve(!0) : $n(this.src, this.id, e, t, this.returnValue)['catch'](function (e) { if (nr(e)) return n.readOnlySource = !0, !0; throw e }) }; var _i = { undefined: function (e, t) { return kr.collate(e.last_seq, t.last_seq) === 0 ? t.last_seq : 0 }, 1: function (e, t) { return Zn(t, e).last_seq } }; Yn.prototype.getCheckpoint = function () { var e = this; return e.target.get(e.id).then(function (t) { return e.readOnlySource ? qr.resolve(t.last_seq) : e.src.get(e.id).then(function (e) { if (t.version !== e.version) return yi; var n; return n = t.version ? t.version.toString() : 'undefined', n in _i ? _i[n](t, e) : yi }, function (n) { if (n.status === 404 && t.last_seq) return e.src.put({ _id: e.id, last_seq: yi }).then(function () { return yi }, function (n) { return nr(n) ? (e.readOnlySource = !0, t.last_seq) : yi }); throw n }) })['catch'](function (e) { if (e.status !== 404) throw e; return yi }) }; var mi = 0; yr(sr, br.EventEmitter), sr.prototype.cancel = function () { this.cancelled = !0, this.state = 'cancelled', this.emit('cancel') }, sr.prototype.ready = function (e, t) { function n () { o.cancel() } function r () { e.removeListener('destroyed', n), t.removeListener('destroyed', n) } var o = this; o._readyCalled || (o._readyCalled = !0, e.once('destroyed', n), t.once('destroyed', n), o.once('complete', r)) }, yr(lr, br.EventEmitter), lr.prototype.cancel = function () { this.canceled || (this.canceled = !0, this.push.cancel(), this.pull.cancel()) }, ke.plugin(yt).plugin(Jt).plugin(sn).plugin(di).plugin(dr), t.exports = ke
    }).call(this, e('_process'), typeof global !== 'undefined' ? global : typeof self !== 'undefined' ? self : typeof window !== 'undefined' ? window : {})
  }, { _process: 18, argsarray: 2, debug: 3, events: 5, inherits: 7, 'js-extend': 8, lie: 9, 'pouchdb-collate': 11, 'pouchdb-collections': 13, 'scope-eval': 19, 'spark-md5': 20, vuvuzela: 21 }],
  18: [function (e, t, n) { function r () { d && s && (d = !1, s.length ? l = s.concat(l) : h = -1, l.length && o()) } function o () { if (!d) { var e = c(r); d = !0; for (var t = l.length; t;) { for (s = l, l = []; ++h < t;)s && s[h].run(); h = -1, t = l.length }s = null, d = !1, f(e) } } function i (e, t) { this.fun = e, this.array = t } function a () {} var s; var u = t.exports = {}; var c = setTimeout; var f = clearTimeout; var l = []; var d = !1; var h = -1; u.nextTick = function (e) { var t = new Array(arguments.length - 1); if (arguments.length > 1) for (var n = 1; n < arguments.length; n++)t[n - 1] = arguments[n]; l.push(new i(e, t)), l.length !== 1 || d || c(o, 0) }, i.prototype.run = function () { this.fun.apply(null, this.array) }, u.title = 'browser', u.browser = !0, u.env = {}, u.argv = [], u.version = '', u.versions = {}, u.on = a, u.addListener = a, u.once = a, u.off = a, u.removeListener = a, u.removeAllListeners = a, u.emit = a, u.binding = function (e) { throw new Error('process.binding is not supported') }, u.cwd = function () { return '/' }, u.chdir = function (e) { throw new Error('process.chdir is not supported') }, u.umask = function () { return 0 } }, {}],
  19: [function (e, t, n) { (function () { var e = {}.hasOwnProperty; var n = [].slice; t.exports = function (t, r) { var o, i, a, s; i = [], s = []; for (o in r)e.call(r, o) && (a = r[o], o !== 'this' && (i.push(o), s.push(a))); return Function.apply(null, n.call(i).concat([t])).apply(r['this'], s) } }).call(this) }, {}],
  20: [function (e, t, n) { !(function (e) { if (typeof n === 'object')t.exports = e(); else if (typeof define === 'function' && define.amd)define(e); else { var r; try { r = window } catch (o) { r = self }r.SparkMD5 = e() } }(function (e) { 'use strict'; function t (e, t, n, r, o, i) { return t = g(g(t, e), g(r, i)), g(t << o | t >>> 32 - o, n) } function n (e, n, r, o, i, a, s) { return t(n & r | ~n & o, e, n, i, a, s) } function r (e, n, r, o, i, a, s) { return t(n & o | r & ~o, e, n, i, a, s) } function o (e, n, r, o, i, a, s) { return t(n ^ r ^ o, e, n, i, a, s) } function i (e, n, r, o, i, a, s) { return t(r ^ (n | ~o), e, n, i, a, s) } function a (e, t) { var a = e[0]; var s = e[1]; var u = e[2]; var c = e[3]; a = n(a, s, u, c, t[0], 7, -680876936), c = n(c, a, s, u, t[1], 12, -389564586), u = n(u, c, a, s, t[2], 17, 606105819), s = n(s, u, c, a, t[3], 22, -1044525330), a = n(a, s, u, c, t[4], 7, -176418897), c = n(c, a, s, u, t[5], 12, 1200080426), u = n(u, c, a, s, t[6], 17, -1473231341), s = n(s, u, c, a, t[7], 22, -45705983), a = n(a, s, u, c, t[8], 7, 1770035416), c = n(c, a, s, u, t[9], 12, -1958414417), u = n(u, c, a, s, t[10], 17, -42063), s = n(s, u, c, a, t[11], 22, -1990404162), a = n(a, s, u, c, t[12], 7, 1804603682), c = n(c, a, s, u, t[13], 12, -40341101), u = n(u, c, a, s, t[14], 17, -1502002290), s = n(s, u, c, a, t[15], 22, 1236535329), a = r(a, s, u, c, t[1], 5, -165796510), c = r(c, a, s, u, t[6], 9, -1069501632), u = r(u, c, a, s, t[11], 14, 643717713), s = r(s, u, c, a, t[0], 20, -373897302), a = r(a, s, u, c, t[5], 5, -701558691), c = r(c, a, s, u, t[10], 9, 38016083), u = r(u, c, a, s, t[15], 14, -660478335), s = r(s, u, c, a, t[4], 20, -405537848), a = r(a, s, u, c, t[9], 5, 568446438), c = r(c, a, s, u, t[14], 9, -1019803690), u = r(u, c, a, s, t[3], 14, -187363961), s = r(s, u, c, a, t[8], 20, 1163531501), a = r(a, s, u, c, t[13], 5, -1444681467), c = r(c, a, s, u, t[2], 9, -51403784), u = r(u, c, a, s, t[7], 14, 1735328473), s = r(s, u, c, a, t[12], 20, -1926607734), a = o(a, s, u, c, t[5], 4, -378558), c = o(c, a, s, u, t[8], 11, -2022574463), u = o(u, c, a, s, t[11], 16, 1839030562), s = o(s, u, c, a, t[14], 23, -35309556), a = o(a, s, u, c, t[1], 4, -1530992060), c = o(c, a, s, u, t[4], 11, 1272893353), u = o(u, c, a, s, t[7], 16, -155497632), s = o(s, u, c, a, t[10], 23, -1094730640), a = o(a, s, u, c, t[13], 4, 681279174), c = o(c, a, s, u, t[0], 11, -358537222), u = o(u, c, a, s, t[3], 16, -722521979), s = o(s, u, c, a, t[6], 23, 76029189), a = o(a, s, u, c, t[9], 4, -640364487), c = o(c, a, s, u, t[12], 11, -421815835), u = o(u, c, a, s, t[15], 16, 530742520), s = o(s, u, c, a, t[2], 23, -995338651), a = i(a, s, u, c, t[0], 6, -198630844), c = i(c, a, s, u, t[7], 10, 1126891415), u = i(u, c, a, s, t[14], 15, -1416354905), s = i(s, u, c, a, t[5], 21, -57434055), a = i(a, s, u, c, t[12], 6, 1700485571), c = i(c, a, s, u, t[3], 10, -1894986606), u = i(u, c, a, s, t[10], 15, -1051523), s = i(s, u, c, a, t[1], 21, -2054922799), a = i(a, s, u, c, t[8], 6, 1873313359), c = i(c, a, s, u, t[15], 10, -30611744), u = i(u, c, a, s, t[6], 15, -1560198380), s = i(s, u, c, a, t[13], 21, 1309151649), a = i(a, s, u, c, t[4], 6, -145523070), c = i(c, a, s, u, t[11], 10, -1120210379), u = i(u, c, a, s, t[2], 15, 718787259), s = i(s, u, c, a, t[9], 21, -343485551), e[0] = g(a, e[0]), e[1] = g(s, e[1]), e[2] = g(u, e[2]), e[3] = g(c, e[3]) } function s (e) { var t; var n = []; for (t = 0; t < 64; t += 4)n[t >> 2] = e.charCodeAt(t) + (e.charCodeAt(t + 1) << 8) + (e.charCodeAt(t + 2) << 16) + (e.charCodeAt(t + 3) << 24); return n } function u (e) { var t; var n = []; for (t = 0; t < 64; t += 4)n[t >> 2] = e[t] + (e[t + 1] << 8) + (e[t + 2] << 16) + (e[t + 3] << 24); return n } function c (e) { var t; var n; var r; var o; var i; var u; var c = e.length; var f = [1732584193, -271733879, -1732584194, 271733878]; for (t = 64; c >= t; t += 64)a(f, s(e.substring(t - 64, t))); for (e = e.substring(t - 64), n = e.length, r = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0], t = 0; n > t; t += 1)r[t >> 2] |= e.charCodeAt(t) << (t % 4 << 3); if (r[t >> 2] |= 128 << (t % 4 << 3), t > 55) for (a(f, r), t = 0; t < 16; t += 1)r[t] = 0; return o = 8 * c, o = o.toString(16).match(/(.*?)(.{0,8})$/), i = parseInt(o[2], 16), u = parseInt(o[1], 16) || 0, r[14] = i, r[15] = u, a(f, r), f } function f (e) { var t; var n; var r; var o; var i; var s; var c = e.length; var f = [1732584193, -271733879, -1732584194, 271733878]; for (t = 64; c >= t; t += 64)a(f, u(e.subarray(t - 64, t))); for (e = c > t - 64 ? e.subarray(t - 64) : new Uint8Array(0), n = e.length, r = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0], t = 0; n > t; t += 1)r[t >> 2] |= e[t] << (t % 4 << 3); if (r[t >> 2] |= 128 << (t % 4 << 3), t > 55) for (a(f, r), t = 0; t < 16; t += 1)r[t] = 0; return o = 8 * c, o = o.toString(16).match(/(.*?)(.{0,8})$/), i = parseInt(o[2], 16), s = parseInt(o[1], 16) || 0, r[14] = i, r[15] = s, a(f, r), f } function l (e) { var t; var n = ''; for (t = 0; t < 4; t += 1)n += b[e >> 8 * t + 4 & 15] + b[e >> 8 * t & 15]; return n } function d (e) { var t; for (t = 0; t < e.length; t += 1)e[t] = l(e[t]); return e.join('') } function h (e) { return /[\u0080-\uFFFF]/.test(e) && (e = unescape(encodeURIComponent(e))), e } function p (e, t) { var n; var r = e.length; var o = new ArrayBuffer(r); var i = new Uint8Array(o); for (n = 0; r > n; n += 1)i[n] = e.charCodeAt(n); return t ? i : o } function v (e) { return String.fromCharCode.apply(null, new Uint8Array(e)) } function y (e, t, n) { var r = new Uint8Array(e.byteLength + t.byteLength); return r.set(new Uint8Array(e)), r.set(new Uint8Array(t), e.byteLength), n ? r : r.buffer } function _ (e) { var t; var n = []; var r = e.length; for (t = 0; r - 1 > t; t += 2)n.push(parseInt(e.substr(t, 2), 16)); return String.fromCharCode.apply(String, n) } function m () { this.reset() } var g = function (e, t) { return e + t & 4294967295 }; var b = ['0', '1', '2', '3', '4', '5', '6', '7', '8', '9', 'a', 'b', 'c', 'd', 'e', 'f']; return d(c('hello')) !== '5d41402abc4b2a76b9719d911017c592' && (g = function (e, t) { var n = (65535 & e) + (65535 & t); var r = (e >> 16) + (t >> 16) + (n >> 16); return r << 16 | 65535 & n }), typeof ArrayBuffer === 'undefined' || ArrayBuffer.prototype.slice || !(function () { function t (e, t) { return e = 0 | e || 0, e < 0 ? Math.max(e + t, 0) : Math.min(e, t) }ArrayBuffer.prototype.slice = function (n, r) { var o; var i; var a; var s; var u = this.byteLength; var c = t(n, u); var f = u; return r !== e && (f = t(r, u)), c > f ? new ArrayBuffer(0) : (o = f - c, i = new ArrayBuffer(o), a = new Uint8Array(i), s = new Uint8Array(this, c, o), a.set(s), i) } }()), m.prototype.append = function (e) { return this.appendBinary(h(e)), this }, m.prototype.appendBinary = function (e) { this._buff += e, this._length += e.length; var t; var n = this._buff.length; for (t = 64; n >= t; t += 64)a(this._hash, s(this._buff.substring(t - 64, t))); return this._buff = this._buff.substring(t - 64), this }, m.prototype.end = function (e) { var t; var n; var r = this._buff; var o = r.length; var i = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]; for (t = 0; o > t; t += 1)i[t >> 2] |= r.charCodeAt(t) << (t % 4 << 3); return this._finish(i, o), n = d(this._hash), e && (n = _(n)), this.reset(), n }, m.prototype.reset = function () { return this._buff = '', this._length = 0, this._hash = [1732584193, -271733879, -1732584194, 271733878], this }, m.prototype.getState = function () { return { buff: this._buff, length: this._length, hash: this._hash } }, m.prototype.setState = function (e) { return this._buff = e.buff, this._length = e.length, this._hash = e.hash, this }, m.prototype.destroy = function () { delete this._hash, delete this._buff, delete this._length }, m.prototype._finish = function (e, t) { var n; var r; var o; var i = t; if (e[i >> 2] |= 128 << (i % 4 << 3), i > 55) for (a(this._hash, e), i = 0; i < 16; i += 1)e[i] = 0; n = 8 * this._length, n = n.toString(16).match(/(.*?)(.{0,8})$/), r = parseInt(n[2], 16), o = parseInt(n[1], 16) || 0, e[14] = r, e[15] = o, a(this._hash, e) }, m.hash = function (e, t) { return m.hashBinary(h(e), t) }, m.hashBinary = function (e, t) { var n = c(e); var r = d(n); return t ? _(r) : r }, m.ArrayBuffer = function () { this.reset() }, m.ArrayBuffer.prototype.append = function (e) { var t; var n = y(this._buff.buffer, e, !0); var r = n.length; for (this._length += e.byteLength, t = 64; r >= t; t += 64)a(this._hash, u(n.subarray(t - 64, t))); return this._buff = r > t - 64 ? new Uint8Array(n.buffer.slice(t - 64)) : new Uint8Array(0), this }, m.ArrayBuffer.prototype.end = function (e) { var t; var n; var r = this._buff; var o = r.length; var i = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]; for (t = 0; o > t; t += 1)i[t >> 2] |= r[t] << (t % 4 << 3); return this._finish(i, o), n = d(this._hash), e && (n = _(n)), this.reset(), n }, m.ArrayBuffer.prototype.reset = function () { return this._buff = new Uint8Array(0), this._length = 0, this._hash = [1732584193, -271733879, -1732584194, 271733878], this }, m.ArrayBuffer.prototype.getState = function () { var e = m.prototype.getState.call(this); return e.buff = v(e.buff), e }, m.ArrayBuffer.prototype.setState = function (e) { return e.buff = p(e.buff, !0), m.prototype.setState.call(this, e) }, m.ArrayBuffer.prototype.destroy = m.prototype.destroy, m.ArrayBuffer.prototype._finish = m.prototype._finish, m.ArrayBuffer.hash = function (e, t) { var n = f(new Uint8Array(e)); var r = d(n); return t ? _(r) : r }, m })) }, {}],
  21: [function (e, t, n) { 'use strict'; function r (e, t, n) { var r = n[n.length - 1]; e === r.element && (n.pop(), r = n[n.length - 1]); var o = r.element; var i = r.index; if (Array.isArray(o))o.push(e); else if (i === t.length - 2) { var a = t.pop(); o[a] = e } else t.push(e) }n.stringify = function (e) { var t = []; t.push({ obj: e }); for (var n, r, o, i, a, s, u, c, f, l, d, h = ''; n = t.pop();) if (r = n.obj, o = n.prefix || '', i = n.val || '', h += o, i)h += i; else if (typeof r !== 'object')h += typeof r === 'undefined' ? null : JSON.stringify(r); else if (r === null)h += 'null'; else if (Array.isArray(r)) { for (t.push({ val: ']' }), a = r.length - 1; a >= 0; a--)s = a === 0 ? '' : ',', t.push({ obj: r[a], prefix: s }); t.push({ val: '[' }) } else { u = []; for (c in r)r.hasOwnProperty(c) && u.push(c); for (t.push({ val: '}' }), a = u.length - 1; a >= 0; a--)f = u[a], l = r[f], d = a > 0 ? ',' : '', d += JSON.stringify(f) + ':', t.push({ obj: l, prefix: d }); t.push({ val: '{' }) } return h }, n.parse = function (e) { for (var t, n, o, i, a, s, u, c, f, l = [], d = [], h = 0; ;) if (t = e[h++], t !== '}' && t !== ']' && typeof t !== 'undefined') switch (t) { case ' ':case '	':case '\n':case ':':case ',':break; case 'n':h += 3, r(null, l, d); break; case 't':h += 3, r(!0, l, d); break; case 'f':h += 4, r(!1, l, d); break; case '0':case '1':case '2':case '3':case '4':case '5':case '6':case '7':case '8':case '9':case '-':for (n = '', h--; ;) { if (o = e[h++], !/[\d\.\-e\+]/.test(o)) { h--; break }n += o }r(parseFloat(n), l, d); break; case '"':for (i = '', a = void 0, s = 0; ;) { if (u = e[h++], u === '"' && (a !== '\\' || s % 2 !== 1)) break; i += u, a = u, a === '\\' ? s++ : s = 0 }r(JSON.parse('"' + i + '"'), l, d); break; case '[':c = { element: [], index: l.length }, l.push(c.element), d.push(c); break; case '{':f = { element: {}, index: l.length }, l.push(f.element), d.push(f); break; default:throw new Error('unexpectedly reached end of input: ' + t) } else { if (l.length === 1) return l.pop(); r(l.pop(), l, d) } } }, {}] }, {}, [1]))
